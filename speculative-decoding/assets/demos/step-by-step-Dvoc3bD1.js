import"../modulepreload-polyfill-B5Qt9EMX.js";/* empty css                */import{s as T,a as R,b as B,S as L,m as D,T as U,R as A,O as q,L as G,A as M,c as W,d as j,e as F,f as o,g as r,j as y,C as _,h as u,i as N}from"../canvas-setup-F5JALq5m.js";import{S as H,B as K,P as V,G as Y,b as v,c as b,d as x,T as E,e as O,s as J,f as Q,a as X}from"../index-CjkBKNG3.js";const Z=0,S=1,$=2,z=[{title:"Draft Model",description:'The <span class="term-draft-model">draft model</span> generates output tokens.'},{title:"Target Model",description:'The <span class="term-target-model">target model</span> processes all outputs in a single forward pass.'},{title:"Target Distribution",description:'The <span class="term-target-model">target model</span> produces a probability distribution, <span class="term-target-model">p<sub>target</sub></span>, at each position.'},{title:"Draft Distribution",description:'Each token was sampled from <span class="term-draft-model">p<sub>draft</sub></span>. We compare this to <span class="term-target-model">p<sub>target</sub></span>.'},{title:"Acceptance",description:'We use <code>min(1, <span class="term-target-model">p<sub>target</sub></span> / <span class="term-draft-model">p<sub>draft</sub></span>)</code> to decide whether to accept each token.'},{title:"Bees",description:'We accept "bees". <span class="term-target-model">p<sub>target</sub></span> &gt; <span class="term-draft-model">p<sub>draft</sub></span>, so the formula gives <span class="term-accept">1</span>, or <span class="term-accept">100%</span> chance to accept.'},{title:"Communicate",description:'"communicate" also has <span class="term-target-model">p<sub>target</sub></span> &gt; <span class="term-draft-model">p<sub>draft</sub></span>, so we accept.'},{title:"Using",description:'For "using", <span class="term-target-model">p<sub>target</sub></span> &lt; <span class="term-draft-model">p<sub>draft</sub></span>. The formula gives <span class="term-accept">0.8</span>, or <span class="term-accept">80%</span> chance. We accept.'},{title:"A",description:'"a" has <span class="term-target-model">p<sub>target</sub></span> slightly below <span class="term-draft-model">p<sub>draft</sub></span>. <span class="term-accept">90%</span> chance. We accept.'},{title:"Buzz",description:'For "buzz", <span class="term-target-model">p<sub>target</sub></span> is much lower than <span class="term-draft-model">p<sub>draft</sub></span>. The formula gives <span class="term-reject">0.2</span>, or <span class="term-reject">20%</span> chance. This time, we reject.'},{title:"Residual",description:'After rejection, we resample from <span class="term-residual">p<sub>residual</sub></span> = <code>max(0, <span class="term-target-model">p<sub>target</sub></span> - <span class="term-draft-model">p<sub>draft</sub></span>)</code>.'},{title:"Resampling",description:'Finally, we replace "buzz" with the resampled token: "wiggle".'},{title:"Repeat",description:'We repeat the same process, continuing generation from "wiggle".'}];async function C(){const s=document.getElementById("canvas");if(!s)return;T(s),R(s),window.addEventListener("resize",()=>T(s)),await B("ABC Diatype",400);const a=await L.new().withCanvas(s).withLoading(D(s)).withPlugins(U,A,q,G,M,W,j,F(),H,K,V,Y).withScene("../scenes/step-by-step.scene").build(),m=["The","scientist","discovered","that"],f=["bees","communicate","using","a","buzz","sound"];for(const e of a.query([o,r])){const t=o.index[e],n=o.group[e];n===Z&&t<m.length?r.content[e]=m[t]:n===S&&t<f.length&&(r.content[e]=f[t])}const k=15,i=[{label:"bees",barIndex:6,yOffset:1.2,targetProbs:[.08,.15,.04,.22,.06,.12,.75,.18,.03,.09,.25,.05,.11,.07,.02],draftProbs:[.12,.08,.06,.18,.1,.15,.55,.25,.05,.14,.2,.08,.09,.04,.03]},{label:"communicate",barIndex:9,yOffset:2.3,targetProbs:[.05,.12,.08,.15,.04,.18,.06,.1,.03,.7,.22,.07,.14,.09,.02],draftProbs:[.08,.1,.06,.12,.05,.15,.09,.14,.04,.5,.18,.06,.11,.07,.03]},{label:"using",barIndex:7,yOffset:1,targetProbs:[.12,.18,.1,.15,.08,.2,.14,.48,.11,.16,.09,.13,.07,.1,.05],draftProbs:[.1,.15,.12,.18,.09,.17,.11,.6,.13,.14,.08,.12,.09,.11,.06]},{label:"a",barIndex:5,yOffset:1.1,targetProbs:[.08,.12,.15,.1,.18,.54,.14,.09,.2,.11,.07,.16,.06,.13,.04],draftProbs:[.1,.14,.12,.08,.16,.6,.11,.07,.18,.13,.09,.15,.05,.1,.06]},{label:"buzz",barIndex:11,yOffset:1.3,targetProbs:[.15,.08,.12,.65,.06,.18,.14,.2,.09,.16,.07,.1,.11,.08,.05],draftProbs:[.08,.12,.1,.08,.09,.14,.11,.18,.13,.16,.07,.5,.1,.08,.06],wiggleBarIndex:3,wiggleYOffset:4.5}],l=[...a.query([v])][0],h=[...a.query([b])],c=h[0],P=h[1];let d,g;if(c!==void 0)for(const e of a.query([y(_.relation,c),r])){d=e;break}if(P!==void 0)for(const e of a.query([y(_.relation,P),r])){g=e;break}d!==void 0&&(r.content[d]=i[0].label),g!==void 0&&(r.content[g]="wiggle"),l!==void 0&&(v.barCount[l]=k,x(l,i[0].targetProbs,i[0].draftProbs));for(const e of a.query([o,r])){const t=o.index[e],n=o.group[e];n===S&&t===4?(a.addComponent(e,E),O(e,"buzz","wiggle")):n===$&&t===4&&(a.addComponent(e,E),O(e,"✗","✓"))}const I=e=>{if(l===void 0)return;const t=Math.max(0,e-5);if(t<i.length){const n=i[t];x(l,n.targetProbs,n.draftProbs),c!==void 0&&(b.barIndex[c]=n.barIndex,b.yOffset[c]=n.yOffset),d!==void 0&&(r.content[d]=n.label)}};s.__state__=a,J(s,a);const p=[...a.query([u])][0];if(s.__controllerEid__=p,p!==void 0){s.__getStep__=()=>u.target[p],s.__setStep__=t=>{u.target[p]=t},s.__maxStep__=z.length-1;const e=Q(document.body);X(e,{steps:z,onStepChange(t){u.target[p]=t,I(t)}})}N(a);const w=()=>{window.parent.postMessage({type:"iframe-resize",height:document.body.scrollHeight},"*")};w(),window.addEventListener("resize",w)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",C):C();
//# sourceMappingURL=step-by-step-Dvoc3bD1.js.map
