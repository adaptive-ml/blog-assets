import"../modulepreload-polyfill-B5Qt9EMX.js";/* empty css                */import{s as h,a as z,S as I,m as R,T as S,R as B,O as C,L as D,A as L,b as U,c as A,d as G,e as i,f as n,h as P,C as w,g as q}from"../canvas-setup-FxFxhnX5.js";import{S as W,B as F,P as M,G as j,a as T,b as u,s as y,T as x,c as v}from"../index-D5b1YJF_.js";const _=0,O=1,N=2,H=[{title:"Draft Model",description:'The <span class="term-draft-model">draft model</span> generates output tokens.'},{title:"Target Model",description:'The <span class="term-target-model">target model</span> processes all outputs in a single forward pass.'},{title:"Target Distribution",description:'The <span class="term-target-model">target model</span> produces a probability distribution, <span class="term-target-model">p<sub>target</sub></span>, at each position.'},{title:"Draft Distribution",description:'Each token was sampled from <span class="term-draft-model">p<sub>draft</sub></span>. We compare this to <span class="term-target-model">p<sub>target</sub></span>.'},{title:"Acceptance",description:'We use <code>min(1, <span class="term-target-model">p<sub>target</sub></span> / <span class="term-draft-model">p<sub>draft</sub></span>)</code> to decide whether to accept each token.'},{title:"Bees",description:'We accept "bees". <span class="term-target-model">p<sub>target</sub></span> &gt; <span class="term-draft-model">p<sub>draft</sub></span>, so the formula gives <span class="term-accept">1</span>, or <span class="term-accept">100%</span> chance to accept.'},{title:"Communicate",description:'"communicate" also has <span class="term-target-model">p<sub>target</sub></span> &gt; <span class="term-draft-model">p<sub>draft</sub></span>, so we accept.'},{title:"Using",description:'For "using", <span class="term-target-model">p<sub>target</sub></span> &lt; <span class="term-draft-model">p<sub>draft</sub></span>. The formula gives <span class="term-accept">0.8</span>, or <span class="term-accept">80%</span> chance. We accept.'},{title:"A",description:'"a" has <span class="term-target-model">p<sub>target</sub></span> slightly below <span class="term-draft-model">p<sub>draft</sub></span>. <span class="term-accept">90%</span> chance. We accept.'},{title:"Buzz",description:'For "buzz", <span class="term-target-model">p<sub>target</sub></span> is much lower than <span class="term-draft-model">p<sub>draft</sub></span>. The formula gives <span class="term-reject">0.2</span>, or <span class="term-reject">20%</span> chance. This time, we reject.'},{title:"Residual",description:'After rejection, we resample from <span class="term-residual">p<sub>residual</sub></span> = <code>max(0, <span class="term-target-model">p<sub>target</sub></span> - <span class="term-draft-model">p<sub>draft</sub></span>)</code>.'},{title:"Resampling",description:'Finally, we replace "buzz" with the resampled token: "wiggle".'},{title:"Repeat",description:'We repeat the same process, continuing generation from "wiggle".'}];async function E(){const r=document.getElementById("canvas");if(!r)return;h(r),z(r),window.addEventListener("resize",()=>h(r));const a=await I.new().withCanvas(r).withLoading(R(r)).withPlugins(S,B,C,D,L,U,A,G(),W,F,M,j).withScene("../scenes/step-by-step.scene").build(),b=["The","scientist","discovered","that"],g=["bees","communicate","using","a","buzz","sound"];for(const e of a.query([i,n])){const s=i.index[e],t=i.group[e];t===_&&s<b.length?n.content[e]=b[s]:t===O&&s<g.length&&(n.content[e]=g[s])}const k=15,o=[{label:"bees",barIndex:6,yOffset:1.2,targetProbs:[.08,.15,.04,.22,.06,.12,.75,.18,.03,.09,.25,.05,.11,.07,.02],draftProbs:[.12,.08,.06,.18,.1,.15,.55,.25,.05,.14,.2,.08,.09,.04,.03]},{label:"communicate",barIndex:9,yOffset:2.3,targetProbs:[.05,.12,.08,.15,.04,.18,.06,.1,.03,.7,.22,.07,.14,.09,.02],draftProbs:[.08,.1,.06,.12,.05,.15,.09,.14,.04,.5,.18,.06,.11,.07,.03]},{label:"using",barIndex:7,yOffset:1,targetProbs:[.12,.18,.1,.15,.08,.2,.14,.48,.11,.16,.09,.13,.07,.1,.05],draftProbs:[.1,.15,.12,.18,.09,.17,.11,.6,.13,.14,.08,.12,.09,.11,.06]},{label:"a",barIndex:5,yOffset:1.1,targetProbs:[.08,.12,.15,.1,.18,.54,.14,.09,.2,.11,.07,.16,.06,.13,.04],draftProbs:[.1,.14,.12,.08,.16,.6,.11,.07,.18,.13,.09,.15,.05,.1,.06]},{label:"buzz",barIndex:11,yOffset:1.3,targetProbs:[.15,.08,.12,.65,.06,.18,.14,.2,.09,.16,.07,.1,.11,.08,.05],draftProbs:[.08,.12,.1,.08,.09,.14,.11,.18,.13,.16,.07,.5,.1,.08,.06],wiggleBarIndex:3,wiggleYOffset:4.5}],l=[...a.query([T])][0],m=[...a.query([u])],c=m[0],f=m[1];let d,p;if(c!==void 0)for(const e of a.query([P(w.relation,c),n])){d=e;break}if(f!==void 0)for(const e of a.query([P(w.relation,f),n])){p=e;break}d!==void 0&&(n.content[d]=o[0].label),p!==void 0&&(n.content[p]="wiggle"),l!==void 0&&(T.barCount[l]=k,y(l,o[0].targetProbs,o[0].draftProbs));for(const e of a.query([i,n])){const s=i.index[e],t=i.group[e];t===O&&s===4?(a.addComponent(e,x),v(e,"buzz","wiggle")):t===N&&s===4&&(a.addComponent(e,x),v(e,"✗","✓"))}q(r,a,H,e=>{if(l===void 0)return;const s=Math.max(0,e-5);if(s<o.length){const t=o[s];y(l,t.targetProbs,t.draftProbs),c!==void 0&&(u.barIndex[c]=t.barIndex,u.yOffset[c]=t.yOffset),d!==void 0&&(n.content[d]=t.label)}})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",E):E();
//# sourceMappingURL=step-by-step-vtKMwtXL.js.map
