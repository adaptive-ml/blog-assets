{"version":3,"file":"overview-DW62v0bT.js","sources":["../../../demos/overview.ts"],"sourcesContent":["import {\n  State,\n  TransformsPlugin,\n  RenderPlugin,\n  TweenPlugin,\n  minimalLight,\n} from '@multiplekex/shallot';\nimport { OrbitPlugin, LinesPlugin, ArrowsPlugin, TextPlugin } from '@multiplekex/shallot/extras';\nimport {\n  createStepPlugin,\n  setupCanvas,\n  setupScrollPassthrough,\n  setupDemo,\n  TokenIndex,\n} from '@blog-components/sequence';\nimport { Text } from '@multiplekex/shallot/extras';\nimport { SpecdecPlugin, BorderPlugin } from '../src';\n\nconst GROUP_INPUT = 0;\nconst GROUP_OUTPUT = 1;\nconst GROUP_DRAFT_INPUT = 2;\nconst GROUP_DRAFT_OUTPUT = 3;\nconst GROUP_DRAFT_MARK = 4;\n\nconst STEPS = [\n  { title: 'Input', description: 'We have a sequence of <span class=\"term-input\">input tokens</span>. We want to predict the next six.' },\n  { title: 'Target Model', description: 'We feed them to a large language model — the <span class=\"term-target-model\">target model</span>.' },\n  { title: 'First Prediction', description: 'The <span class=\"term-target-model\">target model</span> predicts the next token: <span class=\"term-output\">\"bees\"</span>.' },\n  { title: 'Sequential Generation', description: 'We repeat this process, generating one token per pass. This is slow.' },\n  { title: 'Draft Model', description: 'Now suppose we have a smaller, faster model — the <span class=\"term-draft-model\">draft model</span>.' },\n  { title: 'Draft Output', description: 'The <span class=\"term-draft-model\">draft model</span> generates tokens quickly, but with lower quality.' },\n  { title: 'Validation', description: 'Now, what if we could use our <span class=\"term-target-model\">target model</span> to accept or reject these tokens?' },\n  { title: 'Speculative Decoding', description: 'That\\'s <b>speculative decoding</b>. Draft quickly, then validate all at once.' },\n];\n\nasync function init(): Promise<void> {\n  const canvas = document.getElementById('canvas') as HTMLCanvasElement;\n  if (!canvas) return;\n\n  setupCanvas(canvas);\n  setupScrollPassthrough(canvas);\n  window.addEventListener('resize', () => setupCanvas(canvas));\n\n  const state = await State.new()\n    .withCanvas(canvas)\n    .withLoading(minimalLight(canvas))\n    .withPlugins(\n      TransformsPlugin,\n      RenderPlugin,\n      OrbitPlugin,\n      LinesPlugin,\n      ArrowsPlugin,\n      TextPlugin,\n      TweenPlugin,\n      createStepPlugin(),\n      SpecdecPlugin,\n      BorderPlugin\n    )\n    .withScene('../scenes/overview.scene')\n    .build();\n\n  const inputTokens = ['The', 'scientist', 'discovered', 'that'];\n  const outputTokens = ['bees', 'communicate', 'with', 'a', 'wiggle', 'dance'];\n  const draftOutputTokens = ['bees', 'communicate', 'using', 'a', 'buzz', 'sound'];\n  const validationMarks = ['✓', '✓', '✓', '✓', '✗', '✗'];\n\n  for (const eid of state.query([TokenIndex, Text])) {\n    const idx = TokenIndex.index[eid];\n    const group = TokenIndex.group[eid];\n\n    if (group === GROUP_INPUT && idx < inputTokens.length) {\n      Text.content[eid] = inputTokens[idx];\n    } else if (group === GROUP_OUTPUT && idx < outputTokens.length) {\n      Text.content[eid] = outputTokens[idx];\n    } else if (group === GROUP_DRAFT_INPUT && idx < inputTokens.length) {\n      Text.content[eid] = inputTokens[idx];\n    } else if (group === GROUP_DRAFT_OUTPUT && idx < draftOutputTokens.length) {\n      Text.content[eid] = draftOutputTokens[idx];\n    } else if (group === GROUP_DRAFT_MARK && idx < validationMarks.length) {\n      Text.content[eid] = validationMarks[idx];\n    }\n  }\n\n  setupDemo(canvas, state, STEPS);\n}\n\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', init);\n} else {\n  init();\n}\n"],"names":["GROUP_INPUT","GROUP_OUTPUT","GROUP_DRAFT_INPUT","GROUP_DRAFT_OUTPUT","GROUP_DRAFT_MARK","STEPS","init","canvas","setupCanvas","setupScrollPassthrough","state","State","minimalLight","TransformsPlugin","RenderPlugin","OrbitPlugin","LinesPlugin","ArrowsPlugin","TextPlugin","TweenPlugin","createStepPlugin","SpecdecPlugin","BorderPlugin","inputTokens","outputTokens","draftOutputTokens","validationMarks","eid","TokenIndex","Text","idx","group","setupDemo"],"mappings":"8QAkBA,MAAMA,EAAc,EACdC,EAAe,EACfC,EAAoB,EACpBC,EAAqB,EACrBC,EAAmB,EAEnBC,EAAQ,CACZ,CAAE,MAAO,QAAS,YAAa,sGAAA,EAC/B,CAAE,MAAO,eAAgB,YAAa,mGAAA,EACtC,CAAE,MAAO,mBAAoB,YAAa,2HAAA,EAC1C,CAAE,MAAO,wBAAyB,YAAa,sEAAA,EAC/C,CAAE,MAAO,cAAe,YAAa,sGAAA,EACrC,CAAE,MAAO,eAAgB,YAAa,yGAAA,EACtC,CAAE,MAAO,aAAc,YAAa,qHAAA,EACpC,CAAE,MAAO,uBAAwB,YAAa,+EAAA,CAChD,EAEA,eAAeC,GAAsB,CACnC,MAAMC,EAAS,SAAS,eAAe,QAAQ,EAC/C,GAAI,CAACA,EAAQ,OAEbC,EAAYD,CAAM,EAClBE,EAAuBF,CAAM,EAC7B,OAAO,iBAAiB,SAAU,IAAMC,EAAYD,CAAM,CAAC,EAE3D,MAAMG,EAAQ,MAAMC,EAAM,IAAA,EACvB,WAAWJ,CAAM,EACjB,YAAYK,EAAaL,CAAM,CAAC,EAChC,YACCM,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EAAA,EACAC,EACAC,CAAA,EAED,UAAU,0BAA0B,EACpC,MAAA,EAEGC,EAAc,CAAC,MAAO,YAAa,aAAc,MAAM,EACvDC,EAAe,CAAC,OAAQ,cAAe,OAAQ,IAAK,SAAU,OAAO,EACrEC,EAAoB,CAAC,OAAQ,cAAe,QAAS,IAAK,OAAQ,OAAO,EACzEC,EAAkB,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,GAAG,EAErD,UAAWC,KAAOjB,EAAM,MAAM,CAACkB,EAAYC,CAAI,CAAC,EAAG,CACjD,MAAMC,EAAMF,EAAW,MAAMD,CAAG,EAC1BI,EAAQH,EAAW,MAAMD,CAAG,EAE9BI,IAAU/B,GAAe8B,EAAMP,EAAY,OAC7CM,EAAK,QAAQF,CAAG,EAAIJ,EAAYO,CAAG,EAC1BC,IAAU9B,GAAgB6B,EAAMN,EAAa,OACtDK,EAAK,QAAQF,CAAG,EAAIH,EAAaM,CAAG,EAC3BC,IAAU7B,GAAqB4B,EAAMP,EAAY,OAC1DM,EAAK,QAAQF,CAAG,EAAIJ,EAAYO,CAAG,EAC1BC,IAAU5B,GAAsB2B,EAAML,EAAkB,OACjEI,EAAK,QAAQF,CAAG,EAAIF,EAAkBK,CAAG,EAChCC,IAAU3B,GAAoB0B,EAAMJ,EAAgB,SAC7DG,EAAK,QAAQF,CAAG,EAAID,EAAgBI,CAAG,EAE3C,CAEAE,EAAUzB,EAAQG,EAAOL,CAAK,CAChC,CAEI,SAAS,aAAe,UAC1B,SAAS,iBAAiB,mBAAoBC,CAAI,EAElDA,EAAA"}