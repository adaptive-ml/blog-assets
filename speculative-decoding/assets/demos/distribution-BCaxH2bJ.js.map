{"version":3,"file":"distribution-BCaxH2bJ.js","sources":["../../../demos/distribution.ts"],"sourcesContent":["import {\r\n  State,\r\n  TransformsPlugin,\r\n  RenderPlugin,\r\n  TweenPlugin,\r\n  minimalLight,\r\n} from '@multiplekex/shallot';\r\nimport { OrbitPlugin, LinesPlugin, TextPlugin, setTextFont } from '@multiplekex/shallot/extras';\r\nimport {\r\n  createStepPlugin,\r\n  setupStepUI,\r\n  findStepElements,\r\n  StepController,\r\n  setupCanvas,\r\n  setupScrollPassthrough,\r\n  createVisibilityLoop,\r\n  type StepContent,\r\n} from '@blog-components/sequence';\r\nimport { setupCanvasRecording } from '@blog-components/recording';\r\nimport { ProbabilityDistributionPlugin, ProbabilityDistribution, setDistributionProbabilities } from '../src';\r\n\r\nconst STEP_CONTENT: StepContent[] = [\r\n  { title: 'Compare Distributions', description: 'The <span class=\"term-draft-model\">draft</span> and <span class=\"term-target-model\">target</span> models produce different probability distributions.' },\r\n  { title: 'Guaranteed Acceptance', description: 'The <span style=\"color: #14b8a6\">minimum</span> of the two distributions represents probability mass that will always be accepted.' },\r\n  { title: 'Excess Draft', description: 'Where <span class=\"term-draft-model\">draft</span> exceeds <span class=\"term-target-model\">target</span>, tokens may be <span class=\"term-reject\">rejected</span> with probability proportional to the excess.' },\r\n  { title: 'Rejection & Resampling', description: 'When rejected, we <span class=\"term-residual\">resample</span> from the residualâ€”the probability mass where <span class=\"term-target-model\">target</span> exceeds <span class=\"term-draft-model\">draft</span>.' },\r\n  { title: 'Exact Target Distribution', description: 'The <span style=\"color: #14b8a6\">guaranteed acceptance</span> plus <span class=\"term-residual\">residual resampling</span> recovers the exact <span class=\"term-target-model\">target</span> distribution.' },\r\n];\r\n\r\nconst BAR_COUNT = 10;\r\n\r\nconst targetProbs = [0.05, 0.12, 0.08, 0.35, 0.15, 0.08, 0.05, 0.04, 0.05, 0.03];\r\nconst draftProbs =  [0.08, 0.10, 0.15, 0.20, 0.12, 0.10, 0.08, 0.07, 0.06, 0.04];\r\n\r\nasync function init(): Promise<void> {\r\n  const canvas = document.getElementById('canvas') as HTMLCanvasElement;\r\n  if (!canvas) return;\r\n\r\n  setupCanvas(canvas);\r\n  setupScrollPassthrough(canvas);\r\n  window.addEventListener('resize', () => setupCanvas(canvas));\r\n\r\n  await setTextFont('ABC Diatype', 400);\r\n\r\n  const state = await State.new()\r\n    .withCanvas(canvas)\r\n    .withLoading(minimalLight(canvas))\r\n    .withPlugins(\r\n      TransformsPlugin,\r\n      RenderPlugin,\r\n      OrbitPlugin,\r\n      LinesPlugin,\r\n      TextPlugin,\r\n      TweenPlugin,\r\n      createStepPlugin(),\r\n      ProbabilityDistributionPlugin\r\n    )\r\n    .withScene('../scenes/distribution.scene')\r\n    .build();\r\n\r\n  const probBarsEids = [...state.query([ProbabilityDistribution])];\r\n  const probBarsEid = probBarsEids[0];\r\n\r\n  if (probBarsEid !== undefined) {\r\n    ProbabilityDistribution.barCount[probBarsEid] = BAR_COUNT;\r\n    setDistributionProbabilities(probBarsEid, targetProbs, draftProbs);\r\n  }\r\n\r\n  canvas.__state__ = state;\r\n  setupCanvasRecording(canvas, state);\r\n\r\n  const controllers = [...state.query([StepController])];\r\n  const controllerEid = controllers[0];\r\n  canvas.__controllerEid__ = controllerEid;\r\n\r\n  if (controllerEid !== undefined) {\r\n    canvas.__getStep__ = () => StepController.target[controllerEid];\r\n    canvas.__setStep__ = (step: number) => {\r\n      StepController.target[controllerEid] = step;\r\n    };\r\n    canvas.__maxStep__ = STEP_CONTENT.length - 1;\r\n\r\n    const elements = findStepElements(document.body);\r\n    setupStepUI(elements, {\r\n      steps: STEP_CONTENT,\r\n      onStepChange(step) {\r\n        StepController.target[controllerEid] = step;\r\n      },\r\n    });\r\n  }\r\n\r\n  createVisibilityLoop(state);\r\n\r\n  const reportHeight = () => {\r\n    window.parent.postMessage({ type: 'iframe-resize', height: document.body.scrollHeight }, '*');\r\n  };\r\n  reportHeight();\r\n  window.addEventListener('resize', reportHeight);\r\n}\r\n\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', init);\r\n} else {\r\n  init();\r\n}\r\n"],"names":["STEP_CONTENT","BAR_COUNT","targetProbs","draftProbs","init","canvas","setupCanvas","setupScrollPassthrough","setTextFont","state","State","minimalLight","TransformsPlugin","RenderPlugin","OrbitPlugin","LinesPlugin","TextPlugin","TweenPlugin","createStepPlugin","ProbabilityDistributionPlugin","probBarsEid","ProbabilityDistribution","setDistributionProbabilities","setupCanvasRecording","controllerEid","StepController","step","elements","findStepElements","setupStepUI","createVisibilityLoop","reportHeight"],"mappings":"mSAqBA,MAAMA,EAA8B,CAClC,CAAE,MAAO,wBAAyB,YAAa,uJAAA,EAC/C,CAAE,MAAO,wBAAyB,YAAa,oIAAA,EAC/C,CAAE,MAAO,eAAgB,YAAa,+MAAA,EACtC,CAAE,MAAO,yBAA0B,YAAa,+MAAA,EAChD,CAAE,MAAO,4BAA6B,YAAa,0MAAA,CACrD,EAEMC,EAAY,GAEZC,EAAc,CAAC,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAI,EACzEC,EAAc,CAAC,IAAM,GAAM,IAAM,GAAM,IAAM,GAAM,IAAM,IAAM,IAAM,GAAI,EAE/E,eAAeC,GAAsB,CACnC,MAAMC,EAAS,SAAS,eAAe,QAAQ,EAC/C,GAAI,CAACA,EAAQ,OAEbC,EAAYD,CAAM,EAClBE,EAAuBF,CAAM,EAC7B,OAAO,iBAAiB,SAAU,IAAMC,EAAYD,CAAM,CAAC,EAE3D,MAAMG,EAAY,cAAe,GAAG,EAEpC,MAAMC,EAAQ,MAAMC,EAAM,IAAA,EACvB,WAAWL,CAAM,EACjB,YAAYM,EAAaN,CAAM,CAAC,EAChC,YACCO,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EAAA,EACAC,CAAA,EAED,UAAU,8BAA8B,EACxC,MAAA,EAGGC,EADe,CAAC,GAAGX,EAAM,MAAM,CAACY,CAAuB,CAAC,CAAC,EAC9B,CAAC,EAE9BD,IAAgB,SAClBC,EAAwB,SAASD,CAAW,EAAInB,EAChDqB,EAA6BF,EAAalB,EAAaC,CAAU,GAGnEE,EAAO,UAAYI,EACnBc,EAAqBlB,EAAQI,CAAK,EAGlC,MAAMe,EADc,CAAC,GAAGf,EAAM,MAAM,CAACgB,CAAc,CAAC,CAAC,EACnB,CAAC,EAGnC,GAFApB,EAAO,kBAAoBmB,EAEvBA,IAAkB,OAAW,CAC/BnB,EAAO,YAAc,IAAMoB,EAAe,OAAOD,CAAa,EAC9DnB,EAAO,YAAeqB,GAAiB,CACrCD,EAAe,OAAOD,CAAa,EAAIE,CACzC,EACArB,EAAO,YAAcL,EAAa,OAAS,EAE3C,MAAM2B,EAAWC,EAAiB,SAAS,IAAI,EAC/CC,EAAYF,EAAU,CACpB,MAAO3B,EACP,aAAa0B,EAAM,CACjBD,EAAe,OAAOD,CAAa,EAAIE,CACzC,CAAA,CACD,CACH,CAEAI,EAAqBrB,CAAK,EAE1B,MAAMsB,EAAe,IAAM,CACzB,OAAO,OAAO,YAAY,CAAE,KAAM,gBAAiB,OAAQ,SAAS,KAAK,YAAA,EAAgB,GAAG,CAC9F,EACAA,EAAA,EACA,OAAO,iBAAiB,SAAUA,CAAY,CAChD,CAEI,SAAS,aAAe,UAC1B,SAAS,iBAAiB,mBAAoB3B,CAAI,EAElDA,EAAA"}