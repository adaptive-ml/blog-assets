{"version":3,"file":"index-Kb45e7jD.js","sources":["../../../../src/sequence/ui.ts","../../../../node_modules/mp4-muxer/build/mp4-muxer.mjs","../../../../src/recording/canvas-recording.ts","../../src/colors.ts","../../src/border.ts","../../src/probability-distribution.ts","../../src/gradient-legend.ts","../../src/index.ts"],"sourcesContent":["export interface StepContent {\r\n  title: string;\r\n  description: string;\r\n}\r\n\r\nexport interface StepUIOptions {\r\n  steps: StepContent[];\r\n  onStepChange: (step: number) => void;\r\n}\r\n\r\nexport interface StepUIElements {\r\n  btnPrev: HTMLButtonElement | null;\r\n  btnNext: HTMLButtonElement | null;\r\n  counter: HTMLElement | null;\r\n  title: HTMLElement | null;\r\n  description: HTMLElement | null;\r\n}\r\n\r\nexport function findStepElements(container: HTMLElement | string): StepUIElements {\r\n  const root = typeof container === 'string' ? document.querySelector(container) : container;\r\n  if (!root) {\r\n    return { btnPrev: null, btnNext: null, counter: null, title: null, description: null };\r\n  }\r\n\r\n  return {\r\n    btnPrev: root.querySelector('.btn-prev') as HTMLButtonElement | null,\r\n    btnNext: root.querySelector('.btn-next') as HTMLButtonElement | null,\r\n    counter: root.querySelector('.step-counter'),\r\n    title: root.querySelector('.step-title'),\r\n    description: root.querySelector('.step-description'),\r\n  };\r\n}\r\n\r\nexport interface StepUIController {\r\n  setStep: (step: number) => void;\r\n  getStep: () => number;\r\n  getMaxStep: () => number;\r\n  dispose: () => void;\r\n}\r\n\r\nexport function setupStepUI(elements: StepUIElements, options: StepUIOptions): StepUIController {\r\n  const { steps, onStepChange } = options;\r\n  const maxStep = steps.length - 1;\r\n  let currentStep = 0;\r\n\r\n  const stepInfo = elements.title?.parentElement;\r\n  if (stepInfo) {\r\n    let maxHeight = 0;\r\n    for (const step of steps) {\r\n      if (elements.title) elements.title.textContent = step.title;\r\n      if (elements.description) elements.description.innerHTML = step.description;\r\n      maxHeight = Math.max(maxHeight, stepInfo.offsetHeight);\r\n    }\r\n    stepInfo.style.minHeight = `${maxHeight}px`;\r\n  }\r\n\r\n  function updateDisplay(): void {\r\n    const { btnPrev, btnNext, counter, title, description } = elements;\r\n    const content = steps[currentStep];\r\n\r\n    if (btnPrev) btnPrev.disabled = currentStep <= 0;\r\n    if (btnNext) btnNext.disabled = currentStep >= maxStep;\r\n    if (counter) counter.textContent = `Step ${currentStep + 1} of ${steps.length}`;\r\n    if (title) title.textContent = content?.title ?? '';\r\n    if (description) description.innerHTML = content?.description ?? '';\r\n  }\r\n\r\n  function goToStep(step: number): void {\r\n    const clamped = Math.max(0, Math.min(maxStep, step));\r\n    if (clamped === currentStep) return;\r\n    currentStep = clamped;\r\n    updateDisplay();\r\n    onStepChange(currentStep);\r\n  }\r\n\r\n  const handlePrev = () => goToStep(currentStep - 1);\r\n  const handleNext = () => goToStep(currentStep + 1);\r\n  const handleKeydown = (e: KeyboardEvent) => {\r\n    if (e.key === 'ArrowLeft') goToStep(currentStep - 1);\r\n    if (e.key === 'ArrowRight') goToStep(currentStep + 1);\r\n  };\r\n\r\n  elements.btnPrev?.addEventListener('click', handlePrev);\r\n  elements.btnNext?.addEventListener('click', handleNext);\r\n  document.addEventListener('keydown', handleKeydown);\r\n\r\n  updateDisplay();\r\n\r\n  return {\r\n    setStep(step: number) {\r\n      currentStep = Math.max(0, Math.min(maxStep, step));\r\n      updateDisplay();\r\n    },\r\n    getStep: () => currentStep,\r\n    getMaxStep: () => maxStep,\r\n    dispose() {\r\n      elements.btnPrev?.removeEventListener('click', handlePrev);\r\n      elements.btnNext?.removeEventListener('click', handleNext);\r\n      document.removeEventListener('keydown', handleKeydown);\r\n    },\r\n  };\r\n}\r\n","var __accessCheck = (obj, member, msg) => {\n  if (!member.has(obj))\n    throw TypeError(\"Cannot \" + msg);\n};\nvar __privateGet = (obj, member, getter) => {\n  __accessCheck(obj, member, \"read from private field\");\n  return getter ? getter.call(obj) : member.get(obj);\n};\nvar __privateAdd = (obj, member, value) => {\n  if (member.has(obj))\n    throw TypeError(\"Cannot add the same private member more than once\");\n  member instanceof WeakSet ? member.add(obj) : member.set(obj, value);\n};\nvar __privateSet = (obj, member, value, setter) => {\n  __accessCheck(obj, member, \"write to private field\");\n  setter ? setter.call(obj, value) : member.set(obj, value);\n  return value;\n};\nvar __privateWrapper = (obj, member, setter, getter) => ({\n  set _(value) {\n    __privateSet(obj, member, value, setter);\n  },\n  get _() {\n    return __privateGet(obj, member, getter);\n  }\n});\nvar __privateMethod = (obj, member, method) => {\n  __accessCheck(obj, member, \"access private method\");\n  return method;\n};\n\n// src/misc.ts\nvar bytes = new Uint8Array(8);\nvar view = new DataView(bytes.buffer);\nvar u8 = (value) => {\n  return [(value % 256 + 256) % 256];\n};\nvar u16 = (value) => {\n  view.setUint16(0, value, false);\n  return [bytes[0], bytes[1]];\n};\nvar i16 = (value) => {\n  view.setInt16(0, value, false);\n  return [bytes[0], bytes[1]];\n};\nvar u24 = (value) => {\n  view.setUint32(0, value, false);\n  return [bytes[1], bytes[2], bytes[3]];\n};\nvar u32 = (value) => {\n  view.setUint32(0, value, false);\n  return [bytes[0], bytes[1], bytes[2], bytes[3]];\n};\nvar i32 = (value) => {\n  view.setInt32(0, value, false);\n  return [bytes[0], bytes[1], bytes[2], bytes[3]];\n};\nvar u64 = (value) => {\n  view.setUint32(0, Math.floor(value / 2 ** 32), false);\n  view.setUint32(4, value, false);\n  return [bytes[0], bytes[1], bytes[2], bytes[3], bytes[4], bytes[5], bytes[6], bytes[7]];\n};\nvar fixed_8_8 = (value) => {\n  view.setInt16(0, 2 ** 8 * value, false);\n  return [bytes[0], bytes[1]];\n};\nvar fixed_16_16 = (value) => {\n  view.setInt32(0, 2 ** 16 * value, false);\n  return [bytes[0], bytes[1], bytes[2], bytes[3]];\n};\nvar fixed_2_30 = (value) => {\n  view.setInt32(0, 2 ** 30 * value, false);\n  return [bytes[0], bytes[1], bytes[2], bytes[3]];\n};\nvar ascii = (text, nullTerminated = false) => {\n  let bytes2 = Array(text.length).fill(null).map((_, i) => text.charCodeAt(i));\n  if (nullTerminated)\n    bytes2.push(0);\n  return bytes2;\n};\nvar last = (arr) => {\n  return arr && arr[arr.length - 1];\n};\nvar lastPresentedSample = (samples) => {\n  let result = void 0;\n  for (let sample of samples) {\n    if (!result || sample.presentationTimestamp > result.presentationTimestamp) {\n      result = sample;\n    }\n  }\n  return result;\n};\nvar intoTimescale = (timeInSeconds, timescale, round = true) => {\n  let value = timeInSeconds * timescale;\n  return round ? Math.round(value) : value;\n};\nvar rotationMatrix = (rotationInDegrees) => {\n  let theta = rotationInDegrees * (Math.PI / 180);\n  let cosTheta = Math.cos(theta);\n  let sinTheta = Math.sin(theta);\n  return [\n    cosTheta,\n    sinTheta,\n    0,\n    -sinTheta,\n    cosTheta,\n    0,\n    0,\n    0,\n    1\n  ];\n};\nvar IDENTITY_MATRIX = rotationMatrix(0);\nvar matrixToBytes = (matrix) => {\n  return [\n    fixed_16_16(matrix[0]),\n    fixed_16_16(matrix[1]),\n    fixed_2_30(matrix[2]),\n    fixed_16_16(matrix[3]),\n    fixed_16_16(matrix[4]),\n    fixed_2_30(matrix[5]),\n    fixed_16_16(matrix[6]),\n    fixed_16_16(matrix[7]),\n    fixed_2_30(matrix[8])\n  ];\n};\nvar deepClone = (x) => {\n  if (!x)\n    return x;\n  if (typeof x !== \"object\")\n    return x;\n  if (Array.isArray(x))\n    return x.map(deepClone);\n  return Object.fromEntries(Object.entries(x).map(([key, value]) => [key, deepClone(value)]));\n};\nvar isU32 = (value) => {\n  return value >= 0 && value < 2 ** 32;\n};\n\n// src/box.ts\nvar box = (type, contents, children) => ({\n  type,\n  contents: contents && new Uint8Array(contents.flat(10)),\n  children\n});\nvar fullBox = (type, version, flags, contents, children) => box(\n  type,\n  [u8(version), u24(flags), contents ?? []],\n  children\n);\nvar ftyp = (details) => {\n  let minorVersion = 512;\n  if (details.fragmented)\n    return box(\"ftyp\", [\n      ascii(\"iso5\"),\n      // Major brand\n      u32(minorVersion),\n      // Minor version\n      // Compatible brands\n      ascii(\"iso5\"),\n      ascii(\"iso6\"),\n      ascii(\"mp41\")\n    ]);\n  return box(\"ftyp\", [\n    ascii(\"isom\"),\n    // Major brand\n    u32(minorVersion),\n    // Minor version\n    // Compatible brands\n    ascii(\"isom\"),\n    details.holdsAvc ? ascii(\"avc1\") : [],\n    ascii(\"mp41\")\n  ]);\n};\nvar mdat = (reserveLargeSize) => ({ type: \"mdat\", largeSize: reserveLargeSize });\nvar free = (size) => ({ type: \"free\", size });\nvar moov = (tracks, creationTime, fragmented = false) => box(\"moov\", null, [\n  mvhd(creationTime, tracks),\n  ...tracks.map((x) => trak(x, creationTime)),\n  fragmented ? mvex(tracks) : null\n]);\nvar mvhd = (creationTime, tracks) => {\n  let duration = intoTimescale(Math.max(\n    0,\n    ...tracks.filter((x) => x.samples.length > 0).map((x) => {\n      const lastSample = lastPresentedSample(x.samples);\n      return lastSample.presentationTimestamp + lastSample.duration;\n    })\n  ), GLOBAL_TIMESCALE);\n  let nextTrackId = Math.max(...tracks.map((x) => x.id)) + 1;\n  let needsU64 = !isU32(creationTime) || !isU32(duration);\n  let u32OrU64 = needsU64 ? u64 : u32;\n  return fullBox(\"mvhd\", +needsU64, 0, [\n    u32OrU64(creationTime),\n    // Creation time\n    u32OrU64(creationTime),\n    // Modification time\n    u32(GLOBAL_TIMESCALE),\n    // Timescale\n    u32OrU64(duration),\n    // Duration\n    fixed_16_16(1),\n    // Preferred rate\n    fixed_8_8(1),\n    // Preferred volume\n    Array(10).fill(0),\n    // Reserved\n    matrixToBytes(IDENTITY_MATRIX),\n    // Matrix\n    Array(24).fill(0),\n    // Pre-defined\n    u32(nextTrackId)\n    // Next track ID\n  ]);\n};\nvar trak = (track, creationTime) => box(\"trak\", null, [\n  tkhd(track, creationTime),\n  mdia(track, creationTime)\n]);\nvar tkhd = (track, creationTime) => {\n  let lastSample = lastPresentedSample(track.samples);\n  let durationInGlobalTimescale = intoTimescale(\n    lastSample ? lastSample.presentationTimestamp + lastSample.duration : 0,\n    GLOBAL_TIMESCALE\n  );\n  let needsU64 = !isU32(creationTime) || !isU32(durationInGlobalTimescale);\n  let u32OrU64 = needsU64 ? u64 : u32;\n  let matrix;\n  if (track.info.type === \"video\") {\n    matrix = typeof track.info.rotation === \"number\" ? rotationMatrix(track.info.rotation) : track.info.rotation;\n  } else {\n    matrix = IDENTITY_MATRIX;\n  }\n  return fullBox(\"tkhd\", +needsU64, 3, [\n    u32OrU64(creationTime),\n    // Creation time\n    u32OrU64(creationTime),\n    // Modification time\n    u32(track.id),\n    // Track ID\n    u32(0),\n    // Reserved\n    u32OrU64(durationInGlobalTimescale),\n    // Duration\n    Array(8).fill(0),\n    // Reserved\n    u16(0),\n    // Layer\n    u16(0),\n    // Alternate group\n    fixed_8_8(track.info.type === \"audio\" ? 1 : 0),\n    // Volume\n    u16(0),\n    // Reserved\n    matrixToBytes(matrix),\n    // Matrix\n    fixed_16_16(track.info.type === \"video\" ? track.info.width : 0),\n    // Track width\n    fixed_16_16(track.info.type === \"video\" ? track.info.height : 0)\n    // Track height\n  ]);\n};\nvar mdia = (track, creationTime) => box(\"mdia\", null, [\n  mdhd(track, creationTime),\n  hdlr(track.info.type === \"video\" ? \"vide\" : \"soun\"),\n  minf(track)\n]);\nvar mdhd = (track, creationTime) => {\n  let lastSample = lastPresentedSample(track.samples);\n  let localDuration = intoTimescale(\n    lastSample ? lastSample.presentationTimestamp + lastSample.duration : 0,\n    track.timescale\n  );\n  let needsU64 = !isU32(creationTime) || !isU32(localDuration);\n  let u32OrU64 = needsU64 ? u64 : u32;\n  return fullBox(\"mdhd\", +needsU64, 0, [\n    u32OrU64(creationTime),\n    // Creation time\n    u32OrU64(creationTime),\n    // Modification time\n    u32(track.timescale),\n    // Timescale\n    u32OrU64(localDuration),\n    // Duration\n    u16(21956),\n    // Language (\"und\", undetermined)\n    u16(0)\n    // Quality\n  ]);\n};\nvar hdlr = (componentSubtype) => fullBox(\"hdlr\", 0, 0, [\n  ascii(\"mhlr\"),\n  // Component type\n  ascii(componentSubtype),\n  // Component subtype\n  u32(0),\n  // Component manufacturer\n  u32(0),\n  // Component flags\n  u32(0),\n  // Component flags mask\n  ascii(\"mp4-muxer-hdlr\", true)\n  // Component name\n]);\nvar minf = (track) => box(\"minf\", null, [\n  track.info.type === \"video\" ? vmhd() : smhd(),\n  dinf(),\n  stbl(track)\n]);\nvar vmhd = () => fullBox(\"vmhd\", 0, 1, [\n  u16(0),\n  // Graphics mode\n  u16(0),\n  // Opcolor R\n  u16(0),\n  // Opcolor G\n  u16(0)\n  // Opcolor B\n]);\nvar smhd = () => fullBox(\"smhd\", 0, 0, [\n  u16(0),\n  // Balance\n  u16(0)\n  // Reserved\n]);\nvar dinf = () => box(\"dinf\", null, [\n  dref()\n]);\nvar dref = () => fullBox(\"dref\", 0, 0, [\n  u32(1)\n  // Entry count\n], [\n  url()\n]);\nvar url = () => fullBox(\"url \", 0, 1);\nvar stbl = (track) => {\n  const needsCtts = track.compositionTimeOffsetTable.length > 1 || track.compositionTimeOffsetTable.some((x) => x.sampleCompositionTimeOffset !== 0);\n  return box(\"stbl\", null, [\n    stsd(track),\n    stts(track),\n    stss(track),\n    stsc(track),\n    stsz(track),\n    stco(track),\n    needsCtts ? ctts(track) : null\n  ]);\n};\nvar stsd = (track) => fullBox(\"stsd\", 0, 0, [\n  u32(1)\n  // Entry count\n], [\n  track.info.type === \"video\" ? videoSampleDescription(\n    VIDEO_CODEC_TO_BOX_NAME[track.info.codec],\n    track\n  ) : soundSampleDescription(\n    AUDIO_CODEC_TO_BOX_NAME[track.info.codec],\n    track\n  )\n]);\nvar videoSampleDescription = (compressionType, track) => box(compressionType, [\n  Array(6).fill(0),\n  // Reserved\n  u16(1),\n  // Data reference index\n  u16(0),\n  // Pre-defined\n  u16(0),\n  // Reserved\n  Array(12).fill(0),\n  // Pre-defined\n  u16(track.info.width),\n  // Width\n  u16(track.info.height),\n  // Height\n  u32(4718592),\n  // Horizontal resolution\n  u32(4718592),\n  // Vertical resolution\n  u32(0),\n  // Reserved\n  u16(1),\n  // Frame count\n  Array(32).fill(0),\n  // Compressor name\n  u16(24),\n  // Depth\n  i16(65535)\n  // Pre-defined\n], [\n  VIDEO_CODEC_TO_CONFIGURATION_BOX[track.info.codec](track),\n  track.info.decoderConfig.colorSpace ? colr(track) : null\n]);\nvar COLOR_PRIMARIES_MAP = {\n  \"bt709\": 1,\n  // ITU-R BT.709\n  \"bt470bg\": 5,\n  // ITU-R BT.470BG\n  \"smpte170m\": 6\n  // ITU-R BT.601 525 - SMPTE 170M\n};\nvar TRANSFER_CHARACTERISTICS_MAP = {\n  \"bt709\": 1,\n  // ITU-R BT.709\n  \"smpte170m\": 6,\n  // SMPTE 170M\n  \"iec61966-2-1\": 13\n  // IEC 61966-2-1\n};\nvar MATRIX_COEFFICIENTS_MAP = {\n  \"rgb\": 0,\n  // Identity\n  \"bt709\": 1,\n  // ITU-R BT.709\n  \"bt470bg\": 5,\n  // ITU-R BT.470BG\n  \"smpte170m\": 6\n  // SMPTE 170M\n};\nvar colr = (track) => box(\"colr\", [\n  ascii(\"nclx\"),\n  // Colour type\n  u16(COLOR_PRIMARIES_MAP[track.info.decoderConfig.colorSpace.primaries]),\n  // Colour primaries\n  u16(TRANSFER_CHARACTERISTICS_MAP[track.info.decoderConfig.colorSpace.transfer]),\n  // Transfer characteristics\n  u16(MATRIX_COEFFICIENTS_MAP[track.info.decoderConfig.colorSpace.matrix]),\n  // Matrix coefficients\n  u8((track.info.decoderConfig.colorSpace.fullRange ? 1 : 0) << 7)\n  // Full range flag\n]);\nvar avcC = (track) => track.info.decoderConfig && box(\"avcC\", [\n  // For AVC, description is an AVCDecoderConfigurationRecord, so nothing else to do here\n  ...new Uint8Array(track.info.decoderConfig.description)\n]);\nvar hvcC = (track) => track.info.decoderConfig && box(\"hvcC\", [\n  // For HEVC, description is a HEVCDecoderConfigurationRecord, so nothing else to do here\n  ...new Uint8Array(track.info.decoderConfig.description)\n]);\nvar vpcC = (track) => {\n  if (!track.info.decoderConfig) {\n    return null;\n  }\n  let decoderConfig = track.info.decoderConfig;\n  if (!decoderConfig.colorSpace) {\n    throw new Error(`'colorSpace' is required in the decoder config for VP9.`);\n  }\n  let parts = decoderConfig.codec.split(\".\");\n  let profile = Number(parts[1]);\n  let level = Number(parts[2]);\n  let bitDepth = Number(parts[3]);\n  let chromaSubsampling = 0;\n  let thirdByte = (bitDepth << 4) + (chromaSubsampling << 1) + Number(decoderConfig.colorSpace.fullRange);\n  let colourPrimaries = 2;\n  let transferCharacteristics = 2;\n  let matrixCoefficients = 2;\n  return fullBox(\"vpcC\", 1, 0, [\n    u8(profile),\n    // Profile\n    u8(level),\n    // Level\n    u8(thirdByte),\n    // Bit depth, chroma subsampling, full range\n    u8(colourPrimaries),\n    // Colour primaries\n    u8(transferCharacteristics),\n    // Transfer characteristics\n    u8(matrixCoefficients),\n    // Matrix coefficients\n    u16(0)\n    // Codec initialization data size\n  ]);\n};\nvar av1C = () => {\n  let marker = 1;\n  let version = 1;\n  let firstByte = (marker << 7) + version;\n  return box(\"av1C\", [\n    firstByte,\n    0,\n    0,\n    0\n  ]);\n};\nvar soundSampleDescription = (compressionType, track) => box(compressionType, [\n  Array(6).fill(0),\n  // Reserved\n  u16(1),\n  // Data reference index\n  u16(0),\n  // Version\n  u16(0),\n  // Revision level\n  u32(0),\n  // Vendor\n  u16(track.info.numberOfChannels),\n  // Number of channels\n  u16(16),\n  // Sample size (bits)\n  u16(0),\n  // Compression ID\n  u16(0),\n  // Packet size\n  fixed_16_16(track.info.sampleRate)\n  // Sample rate\n], [\n  AUDIO_CODEC_TO_CONFIGURATION_BOX[track.info.codec](track)\n]);\nvar esds = (track) => {\n  let description = new Uint8Array(track.info.decoderConfig.description);\n  return fullBox(\"esds\", 0, 0, [\n    // https://stackoverflow.com/a/54803118\n    u32(58753152),\n    // TAG(3) = Object Descriptor ([2])\n    u8(32 + description.byteLength),\n    // length of this OD (which includes the next 2 tags)\n    u16(1),\n    // ES_ID = 1\n    u8(0),\n    // flags etc = 0\n    u32(75530368),\n    // TAG(4) = ES Descriptor ([2]) embedded in above OD\n    u8(18 + description.byteLength),\n    // length of this ESD\n    u8(64),\n    // MPEG-4 Audio\n    u8(21),\n    // stream type(6bits)=5 audio, flags(2bits)=1\n    u24(0),\n    // 24bit buffer size\n    u32(130071),\n    // max bitrate\n    u32(130071),\n    // avg bitrate\n    u32(92307584),\n    // TAG(5) = ASC ([2],[3]) embedded in above OD\n    u8(description.byteLength),\n    // length\n    ...description,\n    u32(109084800),\n    // TAG(6)\n    u8(1),\n    // length\n    u8(2)\n    // data\n  ]);\n};\nvar dOps = (track) => {\n  let preskip = 3840;\n  let gain = 0;\n  const description = track.info.decoderConfig?.description;\n  if (description) {\n    if (description.byteLength < 18) {\n      throw new TypeError(\"Invalid decoder description provided for Opus; must be at least 18 bytes long.\");\n    }\n    const view2 = ArrayBuffer.isView(description) ? new DataView(description.buffer, description.byteOffset, description.byteLength) : new DataView(description);\n    preskip = view2.getUint16(10, true);\n    gain = view2.getInt16(14, true);\n  }\n  return box(\"dOps\", [\n    u8(0),\n    // Version\n    u8(track.info.numberOfChannels),\n    // OutputChannelCount\n    u16(preskip),\n    u32(track.info.sampleRate),\n    // InputSampleRate\n    fixed_8_8(gain),\n    // OutputGain\n    u8(0)\n    // ChannelMappingFamily\n  ]);\n};\nvar stts = (track) => {\n  return fullBox(\"stts\", 0, 0, [\n    u32(track.timeToSampleTable.length),\n    // Number of entries\n    track.timeToSampleTable.map((x) => [\n      // Time-to-sample table\n      u32(x.sampleCount),\n      // Sample count\n      u32(x.sampleDelta)\n      // Sample duration\n    ])\n  ]);\n};\nvar stss = (track) => {\n  if (track.samples.every((x) => x.type === \"key\"))\n    return null;\n  let keySamples = [...track.samples.entries()].filter(([, sample]) => sample.type === \"key\");\n  return fullBox(\"stss\", 0, 0, [\n    u32(keySamples.length),\n    // Number of entries\n    keySamples.map(([index]) => u32(index + 1))\n    // Sync sample table\n  ]);\n};\nvar stsc = (track) => {\n  return fullBox(\"stsc\", 0, 0, [\n    u32(track.compactlyCodedChunkTable.length),\n    // Number of entries\n    track.compactlyCodedChunkTable.map((x) => [\n      // Sample-to-chunk table\n      u32(x.firstChunk),\n      // First chunk\n      u32(x.samplesPerChunk),\n      // Samples per chunk\n      u32(1)\n      // Sample description index\n    ])\n  ]);\n};\nvar stsz = (track) => fullBox(\"stsz\", 0, 0, [\n  u32(0),\n  // Sample size (0 means non-constant size)\n  u32(track.samples.length),\n  // Number of entries\n  track.samples.map((x) => u32(x.size))\n  // Sample size table\n]);\nvar stco = (track) => {\n  if (track.finalizedChunks.length > 0 && last(track.finalizedChunks).offset >= 2 ** 32) {\n    return fullBox(\"co64\", 0, 0, [\n      u32(track.finalizedChunks.length),\n      // Number of entries\n      track.finalizedChunks.map((x) => u64(x.offset))\n      // Chunk offset table\n    ]);\n  }\n  return fullBox(\"stco\", 0, 0, [\n    u32(track.finalizedChunks.length),\n    // Number of entries\n    track.finalizedChunks.map((x) => u32(x.offset))\n    // Chunk offset table\n  ]);\n};\nvar ctts = (track) => {\n  return fullBox(\"ctts\", 0, 0, [\n    u32(track.compositionTimeOffsetTable.length),\n    // Number of entries\n    track.compositionTimeOffsetTable.map((x) => [\n      // Time-to-sample table\n      u32(x.sampleCount),\n      // Sample count\n      u32(x.sampleCompositionTimeOffset)\n      // Sample offset\n    ])\n  ]);\n};\nvar mvex = (tracks) => {\n  return box(\"mvex\", null, tracks.map(trex));\n};\nvar trex = (track) => {\n  return fullBox(\"trex\", 0, 0, [\n    u32(track.id),\n    // Track ID\n    u32(1),\n    // Default sample description index\n    u32(0),\n    // Default sample duration\n    u32(0),\n    // Default sample size\n    u32(0)\n    // Default sample flags\n  ]);\n};\nvar moof = (sequenceNumber, tracks) => {\n  return box(\"moof\", null, [\n    mfhd(sequenceNumber),\n    ...tracks.map(traf)\n  ]);\n};\nvar mfhd = (sequenceNumber) => {\n  return fullBox(\"mfhd\", 0, 0, [\n    u32(sequenceNumber)\n    // Sequence number\n  ]);\n};\nvar fragmentSampleFlags = (sample) => {\n  let byte1 = 0;\n  let byte2 = 0;\n  let byte3 = 0;\n  let byte4 = 0;\n  let sampleIsDifferenceSample = sample.type === \"delta\";\n  byte2 |= +sampleIsDifferenceSample;\n  if (sampleIsDifferenceSample) {\n    byte1 |= 1;\n  } else {\n    byte1 |= 2;\n  }\n  return byte1 << 24 | byte2 << 16 | byte3 << 8 | byte4;\n};\nvar traf = (track) => {\n  return box(\"traf\", null, [\n    tfhd(track),\n    tfdt(track),\n    trun(track)\n  ]);\n};\nvar tfhd = (track) => {\n  let tfFlags = 0;\n  tfFlags |= 8;\n  tfFlags |= 16;\n  tfFlags |= 32;\n  tfFlags |= 131072;\n  let referenceSample = track.currentChunk.samples[1] ?? track.currentChunk.samples[0];\n  let referenceSampleInfo = {\n    duration: referenceSample.timescaleUnitsToNextSample,\n    size: referenceSample.size,\n    flags: fragmentSampleFlags(referenceSample)\n  };\n  return fullBox(\"tfhd\", 0, tfFlags, [\n    u32(track.id),\n    // Track ID\n    u32(referenceSampleInfo.duration),\n    // Default sample duration\n    u32(referenceSampleInfo.size),\n    // Default sample size\n    u32(referenceSampleInfo.flags)\n    // Default sample flags\n  ]);\n};\nvar tfdt = (track) => {\n  return fullBox(\"tfdt\", 1, 0, [\n    u64(intoTimescale(track.currentChunk.startTimestamp, track.timescale))\n    // Base Media Decode Time\n  ]);\n};\nvar trun = (track) => {\n  let allSampleDurations = track.currentChunk.samples.map((x) => x.timescaleUnitsToNextSample);\n  let allSampleSizes = track.currentChunk.samples.map((x) => x.size);\n  let allSampleFlags = track.currentChunk.samples.map(fragmentSampleFlags);\n  let allSampleCompositionTimeOffsets = track.currentChunk.samples.map((x) => intoTimescale(x.presentationTimestamp - x.decodeTimestamp, track.timescale));\n  let uniqueSampleDurations = new Set(allSampleDurations);\n  let uniqueSampleSizes = new Set(allSampleSizes);\n  let uniqueSampleFlags = new Set(allSampleFlags);\n  let uniqueSampleCompositionTimeOffsets = new Set(allSampleCompositionTimeOffsets);\n  let firstSampleFlagsPresent = uniqueSampleFlags.size === 2 && allSampleFlags[0] !== allSampleFlags[1];\n  let sampleDurationPresent = uniqueSampleDurations.size > 1;\n  let sampleSizePresent = uniqueSampleSizes.size > 1;\n  let sampleFlagsPresent = !firstSampleFlagsPresent && uniqueSampleFlags.size > 1;\n  let sampleCompositionTimeOffsetsPresent = uniqueSampleCompositionTimeOffsets.size > 1 || [...uniqueSampleCompositionTimeOffsets].some((x) => x !== 0);\n  let flags = 0;\n  flags |= 1;\n  flags |= 4 * +firstSampleFlagsPresent;\n  flags |= 256 * +sampleDurationPresent;\n  flags |= 512 * +sampleSizePresent;\n  flags |= 1024 * +sampleFlagsPresent;\n  flags |= 2048 * +sampleCompositionTimeOffsetsPresent;\n  return fullBox(\"trun\", 1, flags, [\n    u32(track.currentChunk.samples.length),\n    // Sample count\n    u32(track.currentChunk.offset - track.currentChunk.moofOffset || 0),\n    // Data offset\n    firstSampleFlagsPresent ? u32(allSampleFlags[0]) : [],\n    track.currentChunk.samples.map((_, i) => [\n      sampleDurationPresent ? u32(allSampleDurations[i]) : [],\n      // Sample duration\n      sampleSizePresent ? u32(allSampleSizes[i]) : [],\n      // Sample size\n      sampleFlagsPresent ? u32(allSampleFlags[i]) : [],\n      // Sample flags\n      // Sample composition time offsets\n      sampleCompositionTimeOffsetsPresent ? i32(allSampleCompositionTimeOffsets[i]) : []\n    ])\n  ]);\n};\nvar mfra = (tracks) => {\n  return box(\"mfra\", null, [\n    ...tracks.map(tfra),\n    mfro()\n  ]);\n};\nvar tfra = (track, trackIndex) => {\n  let version = 1;\n  return fullBox(\"tfra\", version, 0, [\n    u32(track.id),\n    // Track ID\n    u32(63),\n    // This specifies that traf number, trun number and sample number are 32-bit ints\n    u32(track.finalizedChunks.length),\n    // Number of entries\n    track.finalizedChunks.map((chunk) => [\n      u64(intoTimescale(chunk.startTimestamp, track.timescale)),\n      // Time\n      u64(chunk.moofOffset),\n      // moof offset\n      u32(trackIndex + 1),\n      // traf number\n      u32(1),\n      // trun number\n      u32(1)\n      // Sample number\n    ])\n  ]);\n};\nvar mfro = () => {\n  return fullBox(\"mfro\", 0, 0, [\n    // This value needs to be overwritten manually from the outside, where the actual size of the enclosing mfra box\n    // is known\n    u32(0)\n    // Size\n  ]);\n};\nvar VIDEO_CODEC_TO_BOX_NAME = {\n  \"avc\": \"avc1\",\n  \"hevc\": \"hvc1\",\n  \"vp9\": \"vp09\",\n  \"av1\": \"av01\"\n};\nvar VIDEO_CODEC_TO_CONFIGURATION_BOX = {\n  \"avc\": avcC,\n  \"hevc\": hvcC,\n  \"vp9\": vpcC,\n  \"av1\": av1C\n};\nvar AUDIO_CODEC_TO_BOX_NAME = {\n  \"aac\": \"mp4a\",\n  \"opus\": \"Opus\"\n};\nvar AUDIO_CODEC_TO_CONFIGURATION_BOX = {\n  \"aac\": esds,\n  \"opus\": dOps\n};\n\n// src/target.ts\nvar isTarget = Symbol(\"isTarget\");\nvar Target = class {\n};\nisTarget;\nvar ArrayBufferTarget = class extends Target {\n  constructor() {\n    super(...arguments);\n    this.buffer = null;\n  }\n};\nvar StreamTarget = class extends Target {\n  constructor(options) {\n    super();\n    this.options = options;\n    if (typeof options !== \"object\") {\n      throw new TypeError(\"StreamTarget requires an options object to be passed to its constructor.\");\n    }\n    if (options.onData) {\n      if (typeof options.onData !== \"function\") {\n        throw new TypeError(\"options.onData, when provided, must be a function.\");\n      }\n      if (options.onData.length < 2) {\n        throw new TypeError(\n          \"options.onData, when provided, must be a function that takes in at least two arguments (data and position). Ignoring the position argument, which specifies the byte offset at which the data is to be written, can lead to broken outputs.\"\n        );\n      }\n    }\n    if (options.chunked !== void 0 && typeof options.chunked !== \"boolean\") {\n      throw new TypeError(\"options.chunked, when provided, must be a boolean.\");\n    }\n    if (options.chunkSize !== void 0 && (!Number.isInteger(options.chunkSize) || options.chunkSize < 1024)) {\n      throw new TypeError(\"options.chunkSize, when provided, must be an integer and not smaller than 1024.\");\n    }\n  }\n};\nvar FileSystemWritableFileStreamTarget = class extends Target {\n  constructor(stream, options) {\n    super();\n    this.stream = stream;\n    this.options = options;\n    if (!(stream instanceof FileSystemWritableFileStream)) {\n      throw new TypeError(\"FileSystemWritableFileStreamTarget requires a FileSystemWritableFileStream instance.\");\n    }\n    if (options !== void 0 && typeof options !== \"object\") {\n      throw new TypeError(\"FileSystemWritableFileStreamTarget's options, when provided, must be an object.\");\n    }\n    if (options) {\n      if (options.chunkSize !== void 0 && (!Number.isInteger(options.chunkSize) || options.chunkSize <= 0)) {\n        throw new TypeError(\"options.chunkSize, when provided, must be a positive integer\");\n      }\n    }\n  }\n};\n\n// src/writer.ts\nvar _helper, _helperView;\nvar Writer = class {\n  constructor() {\n    this.pos = 0;\n    __privateAdd(this, _helper, new Uint8Array(8));\n    __privateAdd(this, _helperView, new DataView(__privateGet(this, _helper).buffer));\n    /**\n     * Stores the position from the start of the file to where boxes elements have been written. This is used to\n     * rewrite/edit elements that were already added before, and to measure sizes of things.\n     */\n    this.offsets = /* @__PURE__ */ new WeakMap();\n  }\n  /** Sets the current position for future writes to a new one. */\n  seek(newPos) {\n    this.pos = newPos;\n  }\n  writeU32(value) {\n    __privateGet(this, _helperView).setUint32(0, value, false);\n    this.write(__privateGet(this, _helper).subarray(0, 4));\n  }\n  writeU64(value) {\n    __privateGet(this, _helperView).setUint32(0, Math.floor(value / 2 ** 32), false);\n    __privateGet(this, _helperView).setUint32(4, value, false);\n    this.write(__privateGet(this, _helper).subarray(0, 8));\n  }\n  writeAscii(text) {\n    for (let i = 0; i < text.length; i++) {\n      __privateGet(this, _helperView).setUint8(i % 8, text.charCodeAt(i));\n      if (i % 8 === 7)\n        this.write(__privateGet(this, _helper));\n    }\n    if (text.length % 8 !== 0) {\n      this.write(__privateGet(this, _helper).subarray(0, text.length % 8));\n    }\n  }\n  writeBox(box2) {\n    this.offsets.set(box2, this.pos);\n    if (box2.contents && !box2.children) {\n      this.writeBoxHeader(box2, box2.size ?? box2.contents.byteLength + 8);\n      this.write(box2.contents);\n    } else {\n      let startPos = this.pos;\n      this.writeBoxHeader(box2, 0);\n      if (box2.contents)\n        this.write(box2.contents);\n      if (box2.children) {\n        for (let child of box2.children)\n          if (child)\n            this.writeBox(child);\n      }\n      let endPos = this.pos;\n      let size = box2.size ?? endPos - startPos;\n      this.seek(startPos);\n      this.writeBoxHeader(box2, size);\n      this.seek(endPos);\n    }\n  }\n  writeBoxHeader(box2, size) {\n    this.writeU32(box2.largeSize ? 1 : size);\n    this.writeAscii(box2.type);\n    if (box2.largeSize)\n      this.writeU64(size);\n  }\n  measureBoxHeader(box2) {\n    return 8 + (box2.largeSize ? 8 : 0);\n  }\n  patchBox(box2) {\n    let endPos = this.pos;\n    this.seek(this.offsets.get(box2));\n    this.writeBox(box2);\n    this.seek(endPos);\n  }\n  measureBox(box2) {\n    if (box2.contents && !box2.children) {\n      let headerSize = this.measureBoxHeader(box2);\n      return headerSize + box2.contents.byteLength;\n    } else {\n      let result = this.measureBoxHeader(box2);\n      if (box2.contents)\n        result += box2.contents.byteLength;\n      if (box2.children) {\n        for (let child of box2.children)\n          if (child)\n            result += this.measureBox(child);\n      }\n      return result;\n    }\n  }\n};\n_helper = new WeakMap();\n_helperView = new WeakMap();\nvar _target, _buffer, _bytes, _maxPos, _ensureSize, ensureSize_fn;\nvar ArrayBufferTargetWriter = class extends Writer {\n  constructor(target) {\n    super();\n    __privateAdd(this, _ensureSize);\n    __privateAdd(this, _target, void 0);\n    __privateAdd(this, _buffer, new ArrayBuffer(2 ** 16));\n    __privateAdd(this, _bytes, new Uint8Array(__privateGet(this, _buffer)));\n    __privateAdd(this, _maxPos, 0);\n    __privateSet(this, _target, target);\n  }\n  write(data) {\n    __privateMethod(this, _ensureSize, ensureSize_fn).call(this, this.pos + data.byteLength);\n    __privateGet(this, _bytes).set(data, this.pos);\n    this.pos += data.byteLength;\n    __privateSet(this, _maxPos, Math.max(__privateGet(this, _maxPos), this.pos));\n  }\n  finalize() {\n    __privateMethod(this, _ensureSize, ensureSize_fn).call(this, this.pos);\n    __privateGet(this, _target).buffer = __privateGet(this, _buffer).slice(0, Math.max(__privateGet(this, _maxPos), this.pos));\n  }\n};\n_target = new WeakMap();\n_buffer = new WeakMap();\n_bytes = new WeakMap();\n_maxPos = new WeakMap();\n_ensureSize = new WeakSet();\nensureSize_fn = function(size) {\n  let newLength = __privateGet(this, _buffer).byteLength;\n  while (newLength < size)\n    newLength *= 2;\n  if (newLength === __privateGet(this, _buffer).byteLength)\n    return;\n  let newBuffer = new ArrayBuffer(newLength);\n  let newBytes = new Uint8Array(newBuffer);\n  newBytes.set(__privateGet(this, _bytes), 0);\n  __privateSet(this, _buffer, newBuffer);\n  __privateSet(this, _bytes, newBytes);\n};\nvar DEFAULT_CHUNK_SIZE = 2 ** 24;\nvar MAX_CHUNKS_AT_ONCE = 2;\nvar _target2, _sections, _chunked, _chunkSize, _chunks, _writeDataIntoChunks, writeDataIntoChunks_fn, _insertSectionIntoChunk, insertSectionIntoChunk_fn, _createChunk, createChunk_fn, _flushChunks, flushChunks_fn;\nvar StreamTargetWriter = class extends Writer {\n  constructor(target) {\n    super();\n    __privateAdd(this, _writeDataIntoChunks);\n    __privateAdd(this, _insertSectionIntoChunk);\n    __privateAdd(this, _createChunk);\n    __privateAdd(this, _flushChunks);\n    __privateAdd(this, _target2, void 0);\n    __privateAdd(this, _sections, []);\n    __privateAdd(this, _chunked, void 0);\n    __privateAdd(this, _chunkSize, void 0);\n    /**\n     * The data is divided up into fixed-size chunks, whose contents are first filled in RAM and then flushed out.\n     * A chunk is flushed if all of its contents have been written.\n     */\n    __privateAdd(this, _chunks, []);\n    __privateSet(this, _target2, target);\n    __privateSet(this, _chunked, target.options?.chunked ?? false);\n    __privateSet(this, _chunkSize, target.options?.chunkSize ?? DEFAULT_CHUNK_SIZE);\n  }\n  write(data) {\n    __privateGet(this, _sections).push({\n      data: data.slice(),\n      start: this.pos\n    });\n    this.pos += data.byteLength;\n  }\n  flush() {\n    if (__privateGet(this, _sections).length === 0)\n      return;\n    let chunks = [];\n    let sorted = [...__privateGet(this, _sections)].sort((a, b) => a.start - b.start);\n    chunks.push({\n      start: sorted[0].start,\n      size: sorted[0].data.byteLength\n    });\n    for (let i = 1; i < sorted.length; i++) {\n      let lastChunk = chunks[chunks.length - 1];\n      let section = sorted[i];\n      if (section.start <= lastChunk.start + lastChunk.size) {\n        lastChunk.size = Math.max(lastChunk.size, section.start + section.data.byteLength - lastChunk.start);\n      } else {\n        chunks.push({\n          start: section.start,\n          size: section.data.byteLength\n        });\n      }\n    }\n    for (let chunk of chunks) {\n      chunk.data = new Uint8Array(chunk.size);\n      for (let section of __privateGet(this, _sections)) {\n        if (chunk.start <= section.start && section.start < chunk.start + chunk.size) {\n          chunk.data.set(section.data, section.start - chunk.start);\n        }\n      }\n      if (__privateGet(this, _chunked)) {\n        __privateMethod(this, _writeDataIntoChunks, writeDataIntoChunks_fn).call(this, chunk.data, chunk.start);\n        __privateMethod(this, _flushChunks, flushChunks_fn).call(this);\n      } else {\n        __privateGet(this, _target2).options.onData?.(chunk.data, chunk.start);\n      }\n    }\n    __privateGet(this, _sections).length = 0;\n  }\n  finalize() {\n    if (__privateGet(this, _chunked)) {\n      __privateMethod(this, _flushChunks, flushChunks_fn).call(this, true);\n    }\n  }\n};\n_target2 = new WeakMap();\n_sections = new WeakMap();\n_chunked = new WeakMap();\n_chunkSize = new WeakMap();\n_chunks = new WeakMap();\n_writeDataIntoChunks = new WeakSet();\nwriteDataIntoChunks_fn = function(data, position) {\n  let chunkIndex = __privateGet(this, _chunks).findIndex((x) => x.start <= position && position < x.start + __privateGet(this, _chunkSize));\n  if (chunkIndex === -1)\n    chunkIndex = __privateMethod(this, _createChunk, createChunk_fn).call(this, position);\n  let chunk = __privateGet(this, _chunks)[chunkIndex];\n  let relativePosition = position - chunk.start;\n  let toWrite = data.subarray(0, Math.min(__privateGet(this, _chunkSize) - relativePosition, data.byteLength));\n  chunk.data.set(toWrite, relativePosition);\n  let section = {\n    start: relativePosition,\n    end: relativePosition + toWrite.byteLength\n  };\n  __privateMethod(this, _insertSectionIntoChunk, insertSectionIntoChunk_fn).call(this, chunk, section);\n  if (chunk.written[0].start === 0 && chunk.written[0].end === __privateGet(this, _chunkSize)) {\n    chunk.shouldFlush = true;\n  }\n  if (__privateGet(this, _chunks).length > MAX_CHUNKS_AT_ONCE) {\n    for (let i = 0; i < __privateGet(this, _chunks).length - 1; i++) {\n      __privateGet(this, _chunks)[i].shouldFlush = true;\n    }\n    __privateMethod(this, _flushChunks, flushChunks_fn).call(this);\n  }\n  if (toWrite.byteLength < data.byteLength) {\n    __privateMethod(this, _writeDataIntoChunks, writeDataIntoChunks_fn).call(this, data.subarray(toWrite.byteLength), position + toWrite.byteLength);\n  }\n};\n_insertSectionIntoChunk = new WeakSet();\ninsertSectionIntoChunk_fn = function(chunk, section) {\n  let low = 0;\n  let high = chunk.written.length - 1;\n  let index = -1;\n  while (low <= high) {\n    let mid = Math.floor(low + (high - low + 1) / 2);\n    if (chunk.written[mid].start <= section.start) {\n      low = mid + 1;\n      index = mid;\n    } else {\n      high = mid - 1;\n    }\n  }\n  chunk.written.splice(index + 1, 0, section);\n  if (index === -1 || chunk.written[index].end < section.start)\n    index++;\n  while (index < chunk.written.length - 1 && chunk.written[index].end >= chunk.written[index + 1].start) {\n    chunk.written[index].end = Math.max(chunk.written[index].end, chunk.written[index + 1].end);\n    chunk.written.splice(index + 1, 1);\n  }\n};\n_createChunk = new WeakSet();\ncreateChunk_fn = function(includesPosition) {\n  let start = Math.floor(includesPosition / __privateGet(this, _chunkSize)) * __privateGet(this, _chunkSize);\n  let chunk = {\n    start,\n    data: new Uint8Array(__privateGet(this, _chunkSize)),\n    written: [],\n    shouldFlush: false\n  };\n  __privateGet(this, _chunks).push(chunk);\n  __privateGet(this, _chunks).sort((a, b) => a.start - b.start);\n  return __privateGet(this, _chunks).indexOf(chunk);\n};\n_flushChunks = new WeakSet();\nflushChunks_fn = function(force = false) {\n  for (let i = 0; i < __privateGet(this, _chunks).length; i++) {\n    let chunk = __privateGet(this, _chunks)[i];\n    if (!chunk.shouldFlush && !force)\n      continue;\n    for (let section of chunk.written) {\n      __privateGet(this, _target2).options.onData?.(\n        chunk.data.subarray(section.start, section.end),\n        chunk.start + section.start\n      );\n    }\n    __privateGet(this, _chunks).splice(i--, 1);\n  }\n};\nvar FileSystemWritableFileStreamTargetWriter = class extends StreamTargetWriter {\n  constructor(target) {\n    super(new StreamTarget({\n      onData: (data, position) => target.stream.write({\n        type: \"write\",\n        data,\n        position\n      }),\n      chunked: true,\n      chunkSize: target.options?.chunkSize\n    }));\n  }\n};\n\n// src/muxer.ts\nvar GLOBAL_TIMESCALE = 1e3;\nvar SUPPORTED_VIDEO_CODECS = [\"avc\", \"hevc\", \"vp9\", \"av1\"];\nvar SUPPORTED_AUDIO_CODECS = [\"aac\", \"opus\"];\nvar TIMESTAMP_OFFSET = 2082844800;\nvar FIRST_TIMESTAMP_BEHAVIORS = [\"strict\", \"offset\", \"cross-track-offset\"];\nvar _options, _writer, _ftypSize, _mdat, _videoTrack, _audioTrack, _creationTime, _finalizedChunks, _nextFragmentNumber, _videoSampleQueue, _audioSampleQueue, _finalized, _validateOptions, validateOptions_fn, _writeHeader, writeHeader_fn, _computeMoovSizeUpperBound, computeMoovSizeUpperBound_fn, _prepareTracks, prepareTracks_fn, _generateMpeg4AudioSpecificConfig, generateMpeg4AudioSpecificConfig_fn, _createSampleForTrack, createSampleForTrack_fn, _addSampleToTrack, addSampleToTrack_fn, _validateTimestamp, validateTimestamp_fn, _finalizeCurrentChunk, finalizeCurrentChunk_fn, _finalizeFragment, finalizeFragment_fn, _maybeFlushStreamingTargetWriter, maybeFlushStreamingTargetWriter_fn, _ensureNotFinalized, ensureNotFinalized_fn;\nvar Muxer = class {\n  constructor(options) {\n    __privateAdd(this, _validateOptions);\n    __privateAdd(this, _writeHeader);\n    __privateAdd(this, _computeMoovSizeUpperBound);\n    __privateAdd(this, _prepareTracks);\n    // https://wiki.multimedia.cx/index.php/MPEG-4_Audio\n    __privateAdd(this, _generateMpeg4AudioSpecificConfig);\n    __privateAdd(this, _createSampleForTrack);\n    __privateAdd(this, _addSampleToTrack);\n    __privateAdd(this, _validateTimestamp);\n    __privateAdd(this, _finalizeCurrentChunk);\n    __privateAdd(this, _finalizeFragment);\n    __privateAdd(this, _maybeFlushStreamingTargetWriter);\n    __privateAdd(this, _ensureNotFinalized);\n    __privateAdd(this, _options, void 0);\n    __privateAdd(this, _writer, void 0);\n    __privateAdd(this, _ftypSize, void 0);\n    __privateAdd(this, _mdat, void 0);\n    __privateAdd(this, _videoTrack, null);\n    __privateAdd(this, _audioTrack, null);\n    __privateAdd(this, _creationTime, Math.floor(Date.now() / 1e3) + TIMESTAMP_OFFSET);\n    __privateAdd(this, _finalizedChunks, []);\n    // Fields for fragmented MP4:\n    __privateAdd(this, _nextFragmentNumber, 1);\n    __privateAdd(this, _videoSampleQueue, []);\n    __privateAdd(this, _audioSampleQueue, []);\n    __privateAdd(this, _finalized, false);\n    __privateMethod(this, _validateOptions, validateOptions_fn).call(this, options);\n    options.video = deepClone(options.video);\n    options.audio = deepClone(options.audio);\n    options.fastStart = deepClone(options.fastStart);\n    this.target = options.target;\n    __privateSet(this, _options, {\n      firstTimestampBehavior: \"strict\",\n      ...options\n    });\n    if (options.target instanceof ArrayBufferTarget) {\n      __privateSet(this, _writer, new ArrayBufferTargetWriter(options.target));\n    } else if (options.target instanceof StreamTarget) {\n      __privateSet(this, _writer, new StreamTargetWriter(options.target));\n    } else if (options.target instanceof FileSystemWritableFileStreamTarget) {\n      __privateSet(this, _writer, new FileSystemWritableFileStreamTargetWriter(options.target));\n    } else {\n      throw new Error(`Invalid target: ${options.target}`);\n    }\n    __privateMethod(this, _prepareTracks, prepareTracks_fn).call(this);\n    __privateMethod(this, _writeHeader, writeHeader_fn).call(this);\n  }\n  addVideoChunk(sample, meta, timestamp, compositionTimeOffset) {\n    if (!(sample instanceof EncodedVideoChunk)) {\n      throw new TypeError(\"addVideoChunk's first argument (sample) must be of type EncodedVideoChunk.\");\n    }\n    if (meta && typeof meta !== \"object\") {\n      throw new TypeError(\"addVideoChunk's second argument (meta), when provided, must be an object.\");\n    }\n    if (timestamp !== void 0 && (!Number.isFinite(timestamp) || timestamp < 0)) {\n      throw new TypeError(\n        \"addVideoChunk's third argument (timestamp), when provided, must be a non-negative real number.\"\n      );\n    }\n    if (compositionTimeOffset !== void 0 && !Number.isFinite(compositionTimeOffset)) {\n      throw new TypeError(\n        \"addVideoChunk's fourth argument (compositionTimeOffset), when provided, must be a real number.\"\n      );\n    }\n    let data = new Uint8Array(sample.byteLength);\n    sample.copyTo(data);\n    this.addVideoChunkRaw(\n      data,\n      sample.type,\n      timestamp ?? sample.timestamp,\n      sample.duration,\n      meta,\n      compositionTimeOffset\n    );\n  }\n  addVideoChunkRaw(data, type, timestamp, duration, meta, compositionTimeOffset) {\n    if (!(data instanceof Uint8Array)) {\n      throw new TypeError(\"addVideoChunkRaw's first argument (data) must be an instance of Uint8Array.\");\n    }\n    if (type !== \"key\" && type !== \"delta\") {\n      throw new TypeError(\"addVideoChunkRaw's second argument (type) must be either 'key' or 'delta'.\");\n    }\n    if (!Number.isFinite(timestamp) || timestamp < 0) {\n      throw new TypeError(\"addVideoChunkRaw's third argument (timestamp) must be a non-negative real number.\");\n    }\n    if (!Number.isFinite(duration) || duration < 0) {\n      throw new TypeError(\"addVideoChunkRaw's fourth argument (duration) must be a non-negative real number.\");\n    }\n    if (meta && typeof meta !== \"object\") {\n      throw new TypeError(\"addVideoChunkRaw's fifth argument (meta), when provided, must be an object.\");\n    }\n    if (compositionTimeOffset !== void 0 && !Number.isFinite(compositionTimeOffset)) {\n      throw new TypeError(\n        \"addVideoChunkRaw's sixth argument (compositionTimeOffset), when provided, must be a real number.\"\n      );\n    }\n    __privateMethod(this, _ensureNotFinalized, ensureNotFinalized_fn).call(this);\n    if (!__privateGet(this, _options).video)\n      throw new Error(\"No video track declared.\");\n    if (typeof __privateGet(this, _options).fastStart === \"object\" && __privateGet(this, _videoTrack).samples.length === __privateGet(this, _options).fastStart.expectedVideoChunks) {\n      throw new Error(`Cannot add more video chunks than specified in 'fastStart' (${__privateGet(this, _options).fastStart.expectedVideoChunks}).`);\n    }\n    let videoSample = __privateMethod(this, _createSampleForTrack, createSampleForTrack_fn).call(this, __privateGet(this, _videoTrack), data, type, timestamp, duration, meta, compositionTimeOffset);\n    if (__privateGet(this, _options).fastStart === \"fragmented\" && __privateGet(this, _audioTrack)) {\n      while (__privateGet(this, _audioSampleQueue).length > 0 && __privateGet(this, _audioSampleQueue)[0].decodeTimestamp <= videoSample.decodeTimestamp) {\n        let audioSample = __privateGet(this, _audioSampleQueue).shift();\n        __privateMethod(this, _addSampleToTrack, addSampleToTrack_fn).call(this, __privateGet(this, _audioTrack), audioSample);\n      }\n      if (videoSample.decodeTimestamp <= __privateGet(this, _audioTrack).lastDecodeTimestamp) {\n        __privateMethod(this, _addSampleToTrack, addSampleToTrack_fn).call(this, __privateGet(this, _videoTrack), videoSample);\n      } else {\n        __privateGet(this, _videoSampleQueue).push(videoSample);\n      }\n    } else {\n      __privateMethod(this, _addSampleToTrack, addSampleToTrack_fn).call(this, __privateGet(this, _videoTrack), videoSample);\n    }\n  }\n  addAudioChunk(sample, meta, timestamp) {\n    if (!(sample instanceof EncodedAudioChunk)) {\n      throw new TypeError(\"addAudioChunk's first argument (sample) must be of type EncodedAudioChunk.\");\n    }\n    if (meta && typeof meta !== \"object\") {\n      throw new TypeError(\"addAudioChunk's second argument (meta), when provided, must be an object.\");\n    }\n    if (timestamp !== void 0 && (!Number.isFinite(timestamp) || timestamp < 0)) {\n      throw new TypeError(\n        \"addAudioChunk's third argument (timestamp), when provided, must be a non-negative real number.\"\n      );\n    }\n    let data = new Uint8Array(sample.byteLength);\n    sample.copyTo(data);\n    this.addAudioChunkRaw(data, sample.type, timestamp ?? sample.timestamp, sample.duration, meta);\n  }\n  addAudioChunkRaw(data, type, timestamp, duration, meta) {\n    if (!(data instanceof Uint8Array)) {\n      throw new TypeError(\"addAudioChunkRaw's first argument (data) must be an instance of Uint8Array.\");\n    }\n    if (type !== \"key\" && type !== \"delta\") {\n      throw new TypeError(\"addAudioChunkRaw's second argument (type) must be either 'key' or 'delta'.\");\n    }\n    if (!Number.isFinite(timestamp) || timestamp < 0) {\n      throw new TypeError(\"addAudioChunkRaw's third argument (timestamp) must be a non-negative real number.\");\n    }\n    if (!Number.isFinite(duration) || duration < 0) {\n      throw new TypeError(\"addAudioChunkRaw's fourth argument (duration) must be a non-negative real number.\");\n    }\n    if (meta && typeof meta !== \"object\") {\n      throw new TypeError(\"addAudioChunkRaw's fifth argument (meta), when provided, must be an object.\");\n    }\n    __privateMethod(this, _ensureNotFinalized, ensureNotFinalized_fn).call(this);\n    if (!__privateGet(this, _options).audio)\n      throw new Error(\"No audio track declared.\");\n    if (typeof __privateGet(this, _options).fastStart === \"object\" && __privateGet(this, _audioTrack).samples.length === __privateGet(this, _options).fastStart.expectedAudioChunks) {\n      throw new Error(`Cannot add more audio chunks than specified in 'fastStart' (${__privateGet(this, _options).fastStart.expectedAudioChunks}).`);\n    }\n    let audioSample = __privateMethod(this, _createSampleForTrack, createSampleForTrack_fn).call(this, __privateGet(this, _audioTrack), data, type, timestamp, duration, meta);\n    if (__privateGet(this, _options).fastStart === \"fragmented\" && __privateGet(this, _videoTrack)) {\n      while (__privateGet(this, _videoSampleQueue).length > 0 && __privateGet(this, _videoSampleQueue)[0].decodeTimestamp <= audioSample.decodeTimestamp) {\n        let videoSample = __privateGet(this, _videoSampleQueue).shift();\n        __privateMethod(this, _addSampleToTrack, addSampleToTrack_fn).call(this, __privateGet(this, _videoTrack), videoSample);\n      }\n      if (audioSample.decodeTimestamp <= __privateGet(this, _videoTrack).lastDecodeTimestamp) {\n        __privateMethod(this, _addSampleToTrack, addSampleToTrack_fn).call(this, __privateGet(this, _audioTrack), audioSample);\n      } else {\n        __privateGet(this, _audioSampleQueue).push(audioSample);\n      }\n    } else {\n      __privateMethod(this, _addSampleToTrack, addSampleToTrack_fn).call(this, __privateGet(this, _audioTrack), audioSample);\n    }\n  }\n  /** Finalizes the file, making it ready for use. Must be called after all video and audio chunks have been added. */\n  finalize() {\n    if (__privateGet(this, _finalized)) {\n      throw new Error(\"Cannot finalize a muxer more than once.\");\n    }\n    if (__privateGet(this, _options).fastStart === \"fragmented\") {\n      for (let videoSample of __privateGet(this, _videoSampleQueue))\n        __privateMethod(this, _addSampleToTrack, addSampleToTrack_fn).call(this, __privateGet(this, _videoTrack), videoSample);\n      for (let audioSample of __privateGet(this, _audioSampleQueue))\n        __privateMethod(this, _addSampleToTrack, addSampleToTrack_fn).call(this, __privateGet(this, _audioTrack), audioSample);\n      __privateMethod(this, _finalizeFragment, finalizeFragment_fn).call(this, false);\n    } else {\n      if (__privateGet(this, _videoTrack))\n        __privateMethod(this, _finalizeCurrentChunk, finalizeCurrentChunk_fn).call(this, __privateGet(this, _videoTrack));\n      if (__privateGet(this, _audioTrack))\n        __privateMethod(this, _finalizeCurrentChunk, finalizeCurrentChunk_fn).call(this, __privateGet(this, _audioTrack));\n    }\n    let tracks = [__privateGet(this, _videoTrack), __privateGet(this, _audioTrack)].filter(Boolean);\n    if (__privateGet(this, _options).fastStart === \"in-memory\") {\n      let mdatSize;\n      for (let i = 0; i < 2; i++) {\n        let movieBox2 = moov(tracks, __privateGet(this, _creationTime));\n        let movieBoxSize = __privateGet(this, _writer).measureBox(movieBox2);\n        mdatSize = __privateGet(this, _writer).measureBox(__privateGet(this, _mdat));\n        let currentChunkPos = __privateGet(this, _writer).pos + movieBoxSize + mdatSize;\n        for (let chunk of __privateGet(this, _finalizedChunks)) {\n          chunk.offset = currentChunkPos;\n          for (let { data } of chunk.samples) {\n            currentChunkPos += data.byteLength;\n            mdatSize += data.byteLength;\n          }\n        }\n        if (currentChunkPos < 2 ** 32)\n          break;\n        if (mdatSize >= 2 ** 32)\n          __privateGet(this, _mdat).largeSize = true;\n      }\n      let movieBox = moov(tracks, __privateGet(this, _creationTime));\n      __privateGet(this, _writer).writeBox(movieBox);\n      __privateGet(this, _mdat).size = mdatSize;\n      __privateGet(this, _writer).writeBox(__privateGet(this, _mdat));\n      for (let chunk of __privateGet(this, _finalizedChunks)) {\n        for (let sample of chunk.samples) {\n          __privateGet(this, _writer).write(sample.data);\n          sample.data = null;\n        }\n      }\n    } else if (__privateGet(this, _options).fastStart === \"fragmented\") {\n      let startPos = __privateGet(this, _writer).pos;\n      let mfraBox = mfra(tracks);\n      __privateGet(this, _writer).writeBox(mfraBox);\n      let mfraBoxSize = __privateGet(this, _writer).pos - startPos;\n      __privateGet(this, _writer).seek(__privateGet(this, _writer).pos - 4);\n      __privateGet(this, _writer).writeU32(mfraBoxSize);\n    } else {\n      let mdatPos = __privateGet(this, _writer).offsets.get(__privateGet(this, _mdat));\n      let mdatSize = __privateGet(this, _writer).pos - mdatPos;\n      __privateGet(this, _mdat).size = mdatSize;\n      __privateGet(this, _mdat).largeSize = mdatSize >= 2 ** 32;\n      __privateGet(this, _writer).patchBox(__privateGet(this, _mdat));\n      let movieBox = moov(tracks, __privateGet(this, _creationTime));\n      if (typeof __privateGet(this, _options).fastStart === \"object\") {\n        __privateGet(this, _writer).seek(__privateGet(this, _ftypSize));\n        __privateGet(this, _writer).writeBox(movieBox);\n        let remainingBytes = mdatPos - __privateGet(this, _writer).pos;\n        __privateGet(this, _writer).writeBox(free(remainingBytes));\n      } else {\n        __privateGet(this, _writer).writeBox(movieBox);\n      }\n    }\n    __privateMethod(this, _maybeFlushStreamingTargetWriter, maybeFlushStreamingTargetWriter_fn).call(this);\n    __privateGet(this, _writer).finalize();\n    __privateSet(this, _finalized, true);\n  }\n};\n_options = new WeakMap();\n_writer = new WeakMap();\n_ftypSize = new WeakMap();\n_mdat = new WeakMap();\n_videoTrack = new WeakMap();\n_audioTrack = new WeakMap();\n_creationTime = new WeakMap();\n_finalizedChunks = new WeakMap();\n_nextFragmentNumber = new WeakMap();\n_videoSampleQueue = new WeakMap();\n_audioSampleQueue = new WeakMap();\n_finalized = new WeakMap();\n_validateOptions = new WeakSet();\nvalidateOptions_fn = function(options) {\n  if (typeof options !== \"object\") {\n    throw new TypeError(\"The muxer requires an options object to be passed to its constructor.\");\n  }\n  if (!(options.target instanceof Target)) {\n    throw new TypeError(\"The target must be provided and an instance of Target.\");\n  }\n  if (options.video) {\n    if (!SUPPORTED_VIDEO_CODECS.includes(options.video.codec)) {\n      throw new TypeError(`Unsupported video codec: ${options.video.codec}`);\n    }\n    if (!Number.isInteger(options.video.width) || options.video.width <= 0) {\n      throw new TypeError(`Invalid video width: ${options.video.width}. Must be a positive integer.`);\n    }\n    if (!Number.isInteger(options.video.height) || options.video.height <= 0) {\n      throw new TypeError(`Invalid video height: ${options.video.height}. Must be a positive integer.`);\n    }\n    const videoRotation = options.video.rotation;\n    if (typeof videoRotation === \"number\" && ![0, 90, 180, 270].includes(videoRotation)) {\n      throw new TypeError(`Invalid video rotation: ${videoRotation}. Has to be 0, 90, 180 or 270.`);\n    } else if (Array.isArray(videoRotation) && (videoRotation.length !== 9 || videoRotation.some((value) => typeof value !== \"number\"))) {\n      throw new TypeError(`Invalid video transformation matrix: ${videoRotation.join()}`);\n    }\n    if (options.video.frameRate !== void 0 && (!Number.isInteger(options.video.frameRate) || options.video.frameRate <= 0)) {\n      throw new TypeError(\n        `Invalid video frame rate: ${options.video.frameRate}. Must be a positive integer.`\n      );\n    }\n  }\n  if (options.audio) {\n    if (!SUPPORTED_AUDIO_CODECS.includes(options.audio.codec)) {\n      throw new TypeError(`Unsupported audio codec: ${options.audio.codec}`);\n    }\n    if (!Number.isInteger(options.audio.numberOfChannels) || options.audio.numberOfChannels <= 0) {\n      throw new TypeError(\n        `Invalid number of audio channels: ${options.audio.numberOfChannels}. Must be a positive integer.`\n      );\n    }\n    if (!Number.isInteger(options.audio.sampleRate) || options.audio.sampleRate <= 0) {\n      throw new TypeError(\n        `Invalid audio sample rate: ${options.audio.sampleRate}. Must be a positive integer.`\n      );\n    }\n  }\n  if (options.firstTimestampBehavior && !FIRST_TIMESTAMP_BEHAVIORS.includes(options.firstTimestampBehavior)) {\n    throw new TypeError(`Invalid first timestamp behavior: ${options.firstTimestampBehavior}`);\n  }\n  if (typeof options.fastStart === \"object\") {\n    if (options.video) {\n      if (options.fastStart.expectedVideoChunks === void 0) {\n        throw new TypeError(`'fastStart' is an object but is missing property 'expectedVideoChunks'.`);\n      } else if (!Number.isInteger(options.fastStart.expectedVideoChunks) || options.fastStart.expectedVideoChunks < 0) {\n        throw new TypeError(`'expectedVideoChunks' must be a non-negative integer.`);\n      }\n    }\n    if (options.audio) {\n      if (options.fastStart.expectedAudioChunks === void 0) {\n        throw new TypeError(`'fastStart' is an object but is missing property 'expectedAudioChunks'.`);\n      } else if (!Number.isInteger(options.fastStart.expectedAudioChunks) || options.fastStart.expectedAudioChunks < 0) {\n        throw new TypeError(`'expectedAudioChunks' must be a non-negative integer.`);\n      }\n    }\n  } else if (![false, \"in-memory\", \"fragmented\"].includes(options.fastStart)) {\n    throw new TypeError(`'fastStart' option must be false, 'in-memory', 'fragmented' or an object.`);\n  }\n  if (options.minFragmentDuration !== void 0 && (!Number.isFinite(options.minFragmentDuration) || options.minFragmentDuration < 0)) {\n    throw new TypeError(`'minFragmentDuration' must be a non-negative number.`);\n  }\n};\n_writeHeader = new WeakSet();\nwriteHeader_fn = function() {\n  __privateGet(this, _writer).writeBox(ftyp({\n    holdsAvc: __privateGet(this, _options).video?.codec === \"avc\",\n    fragmented: __privateGet(this, _options).fastStart === \"fragmented\"\n  }));\n  __privateSet(this, _ftypSize, __privateGet(this, _writer).pos);\n  if (__privateGet(this, _options).fastStart === \"in-memory\") {\n    __privateSet(this, _mdat, mdat(false));\n  } else if (__privateGet(this, _options).fastStart === \"fragmented\") {\n  } else {\n    if (typeof __privateGet(this, _options).fastStart === \"object\") {\n      let moovSizeUpperBound = __privateMethod(this, _computeMoovSizeUpperBound, computeMoovSizeUpperBound_fn).call(this);\n      __privateGet(this, _writer).seek(__privateGet(this, _writer).pos + moovSizeUpperBound);\n    }\n    __privateSet(this, _mdat, mdat(true));\n    __privateGet(this, _writer).writeBox(__privateGet(this, _mdat));\n  }\n  __privateMethod(this, _maybeFlushStreamingTargetWriter, maybeFlushStreamingTargetWriter_fn).call(this);\n};\n_computeMoovSizeUpperBound = new WeakSet();\ncomputeMoovSizeUpperBound_fn = function() {\n  if (typeof __privateGet(this, _options).fastStart !== \"object\")\n    return;\n  let upperBound = 0;\n  let sampleCounts = [\n    __privateGet(this, _options).fastStart.expectedVideoChunks,\n    __privateGet(this, _options).fastStart.expectedAudioChunks\n  ];\n  for (let n of sampleCounts) {\n    if (!n)\n      continue;\n    upperBound += (4 + 4) * Math.ceil(2 / 3 * n);\n    upperBound += 4 * n;\n    upperBound += (4 + 4 + 4) * Math.ceil(2 / 3 * n);\n    upperBound += 4 * n;\n    upperBound += 8 * n;\n  }\n  upperBound += 4096;\n  return upperBound;\n};\n_prepareTracks = new WeakSet();\nprepareTracks_fn = function() {\n  if (__privateGet(this, _options).video) {\n    __privateSet(this, _videoTrack, {\n      id: 1,\n      info: {\n        type: \"video\",\n        codec: __privateGet(this, _options).video.codec,\n        width: __privateGet(this, _options).video.width,\n        height: __privateGet(this, _options).video.height,\n        rotation: __privateGet(this, _options).video.rotation ?? 0,\n        decoderConfig: null\n      },\n      // The fallback contains many common frame rates as factors\n      timescale: __privateGet(this, _options).video.frameRate ?? 57600,\n      samples: [],\n      finalizedChunks: [],\n      currentChunk: null,\n      firstDecodeTimestamp: void 0,\n      lastDecodeTimestamp: -1,\n      timeToSampleTable: [],\n      compositionTimeOffsetTable: [],\n      lastTimescaleUnits: null,\n      lastSample: null,\n      compactlyCodedChunkTable: []\n    });\n  }\n  if (__privateGet(this, _options).audio) {\n    __privateSet(this, _audioTrack, {\n      id: __privateGet(this, _options).video ? 2 : 1,\n      info: {\n        type: \"audio\",\n        codec: __privateGet(this, _options).audio.codec,\n        numberOfChannels: __privateGet(this, _options).audio.numberOfChannels,\n        sampleRate: __privateGet(this, _options).audio.sampleRate,\n        decoderConfig: null\n      },\n      timescale: __privateGet(this, _options).audio.sampleRate,\n      samples: [],\n      finalizedChunks: [],\n      currentChunk: null,\n      firstDecodeTimestamp: void 0,\n      lastDecodeTimestamp: -1,\n      timeToSampleTable: [],\n      compositionTimeOffsetTable: [],\n      lastTimescaleUnits: null,\n      lastSample: null,\n      compactlyCodedChunkTable: []\n    });\n    if (__privateGet(this, _options).audio.codec === \"aac\") {\n      let guessedCodecPrivate = __privateMethod(this, _generateMpeg4AudioSpecificConfig, generateMpeg4AudioSpecificConfig_fn).call(\n        this,\n        2,\n        // Object type for AAC-LC, since it's the most common\n        __privateGet(this, _options).audio.sampleRate,\n        __privateGet(this, _options).audio.numberOfChannels\n      );\n      __privateGet(this, _audioTrack).info.decoderConfig = {\n        codec: __privateGet(this, _options).audio.codec,\n        description: guessedCodecPrivate,\n        numberOfChannels: __privateGet(this, _options).audio.numberOfChannels,\n        sampleRate: __privateGet(this, _options).audio.sampleRate\n      };\n    }\n  }\n};\n_generateMpeg4AudioSpecificConfig = new WeakSet();\ngenerateMpeg4AudioSpecificConfig_fn = function(objectType, sampleRate, numberOfChannels) {\n  let frequencyIndices = [96e3, 88200, 64e3, 48e3, 44100, 32e3, 24e3, 22050, 16e3, 12e3, 11025, 8e3, 7350];\n  let frequencyIndex = frequencyIndices.indexOf(sampleRate);\n  let channelConfig = numberOfChannels;\n  let configBits = \"\";\n  configBits += objectType.toString(2).padStart(5, \"0\");\n  configBits += frequencyIndex.toString(2).padStart(4, \"0\");\n  if (frequencyIndex === 15)\n    configBits += sampleRate.toString(2).padStart(24, \"0\");\n  configBits += channelConfig.toString(2).padStart(4, \"0\");\n  let paddingLength = Math.ceil(configBits.length / 8) * 8;\n  configBits = configBits.padEnd(paddingLength, \"0\");\n  let configBytes = new Uint8Array(configBits.length / 8);\n  for (let i = 0; i < configBits.length; i += 8) {\n    configBytes[i / 8] = parseInt(configBits.slice(i, i + 8), 2);\n  }\n  return configBytes;\n};\n_createSampleForTrack = new WeakSet();\ncreateSampleForTrack_fn = function(track, data, type, timestamp, duration, meta, compositionTimeOffset) {\n  let presentationTimestampInSeconds = timestamp / 1e6;\n  let decodeTimestampInSeconds = (timestamp - (compositionTimeOffset ?? 0)) / 1e6;\n  let durationInSeconds = duration / 1e6;\n  let adjusted = __privateMethod(this, _validateTimestamp, validateTimestamp_fn).call(this, presentationTimestampInSeconds, decodeTimestampInSeconds, track);\n  presentationTimestampInSeconds = adjusted.presentationTimestamp;\n  decodeTimestampInSeconds = adjusted.decodeTimestamp;\n  if (meta?.decoderConfig) {\n    if (track.info.decoderConfig === null) {\n      track.info.decoderConfig = meta.decoderConfig;\n    } else {\n      Object.assign(track.info.decoderConfig, meta.decoderConfig);\n    }\n  }\n  let sample = {\n    presentationTimestamp: presentationTimestampInSeconds,\n    decodeTimestamp: decodeTimestampInSeconds,\n    duration: durationInSeconds,\n    data,\n    size: data.byteLength,\n    type,\n    // Will be refined once the next sample comes in\n    timescaleUnitsToNextSample: intoTimescale(durationInSeconds, track.timescale)\n  };\n  return sample;\n};\n_addSampleToTrack = new WeakSet();\naddSampleToTrack_fn = function(track, sample) {\n  if (__privateGet(this, _options).fastStart !== \"fragmented\") {\n    track.samples.push(sample);\n  }\n  const sampleCompositionTimeOffset = intoTimescale(sample.presentationTimestamp - sample.decodeTimestamp, track.timescale);\n  if (track.lastTimescaleUnits !== null) {\n    let timescaleUnits = intoTimescale(sample.decodeTimestamp, track.timescale, false);\n    let delta = Math.round(timescaleUnits - track.lastTimescaleUnits);\n    track.lastTimescaleUnits += delta;\n    track.lastSample.timescaleUnitsToNextSample = delta;\n    if (__privateGet(this, _options).fastStart !== \"fragmented\") {\n      let lastTableEntry = last(track.timeToSampleTable);\n      if (lastTableEntry.sampleCount === 1) {\n        lastTableEntry.sampleDelta = delta;\n        lastTableEntry.sampleCount++;\n      } else if (lastTableEntry.sampleDelta === delta) {\n        lastTableEntry.sampleCount++;\n      } else {\n        lastTableEntry.sampleCount--;\n        track.timeToSampleTable.push({\n          sampleCount: 2,\n          sampleDelta: delta\n        });\n      }\n      const lastCompositionTimeOffsetTableEntry = last(track.compositionTimeOffsetTable);\n      if (lastCompositionTimeOffsetTableEntry.sampleCompositionTimeOffset === sampleCompositionTimeOffset) {\n        lastCompositionTimeOffsetTableEntry.sampleCount++;\n      } else {\n        track.compositionTimeOffsetTable.push({\n          sampleCount: 1,\n          sampleCompositionTimeOffset\n        });\n      }\n    }\n  } else {\n    track.lastTimescaleUnits = 0;\n    if (__privateGet(this, _options).fastStart !== \"fragmented\") {\n      track.timeToSampleTable.push({\n        sampleCount: 1,\n        sampleDelta: intoTimescale(sample.duration, track.timescale)\n      });\n      track.compositionTimeOffsetTable.push({\n        sampleCount: 1,\n        sampleCompositionTimeOffset\n      });\n    }\n  }\n  track.lastSample = sample;\n  let beginNewChunk = false;\n  if (!track.currentChunk) {\n    beginNewChunk = true;\n  } else {\n    let currentChunkDuration = sample.presentationTimestamp - track.currentChunk.startTimestamp;\n    if (__privateGet(this, _options).fastStart === \"fragmented\") {\n      let mostImportantTrack = __privateGet(this, _videoTrack) ?? __privateGet(this, _audioTrack);\n      const chunkDuration = __privateGet(this, _options).minFragmentDuration ?? 1;\n      if (track === mostImportantTrack && sample.type === \"key\" && currentChunkDuration >= chunkDuration) {\n        beginNewChunk = true;\n        __privateMethod(this, _finalizeFragment, finalizeFragment_fn).call(this);\n      }\n    } else {\n      beginNewChunk = currentChunkDuration >= 0.5;\n    }\n  }\n  if (beginNewChunk) {\n    if (track.currentChunk) {\n      __privateMethod(this, _finalizeCurrentChunk, finalizeCurrentChunk_fn).call(this, track);\n    }\n    track.currentChunk = {\n      startTimestamp: sample.presentationTimestamp,\n      samples: []\n    };\n  }\n  track.currentChunk.samples.push(sample);\n};\n_validateTimestamp = new WeakSet();\nvalidateTimestamp_fn = function(presentationTimestamp, decodeTimestamp, track) {\n  const strictTimestampBehavior = __privateGet(this, _options).firstTimestampBehavior === \"strict\";\n  const noLastDecodeTimestamp = track.lastDecodeTimestamp === -1;\n  const timestampNonZero = decodeTimestamp !== 0;\n  if (strictTimestampBehavior && noLastDecodeTimestamp && timestampNonZero) {\n    throw new Error(\n      `The first chunk for your media track must have a timestamp of 0 (received DTS=${decodeTimestamp}).Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of thedocument, which is probably what you want.\n\nIf you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.\n`\n    );\n  } else if (__privateGet(this, _options).firstTimestampBehavior === \"offset\" || __privateGet(this, _options).firstTimestampBehavior === \"cross-track-offset\") {\n    if (track.firstDecodeTimestamp === void 0) {\n      track.firstDecodeTimestamp = decodeTimestamp;\n    }\n    let baseDecodeTimestamp;\n    if (__privateGet(this, _options).firstTimestampBehavior === \"offset\") {\n      baseDecodeTimestamp = track.firstDecodeTimestamp;\n    } else {\n      baseDecodeTimestamp = Math.min(\n        __privateGet(this, _videoTrack)?.firstDecodeTimestamp ?? Infinity,\n        __privateGet(this, _audioTrack)?.firstDecodeTimestamp ?? Infinity\n      );\n    }\n    decodeTimestamp -= baseDecodeTimestamp;\n    presentationTimestamp -= baseDecodeTimestamp;\n  }\n  if (decodeTimestamp < track.lastDecodeTimestamp) {\n    throw new Error(\n      `Timestamps must be monotonically increasing (DTS went from ${track.lastDecodeTimestamp * 1e6} to ${decodeTimestamp * 1e6}).`\n    );\n  }\n  track.lastDecodeTimestamp = decodeTimestamp;\n  return { presentationTimestamp, decodeTimestamp };\n};\n_finalizeCurrentChunk = new WeakSet();\nfinalizeCurrentChunk_fn = function(track) {\n  if (__privateGet(this, _options).fastStart === \"fragmented\") {\n    throw new Error(\"Can't finalize individual chunks if 'fastStart' is set to 'fragmented'.\");\n  }\n  if (!track.currentChunk)\n    return;\n  track.finalizedChunks.push(track.currentChunk);\n  __privateGet(this, _finalizedChunks).push(track.currentChunk);\n  if (track.compactlyCodedChunkTable.length === 0 || last(track.compactlyCodedChunkTable).samplesPerChunk !== track.currentChunk.samples.length) {\n    track.compactlyCodedChunkTable.push({\n      firstChunk: track.finalizedChunks.length,\n      // 1-indexed\n      samplesPerChunk: track.currentChunk.samples.length\n    });\n  }\n  if (__privateGet(this, _options).fastStart === \"in-memory\") {\n    track.currentChunk.offset = 0;\n    return;\n  }\n  track.currentChunk.offset = __privateGet(this, _writer).pos;\n  for (let sample of track.currentChunk.samples) {\n    __privateGet(this, _writer).write(sample.data);\n    sample.data = null;\n  }\n  __privateMethod(this, _maybeFlushStreamingTargetWriter, maybeFlushStreamingTargetWriter_fn).call(this);\n};\n_finalizeFragment = new WeakSet();\nfinalizeFragment_fn = function(flushStreamingWriter = true) {\n  if (__privateGet(this, _options).fastStart !== \"fragmented\") {\n    throw new Error(\"Can't finalize a fragment unless 'fastStart' is set to 'fragmented'.\");\n  }\n  let tracks = [__privateGet(this, _videoTrack), __privateGet(this, _audioTrack)].filter((track) => track && track.currentChunk);\n  if (tracks.length === 0)\n    return;\n  let fragmentNumber = __privateWrapper(this, _nextFragmentNumber)._++;\n  if (fragmentNumber === 1) {\n    let movieBox = moov(tracks, __privateGet(this, _creationTime), true);\n    __privateGet(this, _writer).writeBox(movieBox);\n  }\n  let moofOffset = __privateGet(this, _writer).pos;\n  let moofBox = moof(fragmentNumber, tracks);\n  __privateGet(this, _writer).writeBox(moofBox);\n  {\n    let mdatBox = mdat(false);\n    let totalTrackSampleSize = 0;\n    for (let track of tracks) {\n      for (let sample of track.currentChunk.samples) {\n        totalTrackSampleSize += sample.size;\n      }\n    }\n    let mdatSize = __privateGet(this, _writer).measureBox(mdatBox) + totalTrackSampleSize;\n    if (mdatSize >= 2 ** 32) {\n      mdatBox.largeSize = true;\n      mdatSize = __privateGet(this, _writer).measureBox(mdatBox) + totalTrackSampleSize;\n    }\n    mdatBox.size = mdatSize;\n    __privateGet(this, _writer).writeBox(mdatBox);\n  }\n  for (let track of tracks) {\n    track.currentChunk.offset = __privateGet(this, _writer).pos;\n    track.currentChunk.moofOffset = moofOffset;\n    for (let sample of track.currentChunk.samples) {\n      __privateGet(this, _writer).write(sample.data);\n      sample.data = null;\n    }\n  }\n  let endPos = __privateGet(this, _writer).pos;\n  __privateGet(this, _writer).seek(__privateGet(this, _writer).offsets.get(moofBox));\n  let newMoofBox = moof(fragmentNumber, tracks);\n  __privateGet(this, _writer).writeBox(newMoofBox);\n  __privateGet(this, _writer).seek(endPos);\n  for (let track of tracks) {\n    track.finalizedChunks.push(track.currentChunk);\n    __privateGet(this, _finalizedChunks).push(track.currentChunk);\n    track.currentChunk = null;\n  }\n  if (flushStreamingWriter) {\n    __privateMethod(this, _maybeFlushStreamingTargetWriter, maybeFlushStreamingTargetWriter_fn).call(this);\n  }\n};\n_maybeFlushStreamingTargetWriter = new WeakSet();\nmaybeFlushStreamingTargetWriter_fn = function() {\n  if (__privateGet(this, _writer) instanceof StreamTargetWriter) {\n    __privateGet(this, _writer).flush();\n  }\n};\n_ensureNotFinalized = new WeakSet();\nensureNotFinalized_fn = function() {\n  if (__privateGet(this, _finalized)) {\n    throw new Error(\"Cannot add new video or audio chunks after the file has been finalized.\");\n  }\n};\nexport {\n  ArrayBufferTarget,\n  FileSystemWritableFileStreamTarget,\n  Muxer,\n  StreamTarget\n};\n","import { Pair } from 'bitecs';\r\nimport { Muxer, ArrayBufferTarget } from 'mp4-muxer';\r\nimport { Sequence, SequenceState, Tween, TweenState, ChildOf, type State } from '@multiplekex/shallot';\r\nimport { StepTransition, type RecordSequenceConfig } from '@blog-components/sequence';\r\n\r\nfunction setCanvasSize(canvas: HTMLCanvasElement, width: number, height: number): void {\r\n  const dpr = window.devicePixelRatio || 1;\r\n  canvas.style.width = `${width / dpr}px`;\r\n  canvas.style.height = `${height / dpr}px`;\r\n  canvas.width = width;\r\n  canvas.height = height;\r\n}\r\n\r\nfunction findSequenceForTransition(state: State, from: number, to: number): number | null {\r\n  for (const eid of state.query([Sequence, StepTransition])) {\r\n    if (StepTransition.from[eid] === from && StepTransition.to[eid] === to) {\r\n      return eid;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function setupCanvasRecording(canvas: HTMLCanvasElement, state: State): void {\r\n  canvas.__recordSequence__ = async (\r\n    config: RecordSequenceConfig,\r\n    onProgress?: (frame: number, total: number) => void\r\n  ): Promise<Blob | null> => {\r\n    const seqEid = findSequenceForTransition(state, config.fromStep, config.toStep);\r\n    if (seqEid === null) return null;\r\n\r\n    const origWidth = canvas.width;\r\n    const origHeight = canvas.height;\r\n    const origStyle = canvas.style.cssText;\r\n\r\n    setCanvasSize(canvas, config.width, config.height);\r\n    await new Promise((r) => requestAnimationFrame(r));\r\n\r\n    Sequence.state[seqEid] = SequenceState.IDLE;\r\n    Sequence.elapsed[seqEid] = 0;\r\n    for (const childEid of state.query([Pair(ChildOf.relation, seqEid), Tween])) {\r\n      Tween.state[childEid] = TweenState.IDLE;\r\n      Tween.elapsed[childEid] = 0;\r\n    }\r\n    Sequence.state[seqEid] = SequenceState.PLAYING;\r\n\r\n    let maxDuration = 0;\r\n    for (const childEid of state.query([Pair(ChildOf.relation, seqEid), Tween])) {\r\n      maxDuration = Math.max(maxDuration, Tween.duration[childEid]);\r\n    }\r\n    const duration = maxDuration + 0.1;\r\n    const totalFrames = Math.ceil(duration * config.fps);\r\n\r\n    const muxer = new Muxer({\r\n      target: new ArrayBufferTarget(),\r\n      video: { codec: 'avc', width: config.width, height: config.height },\r\n      fastStart: 'in-memory',\r\n    });\r\n\r\n    const encoder = new VideoEncoder({\r\n      output: (chunk, meta) => muxer.addVideoChunk(chunk, meta),\r\n      error: (e) => console.error('Encoder error:', e),\r\n    });\r\n\r\n    encoder.configure({\r\n      codec: 'avc1.640032',\r\n      width: config.width,\r\n      height: config.height,\r\n      bitrate: config.bitrate,\r\n      framerate: config.fps,\r\n    });\r\n\r\n    const stepTime = 1 / config.fps;\r\n\r\n    for (let i = 0; i < totalFrames; i++) {\r\n      setCanvasSize(canvas, config.width, config.height);\r\n      state.step(stepTime);\r\n\r\n      const videoFrame = new VideoFrame(canvas, {\r\n        timestamp: (i * 1_000_000) / config.fps,\r\n      });\r\n      encoder.encode(videoFrame);\r\n      videoFrame.close();\r\n\r\n      if (i % 30 === 0) {\r\n        onProgress?.(i, totalFrames);\r\n        await new Promise((r) => setTimeout(r, 0));\r\n      }\r\n    }\r\n\r\n    await encoder.flush();\r\n    muxer.finalize();\r\n\r\n    canvas.width = origWidth;\r\n    canvas.height = origHeight;\r\n    canvas.style.cssText = origStyle;\r\n\r\n    return new Blob([muxer.target.buffer], { type: 'video/mp4' });\r\n  };\r\n}\r\n","// Speculative Decoding Color Scheme\r\n// Scientific visualization palette with warm/cool semantic distinction\r\n\r\n// === MODEL PAIR (Complementary: Navy vs Amber) ===\r\n// Target: Cool navy = slow, authoritative, \"ground truth\"\r\n// Draft: Warm amber = fast, speculative, \"educated guess\"\r\nexport const TARGET_MODEL = 0x2a4a6d; // Deep navy (H210)\r\nexport const DRAFT_MODEL = 0xb8864a;  // Warm amber (H35) - distinct hue\r\n\r\n// === DATA PAIR (Teal/Green family, H155-180) ===\r\n// Input: teal, Output: green-teal (shows transformation)\r\nexport const INPUT = 0x6b9ea0;        // Muted teal (H182)\r\nexport const INPUT_TEXT = 0x4a7072;   // Darker teal for readability\r\n\r\nexport const OUTPUT = 0x5aaa8f;       // Green-teal (H155) - \"generated\"\r\nexport const OUTPUT_TEXT = 0x3d7560;  // Darker green for readability\r\n\r\n// === DISTRIBUTION ANALYSIS ===\r\nexport const MIN_REGION = 0x14b8a6;  // Teal - common ground between draft/target\r\n\r\n// === VALIDATION ===\r\nexport const VALID = 0x3fb87a;       // Soft sage-green - correct prediction\r\nexport const INVALID = 0xdc5858;     // Soft coral - incorrect prediction\r\n\r\n// === SUPPORTING ===\r\nexport const LINE = 0x6b7280;\r\nexport const LINE_ACTIVE = 0x4b5563;\r\nexport const SURFACE = 0xffffff;\r\nexport const SURFACE_ALT = 0xf8f9fa;\r\nexport const TEXT = 0x212529;\r\n\r\n// Hex string versions for CSS\r\nexport const hex = {\r\n  targetModel: '#2a4a6d',\r\n  draftModel: '#b8864a',\r\n  input: '#6b9ea0',\r\n  inputText: '#4a7072',\r\n  output: '#5aaa8f',\r\n  outputText: '#3d7560',\r\n  minRegion: '#14b8a6',\r\n  line: '#6b7280',\r\n  lineActive: '#4b5563',\r\n  surface: '#ffffff',\r\n  surfaceAlt: '#f8f9fa',\r\n  text: '#212529',\r\n} as const;\r\n","import { setTraits, ChildOf, Pair, Transform, type Plugin, type State, type System } from '@multiplekex/shallot';\r\nimport { Line, Text } from '@multiplekex/shallot/extras';\r\nimport { LINE } from './colors';\r\n\r\nexport const Border = {\r\n  padding: [] as number[],\r\n  color: [] as number[],\r\n  thickness: [] as number[],\r\n  transition: [] as number[],\r\n};\r\n\r\nsetTraits(Border, {\r\n  defaults: () => ({\r\n    padding: 0.15,\r\n    color: LINE,\r\n    thickness: 2,\r\n    transition: 1,\r\n  }),\r\n});\r\n\r\nexport const BorderLine = {};\r\n\r\nconst CHAR_WIDTH_RATIO = 0.55;\r\n\r\nconst BorderSystem: System = {\r\n  group: 'simulation',\r\n  update(state: State) {\r\n    for (const eid of state.query([Border, Text, Transform])) {\r\n      const content = Text.content[eid] ?? '';\r\n      const fontSize = Text.fontSize[eid] || 1;\r\n      const padding = Border.padding[eid];\r\n      const color = Border.color[eid];\r\n      const thickness = Border.thickness[eid];\r\n      const t = Math.min(1, Border.transition[eid]);\r\n\r\n      const textWidth = content.length * fontSize * CHAR_WIDTH_RATIO;\r\n      const textHeight = fontSize;\r\n\r\n      const w = textWidth / 2 + padding;\r\n      const h = textHeight / 2 + padding;\r\n\r\n      const existingLines = [...state.query([Pair(ChildOf.relation, eid), BorderLine, Line])];\r\n\r\n      if (existingLines.length === 0) {\r\n        for (let i = 0; i < 4; i++) {\r\n          const lineEid = state.addEntity();\r\n          state.addComponent(lineEid, Transform);\r\n          state.addComponent(lineEid, Line);\r\n          state.addComponent(lineEid, BorderLine);\r\n          state.addComponent(lineEid, Pair(ChildOf.relation, eid));\r\n\r\n          Line.color[lineEid] = color;\r\n          Line.thickness[lineEid] = thickness;\r\n          Line.visible[lineEid] = 1;\r\n          Line.opacity[lineEid] = 1;\r\n        }\r\n      }\r\n\r\n      const lines = [...state.query([Pair(ChildOf.relation, eid), BorderLine, Line])];\r\n\r\n      // Bottom line (local coords relative to parent)\r\n      Transform.posX[lines[0]] = -w;\r\n      Transform.posY[lines[0]] = -h;\r\n      Transform.posZ[lines[0]] = 0;\r\n      Line.offsetX[lines[0]] = w * 2 * t;\r\n      Line.offsetY[lines[0]] = 0;\r\n      Line.offsetZ[lines[0]] = 0;\r\n\r\n      // Top line\r\n      Transform.posX[lines[1]] = -w;\r\n      Transform.posY[lines[1]] = h;\r\n      Transform.posZ[lines[1]] = 0;\r\n      Line.offsetX[lines[1]] = w * 2 * t;\r\n      Line.offsetY[lines[1]] = 0;\r\n      Line.offsetZ[lines[1]] = 0;\r\n\r\n      // Left line\r\n      Transform.posX[lines[2]] = -w;\r\n      Transform.posY[lines[2]] = -h;\r\n      Transform.posZ[lines[2]] = 0;\r\n      Line.offsetX[lines[2]] = 0;\r\n      Line.offsetY[lines[2]] = h * 2 * t;\r\n      Line.offsetZ[lines[2]] = 0;\r\n\r\n      // Right line\r\n      Transform.posX[lines[3]] = w;\r\n      Transform.posY[lines[3]] = -h;\r\n      Transform.posZ[lines[3]] = 0;\r\n      Line.offsetX[lines[3]] = 0;\r\n      Line.offsetY[lines[3]] = h * 2 * t;\r\n      Line.offsetZ[lines[3]] = 0;\r\n    }\r\n  },\r\n};\r\n\r\nexport const BorderPlugin: Plugin = {\r\n  components: { Border, BorderLine },\r\n  systems: [BorderSystem],\r\n};\r\n","import { setTraits, ChildOf, Pair, Transform, Mesh, MeshShape, defineRelation, type Plugin, type State, type System } from '@multiplekex/shallot';\r\nimport { TARGET_MODEL, DRAFT_MODEL, VALID, INVALID } from './colors';\r\n\r\nexport const ProbabilityDistribution = {\r\n  barCount: [] as number[],\r\n  transition: [] as number[],\r\n  blend: [] as number[],\r\n  smoothness: [] as number[],\r\n  comparisonTransition: [] as number[],\r\n  comparisonZ: [] as number[],\r\n  acceptanceTransition: [] as number[],\r\n  acceptanceYOffset: [] as number[],\r\n  acceptanceSize: [] as number[],\r\n  residualTransition: [] as number[],\r\n  minTransition: [] as number[],\r\n  excessDraftTransition: [] as number[],\r\n  excessTargetTransition: [] as number[],\r\n  transferProgress: [] as number[],\r\n};\r\n\r\nsetTraits(ProbabilityDistribution, {\r\n  defaults: () => ({\r\n    barCount: 5,\r\n    transition: 1,\r\n    blend: 0,\r\n    smoothness: 0.15,\r\n    comparisonTransition: 0,\r\n    comparisonZ: -0.5,\r\n    acceptanceTransition: 0,\r\n    acceptanceYOffset: 0.5,\r\n    acceptanceSize: 0.35,\r\n    residualTransition: 0,\r\n    minTransition: 0,\r\n    excessDraftTransition: 0,\r\n    excessTargetTransition: 0,\r\n    transferProgress: 0,\r\n  }),\r\n});\r\n\r\nexport const DistributionBar = {\r\n  index: [] as number[],\r\n  probability: [] as number[],\r\n  goalProbability: [] as number[],\r\n};\r\n\r\nsetTraits(DistributionBar, {\r\n  defaults: () => ({\r\n    index: 0,\r\n    probability: 0.2,\r\n    goalProbability: 0.2,\r\n  }),\r\n});\r\n\r\nconst DistributionBarOwner = defineRelation('distribution-bar-owner', { exclusive: true });\r\nconst ComparisonBarOwner = defineRelation('comparison-bar-owner', { exclusive: true });\r\nconst AcceptanceMarkerOwner = defineRelation('acceptance-marker-owner', { exclusive: true });\r\nconst ResidualBarOwner = defineRelation('residual-bar-owner', { exclusive: true });\r\nconst MinBarOwner = defineRelation('min-bar-owner', { exclusive: true });\r\nconst ExcessDraftBarOwner = defineRelation('excess-draft-bar-owner', { exclusive: true });\r\nconst ExcessTargetBarOwner = defineRelation('excess-target-bar-owner', { exclusive: true });\r\n\r\nexport const AcceptanceMarker = {\r\n  index: [] as number[],\r\n};\r\n\r\nsetTraits(AcceptanceMarker, {\r\n  defaults: () => ({\r\n    index: 0,\r\n  }),\r\n});\r\n\r\nexport const BarHighlight = {\r\n  distribution: [] as number[],\r\n  barIndex: [] as number[],\r\n  yOffset: [] as number[],\r\n};\r\n\r\nsetTraits(BarHighlight, {\r\n  defaults: () => ({\r\n    distribution: 0,\r\n    barIndex: 0,\r\n    yOffset: 0.7,\r\n  }),\r\n});\r\n\r\nconst targetDistributions = new Map<number, number[]>();\r\nconst draftDistributions = new Map<number, number[]>();\r\n\r\nexport function setDistributionProbabilities(distEid: number, targetProbs: number[], draftProbs?: number[]): void {\r\n  targetDistributions.set(distEid, targetProbs);\r\n  if (draftProbs) {\r\n    draftDistributions.set(distEid, draftProbs);\r\n  }\r\n}\r\n\r\nfunction lerpColor(c1: number, c2: number, t: number): number {\r\n  const r1 = (c1 >> 16) & 0xff;\r\n  const g1 = (c1 >> 8) & 0xff;\r\n  const b1 = c1 & 0xff;\r\n  const r2 = (c2 >> 16) & 0xff;\r\n  const g2 = (c2 >> 8) & 0xff;\r\n  const b2 = c2 & 0xff;\r\n  const r = Math.round(r1 + (r2 - r1) * t);\r\n  const g = Math.round(g1 + (g2 - g1) * t);\r\n  const b = Math.round(b1 + (b2 - b1) * t);\r\n  return (r << 16) | (g << 8) | b;\r\n}\r\n\r\nconst RED = 0xdc5858;\r\nconst YELLOW = 0xe5a040;\r\nconst GREEN = 0x3fb87a;\r\n\r\nfunction acceptanceColor(acceptance: number): number {\r\n  // Nonlinear: yellow at 90%, making lower acceptance more obvious\r\n  if (acceptance < 0.9) {\r\n    return lerpColor(RED, YELLOW, acceptance / 0.9);\r\n  } else {\r\n    return lerpColor(YELLOW, GREEN, (acceptance - 0.9) / 0.1);\r\n  }\r\n}\r\n\r\nconst CHART_WIDTH = 8;\r\nconst MAX_HEIGHT = 5.5;\r\n\r\nfunction smoothLerp(smoothness: number, dt: number): number {\r\n  const s = Math.max(0, Math.min(1, smoothness));\r\n  return 1 - Math.pow(1 - s, dt * 60);\r\n}\r\n\r\nconst ProbabilityDistributionSystem: System = {\r\n  group: 'simulation',\r\n  update(state: State) {\r\n    const dt = state.time.deltaTime;\r\n\r\n    for (const distEid of state.query([ProbabilityDistribution, Transform])) {\r\n      const barCount = ProbabilityDistribution.barCount[distEid];\r\n      const transition = ProbabilityDistribution.transition[distEid];\r\n      const blend = ProbabilityDistribution.blend[distEid];\r\n      const smoothness = ProbabilityDistribution.smoothness[distEid];\r\n      const comparisonTransition = ProbabilityDistribution.comparisonTransition[distEid];\r\n      const comparisonZ = ProbabilityDistribution.comparisonZ[distEid];\r\n\r\n      const existingBars = [...state.query([Pair(DistributionBarOwner.relation, distEid), DistributionBar, Mesh, Transform])];\r\n\r\n      while (existingBars.length < barCount) {\r\n        const barEid = state.addEntity();\r\n        state.addComponent(barEid, Transform);\r\n        state.addComponent(barEid, Mesh);\r\n        state.addComponent(barEid, DistributionBar);\r\n        state.addComponent(barEid, Pair(ChildOf.relation, distEid));\r\n        state.addComponent(barEid, Pair(DistributionBarOwner.relation, distEid));\r\n\r\n        Mesh.shape[barEid] = MeshShape.Box;\r\n        DistributionBar.index[barEid] = existingBars.length;\r\n        existingBars.push(barEid);\r\n      }\r\n\r\n      const barSpacing = CHART_WIDTH / barCount;\r\n      const barWidth = barSpacing * 0.7;\r\n      const startX = -CHART_WIDTH / 2 + barSpacing / 2;\r\n\r\n      const targetProbs = targetDistributions.get(distEid);\r\n      const draftProbs = draftDistributions.get(distEid);\r\n      const t = smoothLerp(smoothness, dt);\r\n      const color = lerpColor(TARGET_MODEL, DRAFT_MODEL, blend);\r\n\r\n      for (let i = 0; i < barCount; i++) {\r\n        const barEid = existingBars[i];\r\n\r\n        const targetP = targetProbs && targetProbs.length > i ? targetProbs[i] : 0.2;\r\n        const draftP = draftProbs && draftProbs.length > i ? draftProbs[i] : targetP;\r\n        const goalP = targetP + (draftP - targetP) * blend;\r\n\r\n        DistributionBar.goalProbability[barEid] = goalP;\r\n        DistributionBar.probability[barEid] += (goalP - DistributionBar.probability[barEid]) * t;\r\n\r\n        const probability = DistributionBar.probability[barEid];\r\n        const height = Math.max(0.05, probability * MAX_HEIGHT);\r\n\r\n        Transform.posX[barEid] = startX + i * barSpacing;\r\n        Transform.posY[barEid] = (height / 2) * transition;\r\n        Transform.posZ[barEid] = 0;\r\n\r\n        Mesh.sizeX[barEid] = barWidth * transition;\r\n        Mesh.sizeY[barEid] = height * transition;\r\n        Mesh.sizeZ[barEid] = barWidth * transition;\r\n\r\n        Mesh.color[barEid] = color;\r\n      }\r\n\r\n      const existingComparisonBars = [...state.query([Pair(ComparisonBarOwner.relation, distEid), Mesh, Transform])];\r\n\r\n      if (comparisonTransition > 0) {\r\n        while (existingComparisonBars.length < barCount) {\r\n          const barEid = state.addEntity();\r\n          state.addComponent(barEid, Transform);\r\n          state.addComponent(barEid, Mesh);\r\n          state.addComponent(barEid, Pair(ChildOf.relation, distEid));\r\n          state.addComponent(barEid, Pair(ComparisonBarOwner.relation, distEid));\r\n          Mesh.shape[barEid] = MeshShape.Box;\r\n          existingComparisonBars.push(barEid);\r\n        }\r\n\r\n        for (let i = 0; i < barCount; i++) {\r\n          const compBarEid = existingComparisonBars[i];\r\n          const targetP = targetProbs && targetProbs.length > i ? targetProbs[i] : 0.2;\r\n          const height = Math.max(0.05, targetP * MAX_HEIGHT);\r\n\r\n          Transform.posX[compBarEid] = startX + i * barSpacing;\r\n          Transform.posY[compBarEid] = (height / 2) * comparisonTransition;\r\n          Transform.posZ[compBarEid] = comparisonZ;\r\n\r\n          Mesh.sizeX[compBarEid] = barWidth * comparisonTransition;\r\n          Mesh.sizeY[compBarEid] = height * comparisonTransition;\r\n          Mesh.sizeZ[compBarEid] = barWidth * comparisonTransition;\r\n\r\n          Mesh.color[compBarEid] = TARGET_MODEL;\r\n        }\r\n      } else {\r\n        for (const compBarEid of existingComparisonBars) {\r\n          Mesh.sizeX[compBarEid] = 0;\r\n          Mesh.sizeY[compBarEid] = 0;\r\n          Mesh.sizeZ[compBarEid] = 0;\r\n        }\r\n      }\r\n\r\n      const acceptanceTransition = ProbabilityDistribution.acceptanceTransition[distEid];\r\n      const acceptanceYOffset = ProbabilityDistribution.acceptanceYOffset[distEid];\r\n      const acceptanceSize = ProbabilityDistribution.acceptanceSize[distEid];\r\n\r\n      const existingMarkers = [...state.query([Pair(AcceptanceMarkerOwner.relation, distEid), AcceptanceMarker, Mesh, Transform])];\r\n\r\n      if (acceptanceTransition > 0) {\r\n        while (existingMarkers.length < barCount) {\r\n          const markerEid = state.addEntity();\r\n          state.addComponent(markerEid, Transform);\r\n          state.addComponent(markerEid, Mesh);\r\n          state.addComponent(markerEid, AcceptanceMarker);\r\n          state.addComponent(markerEid, Pair(ChildOf.relation, distEid));\r\n          state.addComponent(markerEid, Pair(AcceptanceMarkerOwner.relation, distEid));\r\n          Mesh.shape[markerEid] = MeshShape.Sphere;\r\n          AcceptanceMarker.index[markerEid] = existingMarkers.length;\r\n          existingMarkers.push(markerEid);\r\n        }\r\n\r\n        for (let i = 0; i < barCount; i++) {\r\n          const markerEid = existingMarkers[i];\r\n          const targetP = targetProbs && targetProbs.length > i ? targetProbs[i] : 0.2;\r\n          const draftP = draftProbs && draftProbs.length > i ? draftProbs[i] : targetP;\r\n          const maxHeight = Math.max(targetP, draftP) * MAX_HEIGHT;\r\n          const acceptance = draftP > 0 ? Math.min(1, targetP / draftP) : 1;\r\n\r\n          Transform.posX[markerEid] = startX + i * barSpacing;\r\n          Transform.posY[markerEid] = maxHeight + acceptanceYOffset;\r\n          Transform.posZ[markerEid] = comparisonZ / 2;\r\n\r\n          const scaledSize = acceptanceSize * acceptanceTransition;\r\n          Mesh.sizeX[markerEid] = scaledSize;\r\n          Mesh.sizeY[markerEid] = scaledSize;\r\n          Mesh.sizeZ[markerEid] = scaledSize;\r\n\r\n          Mesh.color[markerEid] = acceptanceColor(acceptance);\r\n        }\r\n      } else {\r\n        for (const markerEid of existingMarkers) {\r\n          Mesh.sizeX[markerEid] = 0;\r\n          Mesh.sizeY[markerEid] = 0;\r\n          Mesh.sizeZ[markerEid] = 0;\r\n        }\r\n      }\r\n\r\n      const residualTransition = ProbabilityDistribution.residualTransition[distEid];\r\n      const existingResidualBars = [...state.query([Pair(ResidualBarOwner.relation, distEid), Mesh, Transform])];\r\n\r\n      if (residualTransition > 0) {\r\n        while (existingResidualBars.length < barCount) {\r\n          const barEid = state.addEntity();\r\n          state.addComponent(barEid, Transform);\r\n          state.addComponent(barEid, Mesh);\r\n          state.addComponent(barEid, Pair(ChildOf.relation, distEid));\r\n          state.addComponent(barEid, Pair(ResidualBarOwner.relation, distEid));\r\n          Mesh.shape[barEid] = MeshShape.Box;\r\n          existingResidualBars.push(barEid);\r\n        }\r\n\r\n        for (let i = 0; i < barCount; i++) {\r\n          const barEid = existingResidualBars[i];\r\n          const targetP = targetProbs && targetProbs.length > i ? targetProbs[i] : 0.2;\r\n          const draftP = draftProbs && draftProbs.length > i ? draftProbs[i] : targetP;\r\n          const residualP = Math.max(0, targetP - draftP);\r\n\r\n          if (residualP <= 0.001) {\r\n            Mesh.sizeX[barEid] = 0;\r\n            Mesh.sizeY[barEid] = 0;\r\n            Mesh.sizeZ[barEid] = 0;\r\n            continue;\r\n          }\r\n\r\n          const height = residualP * MAX_HEIGHT * residualTransition;\r\n\r\n          Transform.posX[barEid] = startX + i * barSpacing;\r\n          Transform.posY[barEid] = height / 2;\r\n          Transform.posZ[barEid] = 0.5;\r\n\r\n          Mesh.sizeX[barEid] = barWidth * residualTransition;\r\n          Mesh.sizeY[barEid] = height;\r\n          Mesh.sizeZ[barEid] = barWidth * residualTransition;\r\n\r\n          Mesh.color[barEid] = 0x9333ea;\r\n        }\r\n      } else {\r\n        for (const barEid of existingResidualBars) {\r\n          Mesh.sizeX[barEid] = 0;\r\n          Mesh.sizeY[barEid] = 0;\r\n          Mesh.sizeZ[barEid] = 0;\r\n        }\r\n      }\r\n\r\n      // Min bars (green/accepted) - from y=0 to min(draft, target)\r\n      const minTransition = ProbabilityDistribution.minTransition[distEid];\r\n      const existingMinBars = [...state.query([Pair(MinBarOwner.relation, distEid), Mesh, Transform])];\r\n\r\n      if (minTransition > 0) {\r\n        while (existingMinBars.length < barCount) {\r\n          const barEid = state.addEntity();\r\n          state.addComponent(barEid, Transform);\r\n          state.addComponent(barEid, Mesh);\r\n          state.addComponent(barEid, Pair(ChildOf.relation, distEid));\r\n          state.addComponent(barEid, Pair(MinBarOwner.relation, distEid));\r\n          Mesh.shape[barEid] = MeshShape.Box;\r\n          existingMinBars.push(barEid);\r\n        }\r\n\r\n        for (let i = 0; i < barCount; i++) {\r\n          const barEid = existingMinBars[i];\r\n          const targetP = targetProbs && targetProbs.length > i ? targetProbs[i] : 0.2;\r\n          const draftP = draftProbs && draftProbs.length > i ? draftProbs[i] : targetP;\r\n          const minP = Math.min(targetP, draftP);\r\n\r\n          const height = Math.max(0.05, minP * MAX_HEIGHT * minTransition);\r\n\r\n          Transform.posX[barEid] = startX + i * barSpacing;\r\n          Transform.posY[barEid] = height / 2;\r\n          Transform.posZ[barEid] = 0;\r\n\r\n          Mesh.sizeX[barEid] = barWidth * minTransition;\r\n          Mesh.sizeY[barEid] = height;\r\n          Mesh.sizeZ[barEid] = barWidth * minTransition;\r\n\r\n          Mesh.color[barEid] = VALID;\r\n        }\r\n      } else {\r\n        for (const barEid of existingMinBars) {\r\n          Mesh.sizeX[barEid] = 0;\r\n          Mesh.sizeY[barEid] = 0;\r\n          Mesh.sizeZ[barEid] = 0;\r\n        }\r\n      }\r\n\r\n      // Excess draft bars (red/rejected) - from y=min to y=draft when draft > target\r\n      const excessDraftTransition = ProbabilityDistribution.excessDraftTransition[distEid];\r\n      const transferProgress = ProbabilityDistribution.transferProgress[distEid];\r\n      const existingExcessDraftBars = [...state.query([Pair(ExcessDraftBarOwner.relation, distEid), Mesh, Transform])];\r\n\r\n      if (excessDraftTransition > 0) {\r\n        while (existingExcessDraftBars.length < barCount) {\r\n          const barEid = state.addEntity();\r\n          state.addComponent(barEid, Transform);\r\n          state.addComponent(barEid, Mesh);\r\n          state.addComponent(barEid, Pair(ChildOf.relation, distEid));\r\n          state.addComponent(barEid, Pair(ExcessDraftBarOwner.relation, distEid));\r\n          Mesh.shape[barEid] = MeshShape.Box;\r\n          existingExcessDraftBars.push(barEid);\r\n        }\r\n\r\n        for (let i = 0; i < barCount; i++) {\r\n          const barEid = existingExcessDraftBars[i];\r\n          const targetP = targetProbs && targetProbs.length > i ? targetProbs[i] : 0.2;\r\n          const draftP = draftProbs && draftProbs.length > i ? draftProbs[i] : targetP;\r\n          const minP = Math.min(targetP, draftP);\r\n          const excessP = Math.max(0, draftP - targetP);\r\n\r\n          if (excessP <= 0.001) {\r\n            Mesh.sizeX[barEid] = 0;\r\n            Mesh.sizeY[barEid] = 0;\r\n            Mesh.sizeZ[barEid] = 0;\r\n            continue;\r\n          }\r\n\r\n          // Smooth fade out as transfer progresses - scale all dimensions\r\n          const fadeScale = 1 - transferProgress;\r\n          const height = excessP * MAX_HEIGHT * excessDraftTransition * fadeScale;\r\n          const baseHeight = minP * MAX_HEIGHT;\r\n          const widthScale = barWidth * excessDraftTransition * fadeScale;\r\n\r\n          Transform.posX[barEid] = startX + i * barSpacing;\r\n          Transform.posY[barEid] = baseHeight + height / 2;\r\n          Transform.posZ[barEid] = 0;\r\n\r\n          Mesh.sizeX[barEid] = widthScale;\r\n          Mesh.sizeY[barEid] = height;\r\n          Mesh.sizeZ[barEid] = widthScale;\r\n\r\n          Mesh.color[barEid] = INVALID;\r\n        }\r\n      } else {\r\n        for (const barEid of existingExcessDraftBars) {\r\n          Mesh.sizeX[barEid] = 0;\r\n          Mesh.sizeY[barEid] = 0;\r\n          Mesh.sizeZ[barEid] = 0;\r\n        }\r\n      }\r\n\r\n      // Excess target bars (purple) - from y=min to y=target when target > draft\r\n      const excessTargetTransition = ProbabilityDistribution.excessTargetTransition[distEid];\r\n      const existingExcessTargetBars = [...state.query([Pair(ExcessTargetBarOwner.relation, distEid), Mesh, Transform])];\r\n\r\n      if (excessTargetTransition > 0) {\r\n        while (existingExcessTargetBars.length < barCount) {\r\n          const barEid = state.addEntity();\r\n          state.addComponent(barEid, Transform);\r\n          state.addComponent(barEid, Mesh);\r\n          state.addComponent(barEid, Pair(ChildOf.relation, distEid));\r\n          state.addComponent(barEid, Pair(ExcessTargetBarOwner.relation, distEid));\r\n          Mesh.shape[barEid] = MeshShape.Box;\r\n          existingExcessTargetBars.push(barEid);\r\n        }\r\n\r\n        for (let i = 0; i < barCount; i++) {\r\n          const barEid = existingExcessTargetBars[i];\r\n          const targetP = targetProbs && targetProbs.length > i ? targetProbs[i] : 0.2;\r\n          const draftP = draftProbs && draftProbs.length > i ? draftProbs[i] : targetP;\r\n          const minP = Math.min(targetP, draftP);\r\n          const excessP = Math.max(0, targetP - draftP);\r\n\r\n          if (excessP <= 0.001) {\r\n            Mesh.sizeX[barEid] = 0;\r\n            Mesh.sizeY[barEid] = 0;\r\n            Mesh.sizeZ[barEid] = 0;\r\n            continue;\r\n          }\r\n\r\n          // Fade in as transfer progresses\r\n          const fadeScale = transferProgress;\r\n          const height = excessP * MAX_HEIGHT * excessTargetTransition * fadeScale;\r\n          const baseHeight = minP * MAX_HEIGHT;\r\n\r\n          Transform.posX[barEid] = startX + i * barSpacing;\r\n          Transform.posY[barEid] = baseHeight + height / 2;\r\n          Transform.posZ[barEid] = 0.1;\r\n\r\n          Mesh.sizeX[barEid] = barWidth * excessTargetTransition;\r\n          Mesh.sizeY[barEid] = height;\r\n          Mesh.sizeZ[barEid] = barWidth * excessTargetTransition;\r\n\r\n          Mesh.color[barEid] = 0x9333ea; // Purple\r\n        }\r\n      } else {\r\n        for (const barEid of existingExcessTargetBars) {\r\n          Mesh.sizeX[barEid] = 0;\r\n          Mesh.sizeY[barEid] = 0;\r\n          Mesh.sizeZ[barEid] = 0;\r\n        }\r\n      }\r\n    }\r\n  },\r\n};\r\n\r\nconst BarHighlightSystem: System = {\r\n  group: 'simulation',\r\n  update(state: State) {\r\n    for (const highlightEid of state.query([BarHighlight, Transform])) {\r\n      const distEid = BarHighlight.distribution[highlightEid];\r\n      const barIndex = BarHighlight.barIndex[highlightEid];\r\n      const yOffset = BarHighlight.yOffset[highlightEid];\r\n\r\n      if (!state.hasComponent(distEid, ProbabilityDistribution)) continue;\r\n\r\n      const barCount = ProbabilityDistribution.barCount[distEid];\r\n\r\n      const bars = [...state.query([Pair(DistributionBarOwner.relation, distEid), DistributionBar])];\r\n      const barEid = bars.find(eid => DistributionBar.index[eid] === barIndex);\r\n      if (barEid === undefined) continue;\r\n\r\n      const probability = DistributionBar.probability[barEid];\r\n\r\n      const barSpacing = CHART_WIDTH / barCount;\r\n      const startX = -CHART_WIDTH / 2 + barSpacing / 2;\r\n      const barX = startX + barIndex * barSpacing;\r\n      const barHeight = probability * MAX_HEIGHT;\r\n\r\n      Transform.posX[highlightEid] = barX;\r\n      Transform.posY[highlightEid] = 0.5 + barHeight + yOffset;\r\n    }\r\n  },\r\n};\r\n\r\nexport const ProbabilityDistributionPlugin: Plugin = {\r\n  components: { ProbabilityDistribution, DistributionBar, BarHighlight, AcceptanceMarker },\r\n  systems: [ProbabilityDistributionSystem, BarHighlightSystem],\r\n};\r\n","import { MAX_ENTITIES, resource, type Plugin, type State, type System } from '@multiplekex/shallot';\r\nimport { setTraits, type FieldAccessor } from '@multiplekex/shallot';\r\nimport { Compute, ComputePlugin, createEntityIdBuffer } from '@multiplekex/shallot';\r\nimport {\r\n  Render,\r\n  RenderPlugin,\r\n  DEPTH_FORMAT,\r\n  registerDrawContributor,\r\n  type DrawContributor,\r\n  type DrawContext,\r\n} from '@multiplekex/shallot';\r\nimport { Transform } from '@multiplekex/shallot';\r\n\r\nexport const GradientLegendData = {\r\n  data: new Float32Array(MAX_ENTITIES * 4),\r\n};\r\n\r\ninterface GradientLegendProxy extends Array<number>, FieldAccessor {}\r\n\r\nfunction legendProxy(offset: number): GradientLegendProxy {\r\n  const data = GradientLegendData.data;\r\n\r\n  function getValue(eid: number): number {\r\n    return data[eid * 4 + offset];\r\n  }\r\n\r\n  function setValue(eid: number, value: number): void {\r\n    data[eid * 4 + offset] = value;\r\n  }\r\n\r\n  return new Proxy([] as unknown as GradientLegendProxy, {\r\n    get(_, prop) {\r\n      if (prop === 'get') return getValue;\r\n      if (prop === 'set') return setValue;\r\n      const eid = Number(prop);\r\n      if (Number.isNaN(eid)) return undefined;\r\n      return getValue(eid);\r\n    },\r\n    set(_, prop, value) {\r\n      const eid = Number(prop);\r\n      if (Number.isNaN(eid)) return false;\r\n      setValue(eid, value);\r\n      return true;\r\n    },\r\n  });\r\n}\r\n\r\nexport const GradientLegend: {\r\n  transition: GradientLegendProxy;\r\n  width: GradientLegendProxy;\r\n  height: GradientLegendProxy;\r\n} = {\r\n  transition: legendProxy(0),\r\n  width: legendProxy(1),\r\n  height: legendProxy(2),\r\n};\r\n\r\nsetTraits(GradientLegend, {\r\n  defaults: () => ({\r\n    transition: 0,\r\n    width: 0.5,\r\n    height: 5,\r\n  }),\r\n  accessors: {\r\n    transition: GradientLegend.transition,\r\n    width: GradientLegend.width,\r\n    height: GradientLegend.height,\r\n  },\r\n});\r\n\r\nexport interface GradientLegendConfig {\r\n  scene: GPUBuffer;\r\n  legends: GPUBuffer;\r\n  entityIds: GPUBuffer;\r\n  matrices: GPUBuffer;\r\n  getCount: () => number;\r\n}\r\n\r\nexport const gradientLegendShader = /* wgsl */ `\r\nstruct VertexOutput {\r\n  @builtin(position) position: vec4<f32>,\r\n  @location(0) uv: vec2<f32>,\r\n  @location(1) transition: f32,\r\n}\r\n\r\nstruct Scene {\r\n  viewProj: mat4x4<f32>,\r\n  cameraWorld: mat4x4<f32>,\r\n  ambientColor: vec4<f32>,\r\n  sunDirection: vec4<f32>,\r\n  sunColor: vec4<f32>,\r\n  cameraMode: f32,\r\n  cameraSize: f32,\r\n  viewport: vec2<f32>,\r\n}\r\n\r\nstruct LegendData {\r\n  transition: f32,\r\n  width: f32,\r\n  height: f32,\r\n  _pad: f32,\r\n}\r\n\r\n@group(0) @binding(0) var<uniform> scene: Scene;\r\n@group(0) @binding(1) var<storage, read> entityIds: array<u32>;\r\n@group(0) @binding(2) var<storage, read> legends: array<LegendData>;\r\n@group(0) @binding(3) var<storage, read> matrices: array<mat4x4<f32>>;\r\n\r\n@vertex\r\nfn vs(@builtin(vertex_index) vid: u32, @builtin(instance_index) iid: u32) -> VertexOutput {\r\n  let eid = entityIds[iid];\r\n  let legend = legends[eid];\r\n  let transform = matrices[eid];\r\n\r\n  let halfW = legend.width * 0.5 * legend.transition;\r\n  let halfH = legend.height * 0.5 * legend.transition;\r\n\r\n  var localPos: vec2<f32>;\r\n  var uv: vec2<f32>;\r\n  switch vid {\r\n    case 0u: { localPos = vec2(-halfW, -halfH); uv = vec2(0.0, 0.0); }\r\n    case 1u: { localPos = vec2(halfW, -halfH); uv = vec2(1.0, 0.0); }\r\n    case 2u: { localPos = vec2(halfW, halfH); uv = vec2(1.0, 1.0); }\r\n    case 3u: { localPos = vec2(-halfW, -halfH); uv = vec2(0.0, 0.0); }\r\n    case 4u: { localPos = vec2(halfW, halfH); uv = vec2(1.0, 1.0); }\r\n    case 5u: { localPos = vec2(-halfW, halfH); uv = vec2(0.0, 1.0); }\r\n    default: { localPos = vec2(0.0, 0.0); uv = vec2(0.0, 0.0); }\r\n  }\r\n\r\n  let worldPos = transform[3].xyz + vec3(localPos, 0.0);\r\n  let clipPos = scene.viewProj * vec4(worldPos, 1.0);\r\n\r\n  var out: VertexOutput;\r\n  out.position = clipPos;\r\n  out.uv = uv;\r\n  out.transition = legend.transition;\r\n  return out;\r\n}\r\n\r\nstruct FragmentOutput {\r\n  @location(0) color: vec4<f32>,\r\n  @location(1) mask: f32,\r\n}\r\n\r\n@fragment\r\nfn fs(input: VertexOutput) -> FragmentOutput {\r\n  let t = input.uv.y;\r\n\r\n  // Nonlinear: Red -> Yellow at 90%, Yellow -> Green in top 10%\r\n  var color: vec3<f32>;\r\n  let red = vec3(0.863, 0.345, 0.345);\r\n  let yellow = vec3(0.898, 0.627, 0.251);\r\n  let green = vec3(0.247, 0.722, 0.478);\r\n  if (t < 0.9) {\r\n    color = mix(red, yellow, t / 0.9);\r\n  } else {\r\n    color = mix(yellow, green, (t - 0.9) / 0.1);\r\n  }\r\n\r\n  var out: FragmentOutput;\r\n  out.color = vec4(color, input.transition);\r\n  out.mask = select(0.0, 1.0, input.transition > 0.01);\r\n  return out;\r\n}\r\n`;\r\n\r\nexport function createGradientLegendPipeline(\r\n  device: GPUDevice,\r\n  format: GPUTextureFormat,\r\n  maskFormat: GPUTextureFormat\r\n): GPURenderPipeline {\r\n  const module = device.createShaderModule({ code: gradientLegendShader });\r\n\r\n  return device.createRenderPipeline({\r\n    layout: 'auto',\r\n    vertex: {\r\n      module,\r\n      entryPoint: 'vs',\r\n    },\r\n    fragment: {\r\n      module,\r\n      entryPoint: 'fs',\r\n      targets: [\r\n        {\r\n          format,\r\n          blend: {\r\n            color: {\r\n              srcFactor: 'src-alpha',\r\n              dstFactor: 'one-minus-src-alpha',\r\n              operation: 'add',\r\n            },\r\n            alpha: {\r\n              srcFactor: 'one',\r\n              dstFactor: 'one-minus-src-alpha',\r\n              operation: 'add',\r\n            },\r\n          },\r\n        },\r\n        {\r\n          format: maskFormat,\r\n          writeMask: GPUColorWrite.RED,\r\n        },\r\n      ],\r\n    },\r\n    primitive: {\r\n      topology: 'triangle-list',\r\n    },\r\n    depthStencil: {\r\n      format: DEPTH_FORMAT,\r\n      depthCompare: 'less',\r\n      depthWriteEnabled: false,\r\n    },\r\n  });\r\n}\r\n\r\nfunction createGradientLegendContributor(config: GradientLegendConfig): DrawContributor {\r\n  let pipeline: GPURenderPipeline | null = null;\r\n  let bindGroup: GPUBindGroup | null = null;\r\n\r\n  return {\r\n    id: 'gradient-legend',\r\n    order: 1,\r\n\r\n    draw(pass: GPURenderPassEncoder, ctx: DrawContext) {\r\n      if (!pipeline) {\r\n        pipeline = createGradientLegendPipeline(ctx.device, ctx.format, ctx.maskFormat);\r\n      }\r\n\r\n      if (!bindGroup) {\r\n        bindGroup = ctx.device.createBindGroup({\r\n          layout: pipeline.getBindGroupLayout(0),\r\n          entries: [\r\n            { binding: 0, resource: { buffer: config.scene } },\r\n            { binding: 1, resource: { buffer: config.entityIds } },\r\n            { binding: 2, resource: { buffer: config.legends } },\r\n            { binding: 3, resource: { buffer: config.matrices } },\r\n          ],\r\n        });\r\n      }\r\n\r\n      const count = config.getCount();\r\n      if (count === 0) return;\r\n\r\n      pass.setPipeline(pipeline);\r\n      pass.setBindGroup(0, bindGroup);\r\n      pass.draw(6, count);\r\n    },\r\n  };\r\n}\r\n\r\nexport interface GradientLegendState {\r\n  buffer: GPUBuffer;\r\n  entityIds: GPUBuffer;\r\n  count: number;\r\n}\r\n\r\nexport const GradientLegends = resource<GradientLegendState>('gradient-legends');\r\n\r\nconst entityIdArray = new Uint32Array(MAX_ENTITIES);\r\n\r\nconst GradientLegendSystem: System = {\r\n  group: 'draw',\r\n\r\n  update(state: State) {\r\n    const compute = Compute.from(state);\r\n    const legends = GradientLegends.from(state);\r\n    if (!compute || !legends) return;\r\n\r\n    const { device } = compute;\r\n\r\n    let count = 0;\r\n    for (const eid of state.query([GradientLegend, Transform])) {\r\n      if (GradientLegend.transition[eid] <= 0) continue;\r\n      entityIdArray[count++] = eid;\r\n    }\r\n\r\n    device.queue.writeBuffer(legends.buffer, 0, GradientLegendData.data);\r\n    device.queue.writeBuffer(legends.entityIds, 0, entityIdArray, 0, count);\r\n    legends.count = count;\r\n  },\r\n};\r\n\r\nexport const GradientLegendPlugin: Plugin = {\r\n  systems: [GradientLegendSystem],\r\n  components: { GradientLegend },\r\n  dependencies: [ComputePlugin, RenderPlugin],\r\n\r\n  initialize(state: State) {\r\n    const compute = Compute.from(state);\r\n    const render = Render.from(state);\r\n    if (!compute || !render) return;\r\n\r\n    const { device } = compute;\r\n\r\n    const legendState: GradientLegendState = {\r\n      buffer: device.createBuffer({\r\n        label: 'gradient-legends',\r\n        size: MAX_ENTITIES * 4 * 4,\r\n        usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_DST,\r\n      }),\r\n      entityIds: createEntityIdBuffer(device, MAX_ENTITIES),\r\n      count: 0,\r\n    };\r\n\r\n    state.setResource(GradientLegends, legendState);\r\n\r\n    registerDrawContributor(\r\n      state,\r\n      createGradientLegendContributor({\r\n        scene: render.scene,\r\n        legends: legendState.buffer,\r\n        entityIds: legendState.entityIds,\r\n        matrices: render.matrices,\r\n        getCount: () => legendState.count,\r\n      })\r\n    );\r\n  },\r\n};\r\n","import { setTraits, ChildOf, Pair, Transform, defineRelation, type Plugin, type State, type System } from '@multiplekex/shallot';\r\nimport { Text, Line, Arrow } from '@multiplekex/shallot/extras';\r\nimport { LINE, VALID, INVALID } from './colors';\r\n\r\nexport const TokenReplacement = {\r\n  trigger: [] as number[],\r\n};\r\n\r\nsetTraits(TokenReplacement, {\r\n  defaults: () => ({ trigger: 0 }),\r\n});\r\n\r\nconst tokenReplacementTexts = new Map<number, { original: string; replacement: string }>();\r\n\r\nexport function setTokenReplacementTexts(eid: number, original: string, replacement: string): void {\r\n  tokenReplacementTexts.set(eid, { original, replacement });\r\n}\r\n\r\nexport { Border, BorderPlugin } from './border';\r\nexport { ProbabilityDistribution, DistributionBar, BarHighlight, ProbabilityDistributionPlugin, setDistributionProbabilities } from './probability-distribution';\r\nexport { GradientLegend, GradientLegendPlugin } from './gradient-legend';\r\n\r\nexport const Network = {\r\n  active: [] as number[],\r\n  lineTransition: [] as number[],\r\n};\r\n\r\nsetTraits(Network, {\r\n  defaults: () => ({ active: 0, lineTransition: 1 }),\r\n});\r\n\r\nexport const TargetModel = {};\r\nexport const DraftModel = {};\r\nexport const ValidationModel = {};\r\n\r\nexport const Slot = {\r\n  index: [] as number[],\r\n  transition: [] as number[],\r\n};\r\n\r\nsetTraits(Slot, {\r\n  defaults: () => ({ index: 0, transition: 1 }),\r\n});\r\n\r\nexport const Latent = {};\r\nexport const Output = {};\r\n\r\nexport const ValidationMark = {\r\n  valid: [] as number[],\r\n  transition: [] as number[],\r\n};\r\n\r\nsetTraits(ValidationMark, {\r\n  defaults: () => ({ valid: 1, transition: 0 }),\r\n});\r\n\r\nconst SLOT_OFFSET_Z = -4;\r\nconst CHAR_WIDTH_RATIO = 0.55;\r\nconst WORD_GAP = 0.7;\r\nconst OUTPUT_GAP = 1.4;\r\nconst LINE_THICKNESS = 2;\r\n\r\nfunction getSlotTextWidth(state: State, slotEid: number): number {\r\n  for (const textEid of state.query([Pair(ChildOf.relation, slotEid), Text])) {\r\n    const content = Text.content[textEid] ?? '';\r\n    const fontSize = Text.fontSize[textEid] || 1;\r\n    return content.length * fontSize * CHAR_WIDTH_RATIO;\r\n  }\r\n  return 1;\r\n}\r\n\r\nconst SlotTransitionSystem: System = {\r\n  group: 'simulation',\r\n  update(state: State) {\r\n    for (const slotEid of state.query([Slot, Transform])) {\r\n      const t = Slot.transition[slotEid];\r\n      Transform.scaleX[slotEid] = t;\r\n      Transform.scaleY[slotEid] = t;\r\n      Transform.scaleZ[slotEid] = t;\r\n    }\r\n  },\r\n};\r\n\r\nconst SlotArrangementSystem: System = {\r\n  group: 'simulation',\r\n  update(state: State) {\r\n    for (const networkEid of state.query([Network, Transform])) {\r\n      const allSlots = [...state.query([Pair(ChildOf.relation, networkEid), Slot, Transform])];\r\n      if (allSlots.length === 0) continue;\r\n\r\n      allSlots.sort((a, b) => Slot.index[a] - Slot.index[b]);\r\n\r\n      const inputs = allSlots.filter((eid) => !state.hasComponent(eid, Output));\r\n      const outputs = allSlots.filter((eid) => state.hasComponent(eid, Output));\r\n\r\n      const inputWidths = inputs.map((eid) => getSlotTextWidth(state, eid));\r\n      const inputTotalWidth = inputWidths.reduce((sum, w) => sum + w, 0) + WORD_GAP * Math.max(0, inputs.length - 1);\r\n\r\n      let x = -inputTotalWidth / 2;\r\n      for (let i = 0; i < inputs.length; i++) {\r\n        const slotEid = inputs[i];\r\n        const w = inputWidths[i];\r\n        Transform.posX[slotEid] = x + w / 2;\r\n        Transform.posY[slotEid] = 0;\r\n        Transform.posZ[slotEid] = SLOT_OFFSET_Z;\r\n        x += w + WORD_GAP;\r\n      }\r\n\r\n      x = inputTotalWidth / 2 + OUTPUT_GAP;\r\n      for (let i = 0; i < outputs.length; i++) {\r\n        const slotEid = outputs[i];\r\n        const w = getSlotTextWidth(state, slotEid);\r\n        Transform.posX[slotEid] = x + w / 2;\r\n        Transform.posY[slotEid] = 0;\r\n        Transform.posZ[slotEid] = SLOT_OFFSET_Z;\r\n        x += w + WORD_GAP;\r\n      }\r\n    }\r\n  },\r\n};\r\n\r\nconst NetworkLine = {};\r\nconst NetworkLineTarget = defineRelation('network-line-target', { exclusive: true });\r\n\r\nconst NetworkLinesSystem: System = {\r\n  group: 'simulation',\r\n  update(state: State) {\r\n    for (const networkEid of state.query([Network, Transform])) {\r\n      const lineTransition = Network.lineTransition[networkEid];\r\n\r\n      for (const slotEid of state.query([Pair(ChildOf.relation, networkEid), Slot, Transform])) {\r\n        const existingLines = [...state.query([Pair(NetworkLineTarget.relation, slotEid), NetworkLine, Line])];\r\n\r\n        let lineEid: number;\r\n        if (existingLines.length === 0) {\r\n          lineEid = state.addEntity();\r\n          state.addComponent(lineEid, Transform);\r\n          state.addComponent(lineEid, Line);\r\n          state.addComponent(lineEid, Arrow);\r\n          state.addComponent(lineEid, NetworkLine);\r\n          state.addComponent(lineEid, Pair(ChildOf.relation, networkEid));\r\n          state.addComponent(lineEid, Pair(NetworkLineTarget.relation, slotEid));\r\n\r\n          Line.color[lineEid] = LINE;\r\n          Line.thickness[lineEid] = LINE_THICKNESS;\r\n          Line.visible[lineEid] = 1;\r\n\r\n          Arrow.start[lineEid] = 0;\r\n          Arrow.end[lineEid] = 1;\r\n          Arrow.size[lineEid] = 1;\r\n        } else {\r\n          lineEid = existingLines[0];\r\n        }\r\n\r\n        const slotX = Transform.posX[slotEid];\r\n        const slotY = Transform.posY[slotEid];\r\n        const slotZ = Transform.posZ[slotEid];\r\n        const t = Math.min(1, Slot.transition[slotEid]);\r\n\r\n        Line.offsetX[lineEid] = slotX * t;\r\n        Line.offsetY[lineEid] = slotY * t;\r\n        Line.offsetZ[lineEid] = slotZ * t;\r\n        Line.opacity[lineEid] = lineTransition;\r\n      }\r\n    }\r\n  },\r\n};\r\n\r\nconst LatentArrow = {};\r\nconst LatentArrowOwner = defineRelation('latent-arrow-owner', { exclusive: true });\r\n\r\nconst ValidationLine = {};\r\nconst ValidationLineTarget = defineRelation('validation-line-target', { exclusive: true });\r\n\r\nconst LatentArrowsSystem: System = {\r\n  group: 'simulation',\r\n  update(state: State) {\r\n    for (const slotEid of state.query([Slot, Transform])) {\r\n      const latents = [...state.query([Pair(ChildOf.relation, slotEid), Latent, Transform])];\r\n      if (latents.length === 0) continue;\r\n\r\n      const latentEid = latents[0];\r\n\r\n      const existingArrows = [...state.query([Pair(LatentArrowOwner.relation, slotEid), LatentArrow, Line])];\r\n\r\n      let arrowEid: number;\r\n      if (existingArrows.length === 0) {\r\n        arrowEid = state.addEntity();\r\n        state.addComponent(arrowEid, Transform);\r\n        state.addComponent(arrowEid, Line);\r\n        state.addComponent(arrowEid, Arrow);\r\n        state.addComponent(arrowEid, LatentArrow);\r\n        state.addComponent(arrowEid, Pair(ChildOf.relation, slotEid));\r\n        state.addComponent(arrowEid, Pair(LatentArrowOwner.relation, slotEid));\r\n\r\n        Line.color[arrowEid] = LINE;\r\n        Line.thickness[arrowEid] = LINE_THICKNESS;\r\n        Line.visible[arrowEid] = 1;\r\n        Line.opacity[arrowEid] = 1;\r\n\r\n        Arrow.start[arrowEid] = 0;\r\n        Arrow.end[arrowEid] = 1;\r\n        Arrow.size[arrowEid] = 1;\r\n      } else {\r\n        arrowEid = existingArrows[0];\r\n      }\r\n\r\n      const latentZ = Transform.posZ[latentEid] - 3.5;\r\n\r\n      Transform.posX[arrowEid] = 0;\r\n      Transform.posY[arrowEid] = 0;\r\n      Transform.posZ[arrowEid] = latentZ;\r\n\r\n      Line.offsetX[arrowEid] = 0;\r\n      Line.offsetY[arrowEid] = 0;\r\n      Line.offsetZ[arrowEid] = -0.8;\r\n    }\r\n  },\r\n};\r\n\r\nconst ValidationLinesSystem: System = {\r\n  group: 'simulation',\r\n  update(state: State) {\r\n    for (const validationEid of state.query([ValidationModel, Transform])) {\r\n      const validationScale = Transform.scaleX[validationEid];\r\n      if (validationScale < 0.01) continue;\r\n\r\n      for (const draftEid of state.query([DraftModel, Transform])) {\r\n        const draftSlots = [...state.query([Pair(ChildOf.relation, draftEid), Slot, Transform])];\r\n        if (draftSlots.length === 0) continue;\r\n\r\n        const draftX = Transform.posX[draftEid];\r\n        const draftY = Transform.posY[draftEid];\r\n        const draftZ = Transform.posZ[draftEid];\r\n\r\n        for (const slotEid of draftSlots) {\r\n          const slotTransition = Math.max(0, Math.min(1, Slot.transition[slotEid]));\r\n\r\n          const existingLines = [...state.query([Pair(ValidationLineTarget.relation, slotEid), ValidationLine, Line])];\r\n\r\n          let lineEid: number;\r\n          if (existingLines.length === 0) {\r\n            lineEid = state.addEntity();\r\n            state.addComponent(lineEid, Transform);\r\n            state.addComponent(lineEid, Line);\r\n            state.addComponent(lineEid, Arrow);\r\n            state.addComponent(lineEid, ValidationLine);\r\n            state.addComponent(lineEid, Pair(ValidationLineTarget.relation, slotEid));\r\n\r\n            Line.color[lineEid] = LINE;\r\n            Line.thickness[lineEid] = LINE_THICKNESS;\r\n            Line.visible[lineEid] = 1;\r\n\r\n            Arrow.start[lineEid] = 0;\r\n            Arrow.end[lineEid] = 1;\r\n            Arrow.size[lineEid] = 1;\r\n          } else {\r\n            lineEid = existingLines[0];\r\n          }\r\n\r\n          if (slotTransition < 0.01) {\r\n            Line.opacity[lineEid] = 0;\r\n            continue;\r\n          }\r\n\r\n          const slotX = Transform.posX[slotEid];\r\n          const slotZ = Transform.posZ[slotEid];\r\n          const worldSlotX = draftX + slotX * slotTransition;\r\n          const worldSlotY = draftY;\r\n          const worldSlotZ = draftZ + slotZ * slotTransition;\r\n\r\n          const validationX = Transform.posX[validationEid];\r\n          const validationY = Transform.posY[validationEid];\r\n          const validationZ = Transform.posZ[validationEid];\r\n\r\n          Transform.posX[lineEid] = validationX;\r\n          Transform.posY[lineEid] = validationY;\r\n          Transform.posZ[lineEid] = validationZ;\r\n\r\n          Line.offsetX[lineEid] = (worldSlotX - validationX) * validationScale;\r\n          Line.offsetY[lineEid] = (worldSlotY - validationY) * validationScale;\r\n          Line.offsetZ[lineEid] = (worldSlotZ - validationZ) * validationScale;\r\n          Line.opacity[lineEid] = validationScale * slotTransition;\r\n        }\r\n      }\r\n    }\r\n  },\r\n};\r\n\r\nconst TokenReplacementSystem: System = {\r\n  group: 'simulation',\r\n  update(state: State) {\r\n    for (const eid of state.query([TokenReplacement, Text])) {\r\n      const trigger = TokenReplacement.trigger[eid];\r\n      const texts = tokenReplacementTexts.get(eid);\r\n      if (!texts) continue;\r\n\r\n      const currentText = Text.content[eid] ?? '';\r\n      const { original, replacement } = texts;\r\n\r\n      if (trigger > 0.5 && currentText !== replacement && replacement) {\r\n        Text.content[eid] = replacement;\r\n      } else if (trigger <= 0.5 && currentText !== original && original) {\r\n        Text.content[eid] = original;\r\n      }\r\n    }\r\n  },\r\n};\r\n\r\nexport const SpecdecPlugin: Plugin = {\r\n  components: { Network, TargetModel, DraftModel, ValidationModel, Slot, Latent, Output, NetworkLine, LatentArrow, ValidationLine, TokenReplacement },\r\n  systems: [SlotTransitionSystem, SlotArrangementSystem, NetworkLinesSystem, LatentArrowsSystem, ValidationLinesSystem, TokenReplacementSystem],\r\n};\r\n"],"names":["findStepElements","container","root","setupStepUI","elements","options","steps","onStepChange","maxStep","currentStep","stepInfo","maxHeight","step","updateDisplay","btnPrev","btnNext","counter","title","description","content","goToStep","clamped","handlePrev","handleNext","handleKeydown","e","__accessCheck","obj","member","msg","__privateGet","getter","__privateAdd","value","__privateSet","setter","__privateWrapper","__privateMethod","method","bytes","view","u8","u16","i16","u24","u32","i32","u64","fixed_8_8","fixed_16_16","fixed_2_30","ascii","text","nullTerminated","bytes2","_","i","last","arr","lastPresentedSample","samples","result","sample","intoTimescale","timeInSeconds","timescale","round","rotationMatrix","rotationInDegrees","theta","cosTheta","sinTheta","IDENTITY_MATRIX","matrixToBytes","matrix","deepClone","x","key","isU32","box","type","contents","children","fullBox","version","flags","ftyp","details","minorVersion","mdat","reserveLargeSize","free","size","moov","tracks","creationTime","fragmented","mvhd","trak","mvex","duration","lastSample","GLOBAL_TIMESCALE","nextTrackId","needsU64","u32OrU64","track","tkhd","mdia","durationInGlobalTimescale","mdhd","hdlr","minf","localDuration","componentSubtype","vmhd","smhd","dinf","stbl","dref","url","needsCtts","stsd","stts","stss","stsc","stsz","stco","ctts","videoSampleDescription","VIDEO_CODEC_TO_BOX_NAME","soundSampleDescription","AUDIO_CODEC_TO_BOX_NAME","compressionType","VIDEO_CODEC_TO_CONFIGURATION_BOX","colr","COLOR_PRIMARIES_MAP","TRANSFER_CHARACTERISTICS_MAP","MATRIX_COEFFICIENTS_MAP","avcC","hvcC","vpcC","decoderConfig","parts","profile","level","thirdByte","av1C","firstByte","AUDIO_CODEC_TO_CONFIGURATION_BOX","esds","dOps","preskip","gain","view2","keySamples","index","trex","moof","sequenceNumber","mfhd","traf","fragmentSampleFlags","byte1","byte2","byte3","byte4","sampleIsDifferenceSample","tfhd","tfdt","trun","tfFlags","referenceSample","referenceSampleInfo","allSampleDurations","allSampleSizes","allSampleFlags","allSampleCompositionTimeOffsets","uniqueSampleDurations","uniqueSampleSizes","uniqueSampleFlags","uniqueSampleCompositionTimeOffsets","firstSampleFlagsPresent","sampleDurationPresent","sampleSizePresent","sampleFlagsPresent","sampleCompositionTimeOffsetsPresent","mfra","tfra","mfro","trackIndex","chunk","Target","ArrayBufferTarget","StreamTarget","FileSystemWritableFileStreamTarget","stream","_helper","_helperView","Writer","newPos","box2","startPos","child","endPos","_target","_buffer","_bytes","_maxPos","_ensureSize","ensureSize_fn","ArrayBufferTargetWriter","target","data","newLength","newBuffer","newBytes","DEFAULT_CHUNK_SIZE","MAX_CHUNKS_AT_ONCE","_target2","_sections","_chunked","_chunkSize","_chunks","_writeDataIntoChunks","writeDataIntoChunks_fn","_insertSectionIntoChunk","insertSectionIntoChunk_fn","_createChunk","createChunk_fn","_flushChunks","flushChunks_fn","StreamTargetWriter","chunks","sorted","a","b","lastChunk","section","position","chunkIndex","relativePosition","toWrite","low","high","mid","includesPosition","force","FileSystemWritableFileStreamTargetWriter","SUPPORTED_VIDEO_CODECS","SUPPORTED_AUDIO_CODECS","TIMESTAMP_OFFSET","FIRST_TIMESTAMP_BEHAVIORS","_options","_writer","_ftypSize","_mdat","_videoTrack","_audioTrack","_creationTime","_finalizedChunks","_nextFragmentNumber","_videoSampleQueue","_audioSampleQueue","_finalized","_validateOptions","validateOptions_fn","_writeHeader","writeHeader_fn","_computeMoovSizeUpperBound","computeMoovSizeUpperBound_fn","_prepareTracks","prepareTracks_fn","_generateMpeg4AudioSpecificConfig","generateMpeg4AudioSpecificConfig_fn","_createSampleForTrack","createSampleForTrack_fn","_addSampleToTrack","addSampleToTrack_fn","_validateTimestamp","validateTimestamp_fn","_finalizeCurrentChunk","finalizeCurrentChunk_fn","_finalizeFragment","finalizeFragment_fn","_maybeFlushStreamingTargetWriter","maybeFlushStreamingTargetWriter_fn","_ensureNotFinalized","ensureNotFinalized_fn","Muxer","meta","timestamp","compositionTimeOffset","videoSample","audioSample","mdatSize","movieBox2","movieBoxSize","currentChunkPos","movieBox","mfraBox","mfraBoxSize","mdatPos","remainingBytes","videoRotation","moovSizeUpperBound","upperBound","sampleCounts","n","guessedCodecPrivate","objectType","sampleRate","numberOfChannels","frequencyIndex","channelConfig","configBits","paddingLength","configBytes","presentationTimestampInSeconds","decodeTimestampInSeconds","durationInSeconds","adjusted","sampleCompositionTimeOffset","timescaleUnits","delta","lastTableEntry","lastCompositionTimeOffsetTableEntry","beginNewChunk","currentChunkDuration","mostImportantTrack","chunkDuration","presentationTimestamp","decodeTimestamp","strictTimestampBehavior","noLastDecodeTimestamp","baseDecodeTimestamp","flushStreamingWriter","fragmentNumber","moofOffset","moofBox","mdatBox","totalTrackSampleSize","newMoofBox","setCanvasSize","canvas","width","height","dpr","findSequenceForTransition","state","from","to","eid","Sequence","StepTransition","setupCanvasRecording","config","onProgress","seqEid","origWidth","origHeight","origStyle","r","SequenceState","childEid","Pair","ChildOf","Tween","TweenState","maxDuration","totalFrames","muxer","encoder","stepTime","videoFrame","TARGET_MODEL","DRAFT_MODEL","VALID","INVALID","LINE","Border","setTraits","BorderLine","CHAR_WIDTH_RATIO","BorderSystem","Text","Transform","fontSize","padding","color","thickness","t","textWidth","textHeight","w","h","Line","lineEid","lines","BorderPlugin","ProbabilityDistribution","DistributionBar","DistributionBarOwner","defineRelation","ComparisonBarOwner","AcceptanceMarkerOwner","ResidualBarOwner","MinBarOwner","ExcessDraftBarOwner","ExcessTargetBarOwner","AcceptanceMarker","BarHighlight","targetDistributions","draftDistributions","setDistributionProbabilities","distEid","targetProbs","draftProbs","lerpColor","c1","c2","r1","g1","b1","r2","g2","b2","g","RED","YELLOW","GREEN","acceptanceColor","acceptance","CHART_WIDTH","MAX_HEIGHT","smoothLerp","smoothness","dt","s","ProbabilityDistributionSystem","barCount","transition","blend","comparisonTransition","comparisonZ","existingBars","Mesh","barEid","MeshShape","barSpacing","barWidth","startX","targetP","draftP","goalP","probability","existingComparisonBars","compBarEid","acceptanceTransition","acceptanceYOffset","acceptanceSize","existingMarkers","markerEid","scaledSize","residualTransition","existingResidualBars","residualP","minTransition","existingMinBars","minP","excessDraftTransition","transferProgress","existingExcessDraftBars","excessP","fadeScale","baseHeight","widthScale","excessTargetTransition","existingExcessTargetBars","BarHighlightSystem","highlightEid","barIndex","yOffset","barX","barHeight","ProbabilityDistributionPlugin","GradientLegendData","MAX_ENTITIES","legendProxy","offset","getValue","setValue","prop","GradientLegend","gradientLegendShader","createGradientLegendPipeline","device","format","maskFormat","module","DEPTH_FORMAT","createGradientLegendContributor","pipeline","bindGroup","pass","ctx","count","GradientLegends","resource","entityIdArray","GradientLegendSystem","compute","Compute","legends","GradientLegendPlugin","ComputePlugin","RenderPlugin","render","Render","legendState","createEntityIdBuffer","registerDrawContributor","TokenReplacement","tokenReplacementTexts","setTokenReplacementTexts","original","replacement","Network","TargetModel","DraftModel","ValidationModel","Slot","Latent","Output","ValidationMark","SLOT_OFFSET_Z","WORD_GAP","OUTPUT_GAP","LINE_THICKNESS","getSlotTextWidth","slotEid","textEid","SlotTransitionSystem","SlotArrangementSystem","networkEid","allSlots","inputs","outputs","inputWidths","inputTotalWidth","sum","NetworkLine","NetworkLineTarget","NetworkLinesSystem","lineTransition","existingLines","Arrow","slotX","slotY","slotZ","LatentArrow","LatentArrowOwner","ValidationLine","ValidationLineTarget","LatentArrowsSystem","latents","latentEid","existingArrows","arrowEid","latentZ","ValidationLinesSystem","validationEid","validationScale","draftEid","draftSlots","draftX","draftY","draftZ","slotTransition","worldSlotX","worldSlotY","worldSlotZ","validationX","validationY","validationZ","TokenReplacementSystem","trigger","texts","currentText","SpecdecPlugin"],"mappings":"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","x_google_ignoreList":[1]}