{"version":3,"file":"index-C6Sj2kLI.js","sources":["../../../src/iframe/index.ts"],"sourcesContent":["import type { State } from 'shallot';\n\nexport function setupCanvas(canvas: HTMLCanvasElement): void {\n  const rect = canvas.getBoundingClientRect();\n  canvas.width = rect.width * window.devicePixelRatio;\n  canvas.height = rect.height * window.devicePixelRatio;\n}\n\nexport function setupVisibilityControl(state: State): void {\n  new IntersectionObserver(([entry]) => {\n    if (entry.isIntersecting) {\n      state.start();\n    } else {\n      state.stop();\n    }\n  }).observe(document.documentElement);\n}\n\nexport function createVisibilityLoop(\n  state: State,\n  onTick?: (dt: number) => void\n): void {\n  let running = false;\n  let lastTime = performance.now();\n\n  function tick(now: number): void {\n    if (!running) return;\n    const dt = (now - lastTime) / 1000;\n    lastTime = now;\n    state.step(dt);\n    onTick?.(dt);\n    requestAnimationFrame(tick);\n  }\n\n  new IntersectionObserver(([entry]) => {\n    if (entry.isIntersecting) {\n      if (!running) {\n        running = true;\n        lastTime = performance.now();\n        requestAnimationFrame(tick);\n      }\n    } else {\n      running = false;\n    }\n  }).observe(document.documentElement);\n}\n"],"names":["setupCanvas","canvas","rect","setupVisibilityControl","state","entry","createVisibilityLoop","onTick","running","lastTime","tick","now","dt"],"mappings":"AAEO,SAASA,EAAYC,EAAiC,CAC3D,MAAMC,EAAOD,EAAO,sBAAA,EACpBA,EAAO,MAAQC,EAAK,MAAQ,OAAO,iBACnCD,EAAO,OAASC,EAAK,OAAS,OAAO,gBACvC,CAEO,SAASC,EAAuBC,EAAoB,CACzD,IAAI,qBAAqB,CAAC,CAACC,CAAK,IAAM,CAChCA,EAAM,eACRD,EAAM,MAAA,EAENA,EAAM,KAAA,CAEV,CAAC,EAAE,QAAQ,SAAS,eAAe,CACrC,CAEO,SAASE,EACdF,EACAG,EACM,CACN,IAAIC,EAAU,GACVC,EAAW,YAAY,IAAA,EAE3B,SAASC,EAAKC,EAAmB,CAC/B,GAAI,CAACH,EAAS,OACd,MAAMI,GAAMD,EAAMF,GAAY,IAC9BA,EAAWE,EACXP,EAAM,KAAKQ,CAAE,EAEb,sBAAsBF,CAAI,CAC5B,CAEA,IAAI,qBAAqB,CAAC,CAACL,CAAK,IAAM,CAChCA,EAAM,eACHG,IACHA,EAAU,GACVC,EAAW,YAAY,IAAA,EACvB,sBAAsBC,CAAI,GAG5BF,EAAU,EAEd,CAAC,EAAE,QAAQ,SAAS,eAAe,CACrC"}