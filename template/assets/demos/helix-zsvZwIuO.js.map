{"version":3,"file":"helix-zsvZwIuO.js","sources":["../../../plugins/helix-shapes.ts","../../../plugins/grid-arrangement.ts","../../../demos/helix.ts"],"sourcesContent":["import { setTraits, Transform, Mesh, type State, type System, type Plugin } from '@multiplekex/shallot';\r\n\r\nexport const HelixAnimation = {\r\n  index: [] as number[],\r\n  speed: [] as number[],\r\n};\r\n\r\nsetTraits(HelixAnimation, {\r\n  defaults: () => ({ index: 0, speed: 1 }),\r\n});\r\n\r\nconst HelixAnimationSystem: System = {\r\n  group: 'draw',\r\n  update(state: State) {\r\n    const entities = [...state.query([HelixAnimation, Transform, Mesh])];\r\n    const time = state.time.elapsed;\r\n    const count = entities.length || 10;\r\n\r\n    for (const eid of entities) {\r\n      const index = HelixAnimation.index[eid];\r\n      const speed = HelixAnimation.speed[eid] || 1;\r\n      const offset = (index * Math.PI * 2) / count;\r\n\r\n      const radius = 5;\r\n      Transform.posX[eid] = Math.cos(time * speed + offset) * radius;\r\n      Transform.posZ[eid] = Math.sin(time * speed + offset) * radius;\r\n      Transform.posY[eid] = Math.sin(time * 2 * speed + offset) * 2;\r\n\r\n      Transform.eulerY[eid] = ((time * 50 * speed + index * 36) % 360) * (Math.PI / 180);\r\n      Transform.eulerX[eid] = Math.sin(time * speed + offset) * 0.52;\r\n    }\r\n  },\r\n};\r\n\r\nexport const HelixShapesPlugin: Plugin = {\r\n  components: { HelixAnimation },\r\n  systems: [HelixAnimationSystem],\r\n};\r\n","import { setTraits, Transform, type State, type System, type Plugin } from '@multiplekex/shallot';\r\n\r\nexport const GridController = {\r\n  mode: [] as number[],\r\n};\r\n\r\nsetTraits(GridController, {\r\n  defaults: () => ({ mode: 1 }),\r\n});\r\n\r\nexport const GridItem = {\r\n  index: [] as number[],\r\n  targetX: [] as number[],\r\n  targetY: [] as number[],\r\n  targetZ: [] as number[],\r\n};\r\n\r\nsetTraits(GridItem, {\r\n  defaults: () => ({ index: 0, targetX: 0, targetY: 0, targetZ: 0 }),\r\n});\r\n\r\nconst GRID_COLS = 3;\r\nconst GRID_SPACING = 3;\r\n\r\nfunction getGridPosition(index: number): [number, number, number] {\r\n  const row = Math.floor(index / GRID_COLS);\r\n  const col = index % GRID_COLS;\r\n  const offsetX = ((GRID_COLS - 1) * GRID_SPACING) / 2;\r\n  const offsetZ = ((Math.ceil(9 / GRID_COLS) - 1) * GRID_SPACING) / 2;\r\n  return [col * GRID_SPACING - offsetX, 0, row * GRID_SPACING - offsetZ];\r\n}\r\n\r\nconst GridControllerSystem: System = {\r\n  group: 'simulation',\r\n  update(state: State) {\r\n    const controllers = [...state.query([GridController])];\r\n    for (const controllerId of controllers) {\r\n      const t = GridController.mode[controllerId];\r\n\r\n      const gridItems = [...state.query([GridItem, Transform])];\r\n      for (const eid of gridItems) {\r\n        const index = GridItem.index[eid];\r\n        const [gx, gy, gz] = getGridPosition(index);\r\n        GridItem.targetX[eid] = gx * t;\r\n        GridItem.targetY[eid] = gy * t;\r\n        GridItem.targetZ[eid] = gz * t;\r\n      }\r\n    }\r\n  },\r\n};\r\n\r\nconst GridEaseSystem: System = {\r\n  group: 'simulation',\r\n  after: [GridControllerSystem],\r\n  update(state: State) {\r\n    const k = 10 * state.time.deltaTime;\r\n    const gridItems = [...state.query([GridItem, Transform])];\r\n    for (const eid of gridItems) {\r\n      Transform.posX[eid] += (GridItem.targetX[eid] - Transform.posX[eid]) * k;\r\n      Transform.posY[eid] += (GridItem.targetY[eid] - Transform.posY[eid]) * k;\r\n      Transform.posZ[eid] += (GridItem.targetZ[eid] - Transform.posZ[eid]) * k;\r\n    }\r\n  },\r\n};\r\n\r\nexport const GridArrangementPlugin: Plugin = {\r\n  components: { GridController, GridItem },\r\n  systems: [GridControllerSystem, GridEaseSystem],\r\n};\r\n\r\nexport function setupGridUI(state: State): void {\r\n  const controllers = [...state.query([GridController])];\r\n  const controller = controllers[0];\r\n  if (controller === undefined) return;\r\n\r\n  document.getElementById('btn-collapse')?.addEventListener('click', () => {\r\n    GridController.mode[controller] = 0;\r\n  });\r\n  document.getElementById('btn-expand')?.addEventListener('click', () => {\r\n    GridController.mode[controller] = 1;\r\n  });\r\n}\r\n","import { State, TransformsPlugin, RenderPlugin, minimalLight } from '@multiplekex/shallot';\r\nimport { OrbitPlugin } from '@multiplekex/shallot/extras';\r\nimport { HelixShapesPlugin } from '../plugins';\r\nimport { setupCanvas, setupVisibilityControl } from '@blog-components/sequence';\r\n\r\nasync function init(): Promise<void> {\r\n  const canvas = document.getElementById('canvas') as HTMLCanvasElement;\r\n  if (!canvas) return;\r\n\r\n  setupCanvas(canvas);\r\n  window.addEventListener('resize', () => setupCanvas(canvas));\r\n\r\n  const state = await State.new()\r\n    .withCanvas(canvas)\r\n    .withLoading(minimalLight(canvas))\r\n    .withPlugins(TransformsPlugin, RenderPlugin, OrbitPlugin, HelixShapesPlugin)\r\n    .withScene('../scenes/helix.scene')\r\n    .run();\r\n\r\n  setupVisibilityControl(state);\r\n}\r\n\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', init);\r\n} else {\r\n  init();\r\n}\r\n"],"names":["HelixAnimation","setTraits","HelixAnimationSystem","state","entities","Transform","Mesh","time","count","eid","index","speed","offset","radius","HelixShapesPlugin","GridController","GridItem","init","canvas","setupCanvas","State","minimalLight","TransformsPlugin","RenderPlugin","OrbitPlugin","setupVisibilityControl"],"mappings":"qMAEO,MAAMA,EAAiB,CAC5B,MAAO,CAAA,EACP,MAAO,CAAA,CACT,EAEAC,EAAUD,EAAgB,CACxB,SAAU,KAAO,CAAE,MAAO,EAAG,MAAO,CAAA,EACtC,CAAC,EAED,MAAME,EAA+B,CACnC,MAAO,OACP,OAAOC,EAAc,CACnB,MAAMC,EAAW,CAAC,GAAGD,EAAM,MAAM,CAACH,EAAgBK,EAAWC,CAAI,CAAC,CAAC,EAC7DC,EAAOJ,EAAM,KAAK,QAClBK,EAAQJ,EAAS,QAAU,GAEjC,UAAWK,KAAOL,EAAU,CAC1B,MAAMM,EAAQV,EAAe,MAAMS,CAAG,EAChCE,EAAQX,EAAe,MAAMS,CAAG,GAAK,EACrCG,EAAUF,EAAQ,KAAK,GAAK,EAAKF,EAEjCK,EAAS,EACfR,EAAU,KAAKI,CAAG,EAAI,KAAK,IAAIF,EAAOI,EAAQC,CAAM,EAAIC,EACxDR,EAAU,KAAKI,CAAG,EAAI,KAAK,IAAIF,EAAOI,EAAQC,CAAM,EAAIC,EACxDR,EAAU,KAAKI,CAAG,EAAI,KAAK,IAAIF,EAAO,EAAII,EAAQC,CAAM,EAAI,EAE5DP,EAAU,OAAOI,CAAG,GAAMF,EAAO,GAAKI,EAAQD,EAAQ,IAAM,KAAQ,KAAK,GAAK,KAC9EL,EAAU,OAAOI,CAAG,EAAI,KAAK,IAAIF,EAAOI,EAAQC,CAAM,EAAI,GAC5D,CACF,CACF,EAEaE,EAA4B,CACvC,WAAY,CAAE,eAAAd,CAAA,EACd,QAAS,CAACE,CAAoB,CAChC,ECnCaa,EAAiB,CAC5B,KAAM,CAAA,CACR,EAEAd,EAAUc,EAAgB,CACxB,SAAU,KAAO,CAAE,KAAM,CAAA,EAC3B,CAAC,EAEM,MAAMC,EAAW,CACtB,MAAO,CAAA,EACP,QAAS,CAAA,EACT,QAAS,CAAA,EACT,QAAS,CAAA,CACX,EAEAf,EAAUe,EAAU,CAClB,SAAU,KAAO,CAAE,MAAO,EAAG,QAAS,EAAG,QAAS,EAAG,QAAS,CAAA,EAChE,CAAC,ECdD,eAAeC,GAAsB,CACnC,MAAMC,EAAS,SAAS,eAAe,QAAQ,EAC/C,GAAI,CAACA,EAAQ,OAEbC,EAAYD,CAAM,EAClB,OAAO,iBAAiB,SAAU,IAAMC,EAAYD,CAAM,CAAC,EAE3D,MAAMf,EAAQ,MAAMiB,EAAM,IAAA,EACvB,WAAWF,CAAM,EACjB,YAAYG,EAAaH,CAAM,CAAC,EAChC,YAAYI,EAAkBC,EAAcC,EAAaV,CAAiB,EAC1E,UAAU,uBAAuB,EACjC,IAAA,EAEHW,EAAuBtB,CAAK,CAC9B,CAEI,SAAS,aAAe,UAC1B,SAAS,iBAAiB,mBAAoBc,CAAI,EAElDA,EAAA"}