import{g as v,a as b,b as y,c as g,T as m,C as E,d as L}from"./step-plugin-Cqgj3jUS.js";import{M,A as T}from"./mp4-muxer-DaZBAdSD.js";function C(t){const n=typeof t=="string"?document.querySelector(t):t;return n?{btnPrev:n.querySelector(".btn-prev"),btnNext:n.querySelector(".btn-next"),counter:n.querySelector(".step-counter"),title:n.querySelector(".step-title"),description:n.querySelector(".step-description")}:{btnPrev:null,btnNext:null,counter:null,title:null,description:null}}function N(t,n){const{steps:e,onStepChange:l}=n,s=e.length-1;let o=0;const p=t.title?.parentElement;if(p){let r=0;for(const d of e)t.title&&(t.title.textContent=d.title),t.description&&(t.description.innerHTML=d.description),r=Math.max(r,p.offsetHeight);p.style.minHeight=`${r}px`}function h(){const{btnPrev:r,btnNext:d,counter:i,title:c,description:x}=t,S=e[o];r&&(r.disabled=o<=0),d&&(d.disabled=o>=s),i&&(i.textContent=`Step ${o+1} of ${e.length}`),c&&(c.textContent=S?.title??""),x&&(x.innerHTML=S?.description??"")}function a(r){const d=Math.max(0,Math.min(s,r));d!==o&&(o=d,h(),l(o))}const w=()=>a(o-1),f=()=>a(o+1),u=r=>{r.key==="ArrowLeft"&&a(o-1),r.key==="ArrowRight"&&a(o+1)};return t.btnPrev?.addEventListener("click",w),t.btnNext?.addEventListener("click",f),document.addEventListener("keydown",u),h(),{setStep(r){o=Math.max(0,Math.min(s,r)),h()},getStep:()=>o,getMaxStep:()=>s,dispose(){t.btnPrev?.removeEventListener("click",w),t.btnNext?.removeEventListener("click",f),document.removeEventListener("keydown",u)}}}function q(t,n,e){const l=window.devicePixelRatio||1;t.style.width=`${n/l}px`,t.style.height=`${e/l}px`,t.width=n,t.height=e}function A(t,n){t.__recordSequence__=async(e,l)=>{const s=v(e.seqName);if(s===null)return null;const o=t.width,p=t.height,h=t.style.cssText;q(t,e.width,e.height),await new Promise(i=>requestAnimationFrame(i)),y.state[s]=b.IDLE,y.elapsed[s]=0;for(const i of n.query([g(E.relation,s),m]))m.state[i]=L.IDLE,m.elapsed[i]=0;y.state[s]=b.PLAYING;let a=0;for(const i of n.query([g(E.relation,s),m]))a=Math.max(a,m.duration[i]);const w=a+.1,f=Math.ceil(w*e.fps),u=new M({target:new T,video:{codec:"avc",width:e.width,height:e.height},fastStart:"in-memory"}),r=new VideoEncoder({output:(i,c)=>u.addVideoChunk(i,c),error:i=>console.error("Encoder error:",i)});r.configure({codec:"avc1.640032",width:e.width,height:e.height,bitrate:e.bitrate,framerate:e.fps});const d=1/e.fps;for(let i=0;i<f;i++){q(t,e.width,e.height),n.step(d);const c=new VideoFrame(t,{timestamp:i*1e6/e.fps});r.encode(c),c.close(),i%30===0&&(l?.(i,f),await new Promise(x=>setTimeout(x,0)))}return await r.flush(),u.finalize(),t.width=o,t.height=p,t.style.cssText=h,new Blob([u.target.buffer],{type:"video/mp4"})}}export{N as a,C as f,A as s};
//# sourceMappingURL=canvas-recording-Dq1yLb-1.js.map
