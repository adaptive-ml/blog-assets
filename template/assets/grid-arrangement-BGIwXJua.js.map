{"version":3,"file":"grid-arrangement-BGIwXJua.js","sources":["../../blog/src/helix-shapes.ts","../../blog/src/grid-arrangement.ts"],"sourcesContent":["import { setTraits, Transform, Mesh, type State, type System, type Plugin } from 'shallot';\n\nexport const HelixAnimation = {\n  index: [] as number[],\n  speed: [] as number[],\n};\n\nsetTraits(HelixAnimation, {\n  defaults: () => ({ index: 0, speed: 1 }),\n});\n\nconst HelixAnimationSystem: System = {\n  group: 'draw',\n  update(state: State) {\n    const entities = [...state.query([HelixAnimation, Transform, Mesh])];\n    const time = state.time.elapsed;\n    const count = entities.length || 10;\n\n    for (const eid of entities) {\n      const index = HelixAnimation.index[eid];\n      const speed = HelixAnimation.speed[eid] || 1;\n      const offset = (index * Math.PI * 2) / count;\n\n      const radius = 5;\n      Transform.posX[eid] = Math.cos(time * speed + offset) * radius;\n      Transform.posZ[eid] = Math.sin(time * speed + offset) * radius;\n      Transform.posY[eid] = Math.sin(time * 2 * speed + offset) * 2;\n\n      Transform.eulerY[eid] = ((time * 50 * speed + index * 36) % 360) * (Math.PI / 180);\n      Transform.eulerX[eid] = Math.sin(time * speed + offset) * 0.52;\n    }\n  },\n};\n\nexport const HelixShapesPlugin: Plugin = {\n  components: { HelixAnimation },\n  systems: [HelixAnimationSystem],\n};\n","import { setTraits, Transform, type State, type System, type Plugin } from 'shallot';\n\nexport const GridController = {\n  mode: [] as number[],\n};\n\nsetTraits(GridController, {\n  defaults: () => ({ mode: 1 }),\n});\n\nexport const GridItem = {\n  index: [] as number[],\n  targetX: [] as number[],\n  targetY: [] as number[],\n  targetZ: [] as number[],\n};\n\nsetTraits(GridItem, {\n  defaults: () => ({ index: 0, targetX: 0, targetY: 0, targetZ: 0 }),\n});\n\nconst GRID_COLS = 3;\nconst GRID_SPACING = 3;\n\nfunction getGridPosition(index: number): [number, number, number] {\n  const row = Math.floor(index / GRID_COLS);\n  const col = index % GRID_COLS;\n  const offsetX = ((GRID_COLS - 1) * GRID_SPACING) / 2;\n  const offsetZ = ((Math.ceil(9 / GRID_COLS) - 1) * GRID_SPACING) / 2;\n  return [col * GRID_SPACING - offsetX, 0, row * GRID_SPACING - offsetZ];\n}\n\nconst GridControllerSystem: System = {\n  group: 'simulation',\n  update(state: State) {\n    const controllers = [...state.query([GridController])];\n    for (const controllerId of controllers) {\n      const t = GridController.mode[controllerId];\n\n      const gridItems = [...state.query([GridItem, Transform])];\n      for (const eid of gridItems) {\n        const index = GridItem.index[eid];\n        const [gx, gy, gz] = getGridPosition(index);\n        GridItem.targetX[eid] = gx * t;\n        GridItem.targetY[eid] = gy * t;\n        GridItem.targetZ[eid] = gz * t;\n      }\n    }\n  },\n};\n\nconst GridEaseSystem: System = {\n  group: 'simulation',\n  after: [GridControllerSystem],\n  update(state: State) {\n    const k = 10 * state.time.deltaTime;\n    const gridItems = [...state.query([GridItem, Transform])];\n    for (const eid of gridItems) {\n      Transform.posX[eid] += (GridItem.targetX[eid] - Transform.posX[eid]) * k;\n      Transform.posY[eid] += (GridItem.targetY[eid] - Transform.posY[eid]) * k;\n      Transform.posZ[eid] += (GridItem.targetZ[eid] - Transform.posZ[eid]) * k;\n    }\n  },\n};\n\nexport const GridArrangementPlugin: Plugin = {\n  components: { GridController, GridItem },\n  systems: [GridControllerSystem, GridEaseSystem],\n};\n\nexport function setupGridUI(state: State): void {\n  const controllers = [...state.query([GridController])];\n  const controller = controllers[0];\n  if (controller === undefined) return;\n\n  document.getElementById('btn-collapse')?.addEventListener('click', () => {\n    GridController.mode[controller] = 0;\n  });\n  document.getElementById('btn-expand')?.addEventListener('click', () => {\n    GridController.mode[controller] = 1;\n  });\n}\n"],"names":["HelixAnimation","setTraits","HelixAnimationSystem","state","entities","Transform","Mesh","time","count","eid","index","speed","offset","radius","HelixShapesPlugin","GridController","GridItem","GRID_COLS","GRID_SPACING","getGridPosition","row","col","offsetX","offsetZ","GridControllerSystem","controllers","controllerId","gridItems","gx","gy","gz","GridEaseSystem","k","GridArrangementPlugin","setupGridUI","controller"],"mappings":"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"}