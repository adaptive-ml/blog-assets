{"version":3,"file":"canvas-setup-C6Sj2kLI.js","sources":["../../../src/sequence/canvas-setup.ts"],"sourcesContent":["import type { State } from '@multiplekex/shallot';\r\n\r\nexport function setupCanvas(canvas: HTMLCanvasElement): void {\r\n  const rect = canvas.getBoundingClientRect();\r\n  canvas.width = rect.width * window.devicePixelRatio;\r\n  canvas.height = rect.height * window.devicePixelRatio;\r\n}\r\n\r\nexport function setupVisibilityControl(state: State): void {\r\n  new IntersectionObserver(([entry]) => {\r\n    if (entry.isIntersecting) {\r\n      state.start();\r\n    } else {\r\n      state.stop();\r\n    }\r\n  }).observe(document.documentElement);\r\n}\r\n\r\nexport function createVisibilityLoop(state: State, onTick?: (dt: number) => void): void {\r\n  let running = false;\r\n  let lastTime = performance.now();\r\n\r\n  function tick(now: number): void {\r\n    if (!running) return;\r\n    const dt = (now - lastTime) / 1000;\r\n    lastTime = now;\r\n    state.step(dt);\r\n    onTick?.(dt);\r\n    requestAnimationFrame(tick);\r\n  }\r\n\r\n  new IntersectionObserver(([entry]) => {\r\n    if (entry.isIntersecting) {\r\n      if (!running) {\r\n        running = true;\r\n        lastTime = performance.now();\r\n        requestAnimationFrame(tick);\r\n      }\r\n    } else {\r\n      running = false;\r\n    }\r\n  }).observe(document.documentElement);\r\n}\r\n"],"names":["setupCanvas","canvas","rect","setupVisibilityControl","state","entry","createVisibilityLoop","onTick","running","lastTime","tick","now","dt"],"mappings":"AAEO,SAASA,EAAYC,EAAiC,CAC3D,MAAMC,EAAOD,EAAO,sBAAA,EACpBA,EAAO,MAAQC,EAAK,MAAQ,OAAO,iBACnCD,EAAO,OAASC,EAAK,OAAS,OAAO,gBACvC,CAEO,SAASC,EAAuBC,EAAoB,CACzD,IAAI,qBAAqB,CAAC,CAACC,CAAK,IAAM,CAChCA,EAAM,eACRD,EAAM,MAAA,EAENA,EAAM,KAAA,CAEV,CAAC,EAAE,QAAQ,SAAS,eAAe,CACrC,CAEO,SAASE,EAAqBF,EAAcG,EAAqC,CACtF,IAAIC,EAAU,GACVC,EAAW,YAAY,IAAA,EAE3B,SAASC,EAAKC,EAAmB,CAC/B,GAAI,CAACH,EAAS,OACd,MAAMI,GAAMD,EAAMF,GAAY,IAC9BA,EAAWE,EACXP,EAAM,KAAKQ,CAAE,EAEb,sBAAsBF,CAAI,CAC5B,CAEA,IAAI,qBAAqB,CAAC,CAACL,CAAK,IAAM,CAChCA,EAAM,eACHG,IACHA,EAAU,GACVC,EAAW,YAAY,IAAA,EACvB,sBAAsBC,CAAI,GAG5BF,EAAU,EAEd,CAAC,EAAE,QAAQ,SAAS,eAAe,CACrC"}