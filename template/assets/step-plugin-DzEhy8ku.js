import{s as v,r as T,a as n,S as l,T as p,C as h,b as E}from"./component-B847rBOH.js";var u=(e,r,t)=>Object.defineProperty(e,r,{value:t,enumerable:!1,writable:!0,configurable:!0}),w=Symbol.for("bitecs-relation"),C=Symbol.for("bitecs-pairTarget"),L=Symbol.for("bitecs-isPairComponent"),P=Symbol.for("bitecs-relationData"),y=()=>{let e={pairsMap:new Map,initStore:void 0,exclusiveRelation:!1,autoRemoveSubject:!1,onTargetRemoved:void 0},r=t=>{if(t===void 0)throw Error("Relation target is undefined");let a=t==="*"?x:t;if(!e.pairsMap.has(a)){let i={};u(i,w,r),u(i,C,a),u(i,L,!0),e.pairsMap.set(a,i)}return e.pairsMap.get(a)};return u(r,P,e),r},q=(e,r)=>{if(e===void 0)throw Error("Relation is undefined");return e(r)},O=Symbol.for("bitecs-wildcard");function R(){let e=y();return Object.defineProperty(e,O,{value:!0,enumerable:!1,writable:!1,configurable:!1}),e}function j(){let e=Symbol.for("bitecs-global-wildcard");return globalThis[e]||(globalThis[e]=R()),globalThis[e]}var x=j();function N(){return y()}function k(){let e=Symbol.for("bitecs-global-isa");return globalThis[e]||(globalThis[e]=N()),globalThis[e]}k();const s={step:[],target:[],max:[]};v(s,{defaults:()=>({step:0,target:0,max:0})});let S=null;function I(e,r){S=t=>r.getEntityByName(t)}T(I);function m(e){return S?.(e)??null}function M(e){let r=!1;return{group:"simulation",update(t){if(!r)for(const a of t.query([s])){const i=s.step[a],f=s.target[a];if(i!==f){r=!0;const d=e[`${i}-${f}`],c=d?m(d):null;for(const b of Object.values(e)){const o=m(b);o!==null&&t.hasComponent(o,n)&&n.state[o]===l.PLAYING&&(n.state[o]=l.COMPLETE)}t.step(0);for(const b of Object.values(e)){const o=m(b);if(o!==null&&t.hasComponent(o,n)){n.state[o]=l.IDLE,n.elapsed[o]=0;for(const g of t.query([q(h.relation,o),p]))p.state[g]=E.IDLE,p.elapsed[g]=0}}c!==null&&t.hasComponent(c,n)&&(n.state[c]=l.PLAYING),s.step[a]=f,r=!1}}}}}function D(e){return{components:{StepController:s},systems:[M(e)]}}export{s as S,q as b,D as c,m as g};
//# sourceMappingURL=step-plugin-DzEhy8ku.js.map
